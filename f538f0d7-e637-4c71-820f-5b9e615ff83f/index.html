<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" as="image" href="/kouchou-ai-reports/images/logo.svg"/><link rel="preload" as="image" href="/kouchou-ai-reports/meta/reporter.png"/><link rel="stylesheet" href="/kouchou-ai-reports/_next/static/css/a63443551c7d7d9f.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/kouchou-ai-reports/_next/static/chunks/webpack-785c399c8fec64c2.js"/><script src="/kouchou-ai-reports/_next/static/chunks/4bd1b696-8b56d83f6a911cbf.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/684-75a2bccf2e732664.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/main-app-770f509432689459.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/315-19ca0205aa2fdd55.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/458-4db2abcd82f4c9c6.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/124-8b6d8ff5759d10e8.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/48-3a76f8478d544215.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/app/layout-2c53d293b9a0602f.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/567-13e48369edb584ec.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/app/%5Bslug%5D/error-6cef2ad01af28fcb.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/59650de3-481cc0c44db376d7.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/874-e31c245f344a6bb3.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/261-224f03b48189144a.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/116-746bc821fa46af6a.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/49-fab65c398860e39e.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/609-98106995dfc9adbb.js" async=""></script><script src="/kouchou-ai-reports/_next/static/chunks/app/%5Bslug%5D/page-e1d928255840716e.js" async=""></script><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"/><link rel="icon" href="/kouchou-ai-reports/meta/icon.png" sizes="any"/><title>②自分が市長なら、2040年に向けてこんな課題に取り組む【10/28 12:00更新】 - 「#みんなでつくる舞鶴2040」プロジェクト</title><meta name="description" content="舞鶴市では観光振興と交通利便性の向上を通じて地域活性化を目指しており、公共交通の充実や子育て支援が重要視されています。また、地域経済の活性化には商業施設の誘致やコミュニティの再生が求められ、子育てと医療の充実も必要とされています。教育環境の向上や世代間交流の促進、安全な観光環境の整備も重要な課題として挙げられています。これらの取り組みにより、舞鶴市の持続可能な発展が期待されています。"/><meta property="og:title" content="②自分が市長なら、2040年に向けてこんな課題に取り組む【10/28 12:00更新】 - 「#みんなでつくる舞鶴2040」プロジェクト"/><meta property="og:description" content="舞鶴市では観光振興と交通利便性の向上を通じて地域活性化を目指しており、公共交通の充実や子育て支援が重要視されています。また、地域経済の活性化には商業施設の誘致やコミュニティの再生が求められ、子育てと医療の充実も必要とされています。教育環境の向上や世代間交流の促進、安全な観光環境の整備も重要な課題として挙げられています。これらの取り組みにより、舞鶴市の持続可能な発展が期待されています。"/><meta property="og:image" content="http://localhost:3000/f538f0d7-e637-4c71-820f-5b9e615ff83f/opengraph-image.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="②自分が市長なら、2040年に向けてこんな課題に取り組む【10/28 12:00更新】 - 「#みんなでつくる舞鶴2040」プロジェクト"/><meta name="twitter:description" content="舞鶴市では観光振興と交通利便性の向上を通じて地域活性化を目指しており、公共交通の充実や子育て支援が重要視されています。また、地域経済の活性化には商業施設の誘致やコミュニティの再生が求められ、子育てと医療の充実も必要とされています。教育環境の向上や世代間交流の促進、安全な観光環境の整備も重要な課題として挙げられています。これらの取り組みにより、舞鶴市の持続可能な発展が期待されています。"/><meta name="twitter:image" content="http://localhost:3000/f538f0d7-e637-4c71-820f-5b9e615ff83f/opengraph-image.png"/><link href="https://fonts.googleapis.com/css2?family=BIZ+UDPGothic&amp;display=swap" rel="stylesheet"/><script src="/kouchou-ai-reports/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body><style data-emotion="css-global ad1llf">@layer reset,base,tokens,recipes;</style><style data-emotion="css-global 17rm78t">@layer reset{html{line-height:1.5;--font-fallback:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol','Noto Color Emoji';-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;text-rendering:optimizeLegibility;touch-action:manipulation;-moz-tab-size:4;tab-size:4;font-family:var(--global-font-body, var(--font-fallback));}*{margin:0px;padding:0px;font:inherit;word-wrap:break-word;-webkit-tap-highlight-color:transparent;}*,*::before,*::after,*::backdrop{box-sizing:border-box;border-width:0px;border-style:solid;border-color:var(--global-color-border, currentColor);}hr{height:0px;color:inherit;border-top-width:1px;}body{min-height:100dvh;position:relative;}img{border-style:none;}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle;}iframe{border:none;}img,video{max-width:100%;height:auto;}p,h1,h2,h3,h4,h5,h6{overflow-wrap:break-word;}ol,ul{list-style:none;}code,kbd,pre,samp{font-size:1em;}button,[type='button'],[type='reset'],[type='submit']{-webkit-appearance:button;background-color:transparent;background-image:none;}button,input,optgroup,select,textarea{color:inherit;}button,select{text-transform:none;}table{text-indent:0px;border-color:inherit;border-collapse:collapse;}*::-webkit-input-placeholder{opacity:unset;color:#9ca3af;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}*::-moz-placeholder{opacity:unset;color:#9ca3af;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}*:-ms-input-placeholder{opacity:unset;color:#9ca3af;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}*::placeholder{opacity:unset;color:#9ca3af;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}textarea{resize:vertical;}summary{display:-webkit-box;display:-webkit-list-item;display:-ms-list-itembox;display:list-item;}small{font-size:80%;}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline;}sub{bottom:-0.25em;}sup{top:-0.5em;}dialog{padding:0px;}a{color:inherit;-webkit-text-decoration:inherit;text-decoration:inherit;}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted;}b,strong{font-weight:bolder;}code,kbd,samp,pre{font-size:1em;--font-mono-fallback:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New';font-family:var(--global-font-mono, var(--font-mono-fallback));}input[type="text"],input[type="email"],input[type="search"],input[type="password"]{-webkit-appearance:none;-moz-appearance:none;}input[type='search']{-webkit-appearance:textfield;outline-offset:-2px;}::-webkit-search-decoration,::-webkit-search-cancel-button{-webkit-appearance:none;}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit;}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto;}input[type='number']{-moz-appearance:textfield;}:-moz-ui-invalid{box-shadow:none;}:-moz-focusring{outline:auto;}[hidden]:where(:not([hidden='until-found'])){display:none!important;}}@layer base{@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-ms-transform:rotate(0deg);transform:rotate(0deg);}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-ms-transform:rotate(0deg);transform:rotate(0deg);}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}}@-webkit-keyframes pulse{50%{opacity:0.5;}}@keyframes pulse{50%{opacity:0.5;}}@-webkit-keyframes ping{75%,100%{-webkit-transform:scale(2);-moz-transform:scale(2);-ms-transform:scale(2);transform:scale(2);opacity:0;}}@keyframes ping{75%,100%{-webkit-transform:scale(2);-moz-transform:scale(2);-ms-transform:scale(2);transform:scale(2);opacity:0;}}@-webkit-keyframes bounce{0%,100%{-webkit-transform:translateY(-25%);-moz-transform:translateY(-25%);-ms-transform:translateY(-25%);transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(0.8,0,1,1);animation-timing-function:cubic-bezier(0.8,0,1,1);}50%{-webkit-transform:none;-moz-transform:none;-ms-transform:none;transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,0.2,1);animation-timing-function:cubic-bezier(0,0,0.2,1);}}@keyframes bounce{0%,100%{-webkit-transform:translateY(-25%);-moz-transform:translateY(-25%);-ms-transform:translateY(-25%);transform:translateY(-25%);-webkit-animation-timing-function:cubic-bezier(0.8,0,1,1);animation-timing-function:cubic-bezier(0.8,0,1,1);}50%{-webkit-transform:none;-moz-transform:none;-ms-transform:none;transform:none;-webkit-animation-timing-function:cubic-bezier(0,0,0.2,1);animation-timing-function:cubic-bezier(0,0,0.2,1);}}@-webkit-keyframes bg-position{from{-webkit-background-position:var(--animate-from, 1rem) 0;background-position:var(--animate-from, 1rem) 0;}to{-webkit-background-position:var(--animate-to, 0) 0;background-position:var(--animate-to, 0) 0;}}@keyframes bg-position{from{-webkit-background-position:var(--animate-from, 1rem) 0;background-position:var(--animate-from, 1rem) 0;}to{-webkit-background-position:var(--animate-to, 0) 0;background-position:var(--animate-to, 0) 0;}}@-webkit-keyframes position{from{inset-inline-start:var(--animate-from-x);inset-block-start:var(--animate-from-y);}to{inset-inline-start:var(--animate-to-x);inset-block-start:var(--animate-to-y);}}@keyframes position{from{inset-inline-start:var(--animate-from-x);inset-block-start:var(--animate-from-y);}to{inset-inline-start:var(--animate-to-x);inset-block-start:var(--animate-to-y);}}@-webkit-keyframes circular-progress{0%{stroke-dasharray:1,400;stroke-dashoffset:0;}50%{stroke-dasharray:400,400;stroke-dashoffset:-100%;}100%{stroke-dasharray:400,400;stroke-dashoffset:-260%;}}@keyframes circular-progress{0%{stroke-dasharray:1,400;stroke-dashoffset:0;}50%{stroke-dasharray:400,400;stroke-dashoffset:-100%;}100%{stroke-dasharray:400,400;stroke-dashoffset:-260%;}}@-webkit-keyframes expand-height{from{height:0;}to{height:var(--height);}}@keyframes expand-height{from{height:0;}to{height:var(--height);}}@-webkit-keyframes collapse-height{from{height:var(--height);}to{height:0;}}@keyframes collapse-height{from{height:var(--height);}to{height:0;}}@-webkit-keyframes expand-width{from{width:0;}to{width:var(--width);}}@keyframes expand-width{from{width:0;}to{width:var(--width);}}@-webkit-keyframes collapse-width{from{height:var(--width);}to{height:0;}}@keyframes collapse-width{from{height:var(--width);}to{height:0;}}@-webkit-keyframes fade-in{from{opacity:0;}to{opacity:1;}}@keyframes fade-in{from{opacity:0;}to{opacity:1;}}@-webkit-keyframes fade-out{from{opacity:1;}to{opacity:0;}}@keyframes fade-out{from{opacity:1;}to{opacity:0;}}@-webkit-keyframes slide-from-left-full{from{-webkit-translate:-100% 0;-moz-translate:-100% 0;-ms-translate:-100% 0;translate:-100% 0;}to{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}}@keyframes slide-from-left-full{from{-webkit-translate:-100% 0;-moz-translate:-100% 0;-ms-translate:-100% 0;translate:-100% 0;}to{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}}@-webkit-keyframes slide-from-right-full{from{-webkit-translate:100% 0;-moz-translate:100% 0;-ms-translate:100% 0;translate:100% 0;}to{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}}@keyframes slide-from-right-full{from{-webkit-translate:100% 0;-moz-translate:100% 0;-ms-translate:100% 0;translate:100% 0;}to{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}}@-webkit-keyframes slide-from-top-full{from{-webkit-translate:0 -100%;-moz-translate:0 -100%;-ms-translate:0 -100%;translate:0 -100%;}to{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}}@keyframes slide-from-top-full{from{-webkit-translate:0 -100%;-moz-translate:0 -100%;-ms-translate:0 -100%;translate:0 -100%;}to{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}}@-webkit-keyframes slide-from-bottom-full{from{-webkit-translate:0 100%;-moz-translate:0 100%;-ms-translate:0 100%;translate:0 100%;}to{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}}@keyframes slide-from-bottom-full{from{-webkit-translate:0 100%;-moz-translate:0 100%;-ms-translate:0 100%;translate:0 100%;}to{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}}@-webkit-keyframes slide-to-left-full{from{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}to{-webkit-translate:-100% 0;-moz-translate:-100% 0;-ms-translate:-100% 0;translate:-100% 0;}}@keyframes slide-to-left-full{from{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}to{-webkit-translate:-100% 0;-moz-translate:-100% 0;-ms-translate:-100% 0;translate:-100% 0;}}@-webkit-keyframes slide-to-right-full{from{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}to{-webkit-translate:100% 0;-moz-translate:100% 0;-ms-translate:100% 0;translate:100% 0;}}@keyframes slide-to-right-full{from{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}to{-webkit-translate:100% 0;-moz-translate:100% 0;-ms-translate:100% 0;translate:100% 0;}}@-webkit-keyframes slide-to-top-full{from{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}to{-webkit-translate:0 -100%;-moz-translate:0 -100%;-ms-translate:0 -100%;translate:0 -100%;}}@keyframes slide-to-top-full{from{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}to{-webkit-translate:0 -100%;-moz-translate:0 -100%;-ms-translate:0 -100%;translate:0 -100%;}}@-webkit-keyframes slide-to-bottom-full{from{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}to{-webkit-translate:0 100%;-moz-translate:0 100%;-ms-translate:0 100%;translate:0 100%;}}@keyframes slide-to-bottom-full{from{-webkit-translate:0 0;-moz-translate:0 0;-ms-translate:0 0;translate:0 0;}to{-webkit-translate:0 100%;-moz-translate:0 100%;-ms-translate:0 100%;translate:0 100%;}}@-webkit-keyframes slide-from-top{0%{-webkit-translate:0 -0.5rem;-moz-translate:0 -0.5rem;-ms-translate:0 -0.5rem;translate:0 -0.5rem;}to{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}}@keyframes slide-from-top{0%{-webkit-translate:0 -0.5rem;-moz-translate:0 -0.5rem;-ms-translate:0 -0.5rem;translate:0 -0.5rem;}to{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}}@-webkit-keyframes slide-from-bottom{0%{-webkit-translate:0 0.5rem;-moz-translate:0 0.5rem;-ms-translate:0 0.5rem;translate:0 0.5rem;}to{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}}@keyframes slide-from-bottom{0%{-webkit-translate:0 0.5rem;-moz-translate:0 0.5rem;-ms-translate:0 0.5rem;translate:0 0.5rem;}to{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}}@-webkit-keyframes slide-from-left{0%{-webkit-translate:-0.5rem 0;-moz-translate:-0.5rem 0;-ms-translate:-0.5rem 0;translate:-0.5rem 0;}to{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}}@keyframes slide-from-left{0%{-webkit-translate:-0.5rem 0;-moz-translate:-0.5rem 0;-ms-translate:-0.5rem 0;translate:-0.5rem 0;}to{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}}@-webkit-keyframes slide-from-right{0%{-webkit-translate:0.5rem 0;-moz-translate:0.5rem 0;-ms-translate:0.5rem 0;translate:0.5rem 0;}to{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}}@keyframes slide-from-right{0%{-webkit-translate:0.5rem 0;-moz-translate:0.5rem 0;-ms-translate:0.5rem 0;translate:0.5rem 0;}to{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}}@-webkit-keyframes slide-to-top{0%{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}to{-webkit-translate:0 -0.5rem;-moz-translate:0 -0.5rem;-ms-translate:0 -0.5rem;translate:0 -0.5rem;}}@keyframes slide-to-top{0%{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}to{-webkit-translate:0 -0.5rem;-moz-translate:0 -0.5rem;-ms-translate:0 -0.5rem;translate:0 -0.5rem;}}@-webkit-keyframes slide-to-bottom{0%{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}to{-webkit-translate:0 0.5rem;-moz-translate:0 0.5rem;-ms-translate:0 0.5rem;translate:0 0.5rem;}}@keyframes slide-to-bottom{0%{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}to{-webkit-translate:0 0.5rem;-moz-translate:0 0.5rem;-ms-translate:0 0.5rem;translate:0 0.5rem;}}@-webkit-keyframes slide-to-left{0%{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}to{-webkit-translate:-0.5rem 0;-moz-translate:-0.5rem 0;-ms-translate:-0.5rem 0;translate:-0.5rem 0;}}@keyframes slide-to-left{0%{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}to{-webkit-translate:-0.5rem 0;-moz-translate:-0.5rem 0;-ms-translate:-0.5rem 0;translate:-0.5rem 0;}}@-webkit-keyframes slide-to-right{0%{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}to{-webkit-translate:0.5rem 0;-moz-translate:0.5rem 0;-ms-translate:0.5rem 0;translate:0.5rem 0;}}@keyframes slide-to-right{0%{-webkit-translate:0;-moz-translate:0;-ms-translate:0;translate:0;}to{-webkit-translate:0.5rem 0;-moz-translate:0.5rem 0;-ms-translate:0.5rem 0;translate:0.5rem 0;}}@-webkit-keyframes scale-in{from{scale:0.95;}to{scale:1;}}@keyframes scale-in{from{scale:0.95;}to{scale:1;}}@-webkit-keyframes scale-out{from{scale:1;}to{scale:0.95;}}@keyframes scale-out{from{scale:1;}to{scale:0.95;}}*{font-feature-settings:"cv11";--ring-inset:var(--chakra-empty,/**/ /*!*/)!important;--ring-offset-width:0px;--ring-offset-color:#fff;--ring-color:rgba(66, 153, 225, 0.6);--ring-offset-shadow:0 0 #0000;--ring-shadow:0 0 #0000;--brightness:var(--chakra-empty,/**/ /*!*/)!important;--contrast:var(--chakra-empty,/**/ /*!*/)!important;--grayscale:var(--chakra-empty,/**/ /*!*/)!important;--hue-rotate:var(--chakra-empty,/**/ /*!*/)!important;--invert:var(--chakra-empty,/**/ /*!*/)!important;--saturate:var(--chakra-empty,/**/ /*!*/)!important;--sepia:var(--chakra-empty,/**/ /*!*/)!important;--drop-shadow:var(--chakra-empty,/**/ /*!*/)!important;--backdrop-blur:var(--chakra-empty,/**/ /*!*/)!important;--backdrop-brightness:var(--chakra-empty,/**/ /*!*/)!important;--backdrop-contrast:var(--chakra-empty,/**/ /*!*/)!important;--backdrop-grayscale:var(--chakra-empty,/**/ /*!*/)!important;--backdrop-hue-rotate:var(--chakra-empty,/**/ /*!*/)!important;--backdrop-invert:var(--chakra-empty,/**/ /*!*/)!important;--backdrop-opacity:var(--chakra-empty,/**/ /*!*/)!important;--backdrop-saturate:var(--chakra-empty,/**/ /*!*/)!important;--backdrop-sepia:var(--chakra-empty,/**/ /*!*/)!important;--global-font-mono:var(--chakra-fonts-mono);--global-font-body:var(--chakra-fonts-body);--global-color-border:var(--chakra-colors-border);}html{color:var(--chakra-colors-fg);background:var(--chakra-colors-bg);--bg-currentcolor:var(--chakra-colors-bg);line-height:1.5;--chakra-colors-color-palette-50:var(--chakra-colors-gray-50);--chakra-colors-color-palette-100:var(--chakra-colors-gray-100);--chakra-colors-color-palette-200:var(--chakra-colors-gray-200);--chakra-colors-color-palette-300:var(--chakra-colors-gray-300);--chakra-colors-color-palette-400:var(--chakra-colors-gray-400);--chakra-colors-color-palette-500:var(--chakra-colors-gray-500);--chakra-colors-color-palette-600:var(--chakra-colors-gray-600);--chakra-colors-color-palette-700:var(--chakra-colors-gray-700);--chakra-colors-color-palette-800:var(--chakra-colors-gray-800);--chakra-colors-color-palette-900:var(--chakra-colors-gray-900);--chakra-colors-color-palette-950:var(--chakra-colors-gray-950);--chakra-colors-color-palette-contrast:var(--chakra-colors-gray-contrast);--chakra-colors-color-palette-fg:var(--chakra-colors-gray-fg);--chakra-colors-color-palette-subtle:var(--chakra-colors-gray-subtle);--chakra-colors-color-palette-muted:var(--chakra-colors-gray-muted);--chakra-colors-color-palette-emphasized:var(--chakra-colors-gray-emphasized);--chakra-colors-color-palette-solid:var(--chakra-colors-gray-solid);--chakra-colors-color-palette-focus-ring:var(--chakra-colors-gray-focus-ring);}*::-webkit-input-placeholder{--mix-color:color-mix(in srgb, var(--chakra-colors-fg-muted) 80%, transparent);color:var(--mix-color, var(--chakra-colors-fg-muted));}*::-moz-placeholder{--mix-color:color-mix(in srgb, var(--chakra-colors-fg-muted) 80%, transparent);color:var(--mix-color, var(--chakra-colors-fg-muted));}*:-ms-input-placeholder{--mix-color:color-mix(in srgb, var(--chakra-colors-fg-muted) 80%, transparent);color:var(--mix-color, var(--chakra-colors-fg-muted));}*::placeholder,*[data-placeholder]{--mix-color:color-mix(in srgb, var(--chakra-colors-fg-muted) 80%, transparent);color:var(--mix-color, var(--chakra-colors-fg-muted));}*::selection{--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-emphasized) 80%, transparent);background:var(--mix-background, var(--chakra-colors-color-palette-emphasized));--bg-currentcolor:var(--mix-background, var(--chakra-colors-color-palette-emphasized));}}@layer tokens{:where(html, .chakra-theme){--chakra-aspect-ratios-square:1/1;--chakra-aspect-ratios-landscape:4/3;--chakra-aspect-ratios-portrait:3/4;--chakra-aspect-ratios-wide:16/9;--chakra-aspect-ratios-ultrawide:18/5;--chakra-aspect-ratios-golden:1.618/1;--chakra-animations-spin:spin 1s linear infinite;--chakra-animations-ping:ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;--chakra-animations-pulse:pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;--chakra-animations-bounce:bounce 1s infinite;--chakra-blurs-sm:4px;--chakra-blurs-md:8px;--chakra-blurs-lg:12px;--chakra-blurs-xl:16px;--chakra-blurs-2xl:24px;--chakra-blurs-3xl:40px;--chakra-blurs-4xl:64px;--chakra-borders-xs:0.5px solid;--chakra-borders-sm:1px solid;--chakra-borders-md:2px solid;--chakra-borders-lg:4px solid;--chakra-borders-xl:8px solid;--chakra-colors-transparent:transparent;--chakra-colors-current:currentColor;--chakra-colors-black:#09090B;--chakra-colors-white:#FFFFFF;--chakra-colors-white-alpha-50:rgba(255, 255, 255, 0.04);--chakra-colors-white-alpha-100:rgba(255, 255, 255, 0.06);--chakra-colors-white-alpha-200:rgba(255, 255, 255, 0.08);--chakra-colors-white-alpha-300:rgba(255, 255, 255, 0.16);--chakra-colors-white-alpha-400:rgba(255, 255, 255, 0.24);--chakra-colors-white-alpha-500:rgba(255, 255, 255, 0.36);--chakra-colors-white-alpha-600:rgba(255, 255, 255, 0.48);--chakra-colors-white-alpha-700:rgba(255, 255, 255, 0.64);--chakra-colors-white-alpha-800:rgba(255, 255, 255, 0.80);--chakra-colors-white-alpha-900:rgba(255, 255, 255, 0.92);--chakra-colors-white-alpha-950:rgba(255, 255, 255, 0.95);--chakra-colors-black-alpha-50:rgba(0, 0, 0, 0.04);--chakra-colors-black-alpha-100:rgba(0, 0, 0, 0.06);--chakra-colors-black-alpha-200:rgba(0, 0, 0, 0.08);--chakra-colors-black-alpha-300:rgba(0, 0, 0, 0.16);--chakra-colors-black-alpha-400:rgba(0, 0, 0, 0.24);--chakra-colors-black-alpha-500:rgba(0, 0, 0, 0.36);--chakra-colors-black-alpha-600:rgba(0, 0, 0, 0.48);--chakra-colors-black-alpha-700:rgba(0, 0, 0, 0.64);--chakra-colors-black-alpha-800:rgba(0, 0, 0, 0.80);--chakra-colors-black-alpha-900:rgba(0, 0, 0, 0.92);--chakra-colors-black-alpha-950:rgba(0, 0, 0, 0.95);--chakra-colors-gray-50:#fafafa;--chakra-colors-gray-100:#f4f4f5;--chakra-colors-gray-200:#e4e4e7;--chakra-colors-gray-300:#d4d4d8;--chakra-colors-gray-400:#a1a1aa;--chakra-colors-gray-500:#71717a;--chakra-colors-gray-600:#52525b;--chakra-colors-gray-700:#3f3f46;--chakra-colors-gray-800:#27272a;--chakra-colors-gray-900:#18181b;--chakra-colors-gray-950:#111111;--chakra-colors-red-50:#fef2f2;--chakra-colors-red-100:#fee2e2;--chakra-colors-red-200:#fecaca;--chakra-colors-red-300:#fca5a5;--chakra-colors-red-400:#f87171;--chakra-colors-red-500:#ef4444;--chakra-colors-red-600:#dc2626;--chakra-colors-red-700:#991919;--chakra-colors-red-800:#511111;--chakra-colors-red-900:#300c0c;--chakra-colors-red-950:#1f0808;--chakra-colors-orange-50:#fff7ed;--chakra-colors-orange-100:#ffedd5;--chakra-colors-orange-200:#fed7aa;--chakra-colors-orange-300:#fdba74;--chakra-colors-orange-400:#fb923c;--chakra-colors-orange-500:#f97316;--chakra-colors-orange-600:#ea580c;--chakra-colors-orange-700:#92310a;--chakra-colors-orange-800:#6c2710;--chakra-colors-orange-900:#3b1106;--chakra-colors-orange-950:#220a04;--chakra-colors-yellow-50:#fefce8;--chakra-colors-yellow-100:#fef9c3;--chakra-colors-yellow-200:#fef08a;--chakra-colors-yellow-300:#fde047;--chakra-colors-yellow-400:#facc15;--chakra-colors-yellow-500:#eab308;--chakra-colors-yellow-600:#ca8a04;--chakra-colors-yellow-700:#845209;--chakra-colors-yellow-800:#713f12;--chakra-colors-yellow-900:#422006;--chakra-colors-yellow-950:#281304;--chakra-colors-green-50:#f0fdf4;--chakra-colors-green-100:#dcfce7;--chakra-colors-green-200:#bbf7d0;--chakra-colors-green-300:#86efac;--chakra-colors-green-400:#4ade80;--chakra-colors-green-500:#22c55e;--chakra-colors-green-600:#16a34a;--chakra-colors-green-700:#116932;--chakra-colors-green-800:#124a28;--chakra-colors-green-900:#042713;--chakra-colors-green-950:#03190c;--chakra-colors-teal-50:#f0fdfa;--chakra-colors-teal-100:#ccfbf1;--chakra-colors-teal-200:#99f6e4;--chakra-colors-teal-300:#5eead4;--chakra-colors-teal-400:#2dd4bf;--chakra-colors-teal-500:#14b8a6;--chakra-colors-teal-600:#0d9488;--chakra-colors-teal-700:#0c5d56;--chakra-colors-teal-800:#114240;--chakra-colors-teal-900:#032726;--chakra-colors-teal-950:#021716;--chakra-colors-blue-50:#eff6ff;--chakra-colors-blue-100:#dbeafe;--chakra-colors-blue-200:#bfdbfe;--chakra-colors-blue-300:#a3cfff;--chakra-colors-blue-400:#60a5fa;--chakra-colors-blue-500:#3b82f6;--chakra-colors-blue-600:#2563eb;--chakra-colors-blue-700:#173da6;--chakra-colors-blue-800:#1a3478;--chakra-colors-blue-900:#14204a;--chakra-colors-blue-950:#0c142e;--chakra-colors-cyan-50:#ecfeff;--chakra-colors-cyan-100:#cffafe;--chakra-colors-cyan-200:#a5f3fc;--chakra-colors-cyan-300:#67e8f9;--chakra-colors-cyan-400:#22d3ee;--chakra-colors-cyan-500:#06b6d4;--chakra-colors-cyan-600:#0891b2;--chakra-colors-cyan-700:#0c5c72;--chakra-colors-cyan-800:#134152;--chakra-colors-cyan-900:#072a38;--chakra-colors-cyan-950:#051b24;--chakra-colors-purple-50:#faf5ff;--chakra-colors-purple-100:#f3e8ff;--chakra-colors-purple-200:#e9d5ff;--chakra-colors-purple-300:#d8b4fe;--chakra-colors-purple-400:#c084fc;--chakra-colors-purple-500:#a855f7;--chakra-colors-purple-600:#9333ea;--chakra-colors-purple-700:#641ba3;--chakra-colors-purple-800:#4a1772;--chakra-colors-purple-900:#2f0553;--chakra-colors-purple-950:#1a032e;--chakra-colors-pink-50:#fdf2f8;--chakra-colors-pink-100:#fce7f3;--chakra-colors-pink-200:#fbcfe8;--chakra-colors-pink-300:#f9a8d4;--chakra-colors-pink-400:#f472b6;--chakra-colors-pink-500:#ec4899;--chakra-colors-pink-600:#db2777;--chakra-colors-pink-700:#a41752;--chakra-colors-pink-800:#6d0e34;--chakra-colors-pink-900:#45061f;--chakra-colors-pink-950:#2c0514;--chakra-durations-fastest:50ms;--chakra-durations-faster:100ms;--chakra-durations-fast:150ms;--chakra-durations-moderate:200ms;--chakra-durations-slow:300ms;--chakra-durations-slower:400ms;--chakra-durations-slowest:500ms;--chakra-easings-ease-in:cubic-bezier(0.42, 0, 1, 1);--chakra-easings-ease-out:cubic-bezier(0, 0, 0.58, 1);--chakra-easings-ease-in-out:cubic-bezier(0.42, 0, 0.58, 1);--chakra-easings-ease-in-smooth:cubic-bezier(0.32, 0.72, 0, 1);--chakra-fonts-heading:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--chakra-fonts-body:Inter,-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";--chakra-fonts-mono:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--chakra-fonts-main:"BIZ UDPGothic","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;--chakra-font-sizes-2xs:0.625rem;--chakra-font-sizes-xs:0.75rem;--chakra-font-sizes-sm:0.875rem;--chakra-font-sizes-md:1rem;--chakra-font-sizes-lg:1.125rem;--chakra-font-sizes-xl:1.25rem;--chakra-font-sizes-2xl:1.5rem;--chakra-font-sizes-3xl:1.875rem;--chakra-font-sizes-4xl:2.25rem;--chakra-font-sizes-5xl:3rem;--chakra-font-sizes-6xl:3.75rem;--chakra-font-sizes-7xl:4.5rem;--chakra-font-sizes-8xl:6rem;--chakra-font-sizes-9xl:8rem;--chakra-font-weights-thin:100;--chakra-font-weights-extralight:200;--chakra-font-weights-light:300;--chakra-font-weights-normal:400;--chakra-font-weights-medium:500;--chakra-font-weights-semibold:600;--chakra-font-weights-bold:700;--chakra-font-weights-extrabold:800;--chakra-font-weights-black:900;--chakra-letter-spacings-tighter:-0.05em;--chakra-letter-spacings-tight:-0.025em;--chakra-letter-spacings-wide:0.025em;--chakra-letter-spacings-wider:0.05em;--chakra-letter-spacings-widest:0.1em;--chakra-line-heights-shorter:1.25;--chakra-line-heights-short:1.375;--chakra-line-heights-moderate:1.5;--chakra-line-heights-tall:1.625;--chakra-line-heights-taller:2;--chakra-radii-none:0;--chakra-radii-2xs:0.0625rem;--chakra-radii-xs:0.125rem;--chakra-radii-sm:0.25rem;--chakra-radii-md:0.375rem;--chakra-radii-lg:0.5rem;--chakra-radii-xl:0.75rem;--chakra-radii-2xl:1rem;--chakra-radii-3xl:1.5rem;--chakra-radii-4xl:2rem;--chakra-radii-full:9999px;--chakra-spacing-1:0.25rem;--chakra-spacing-2:0.5rem;--chakra-spacing-3:0.75rem;--chakra-spacing-4:1rem;--chakra-spacing-5:1.25rem;--chakra-spacing-6:1.5rem;--chakra-spacing-7:1.75rem;--chakra-spacing-8:2rem;--chakra-spacing-9:2.25rem;--chakra-spacing-10:2.5rem;--chakra-spacing-11:2.75rem;--chakra-spacing-12:3rem;--chakra-spacing-14:3.5rem;--chakra-spacing-16:4rem;--chakra-spacing-20:5rem;--chakra-spacing-24:6rem;--chakra-spacing-28:7rem;--chakra-spacing-32:8rem;--chakra-spacing-36:9rem;--chakra-spacing-40:10rem;--chakra-spacing-44:11rem;--chakra-spacing-48:12rem;--chakra-spacing-52:13rem;--chakra-spacing-56:14rem;--chakra-spacing-60:15rem;--chakra-spacing-64:16rem;--chakra-spacing-72:18rem;--chakra-spacing-80:20rem;--chakra-spacing-96:24rem;--chakra-spacing-0\.5:0.125rem;--chakra-spacing-1\.5:0.375rem;--chakra-spacing-2\.5:0.625rem;--chakra-spacing-3\.5:0.875rem;--chakra-spacing-4\.5:1.125rem;--chakra-sizes-1:0.25rem;--chakra-sizes-2:0.5rem;--chakra-sizes-3:0.75rem;--chakra-sizes-4:1rem;--chakra-sizes-5:1.25rem;--chakra-sizes-6:1.5rem;--chakra-sizes-7:1.75rem;--chakra-sizes-8:2rem;--chakra-sizes-9:2.25rem;--chakra-sizes-10:2.5rem;--chakra-sizes-11:2.75rem;--chakra-sizes-12:3rem;--chakra-sizes-14:3.5rem;--chakra-sizes-16:4rem;--chakra-sizes-20:5rem;--chakra-sizes-24:6rem;--chakra-sizes-28:7rem;--chakra-sizes-32:8rem;--chakra-sizes-36:9rem;--chakra-sizes-40:10rem;--chakra-sizes-44:11rem;--chakra-sizes-48:12rem;--chakra-sizes-52:13rem;--chakra-sizes-56:14rem;--chakra-sizes-60:15rem;--chakra-sizes-64:16rem;--chakra-sizes-72:18rem;--chakra-sizes-80:20rem;--chakra-sizes-96:24rem;--chakra-sizes-3xs:14rem;--chakra-sizes-2xs:16rem;--chakra-sizes-xs:20rem;--chakra-sizes-sm:24rem;--chakra-sizes-md:28rem;--chakra-sizes-lg:32rem;--chakra-sizes-xl:36rem;--chakra-sizes-2xl:42rem;--chakra-sizes-3xl:48rem;--chakra-sizes-4xl:56rem;--chakra-sizes-5xl:64rem;--chakra-sizes-6xl:72rem;--chakra-sizes-7xl:80rem;--chakra-sizes-8xl:90rem;--chakra-sizes-0\.5:0.125rem;--chakra-sizes-1\.5:0.375rem;--chakra-sizes-2\.5:0.625rem;--chakra-sizes-3\.5:0.875rem;--chakra-sizes-4\.5:1.125rem;--chakra-sizes-1\/2:50%;--chakra-sizes-1\/3:33.333333%;--chakra-sizes-2\/3:66.666667%;--chakra-sizes-1\/4:25%;--chakra-sizes-3\/4:75%;--chakra-sizes-1\/5:20%;--chakra-sizes-2\/5:40%;--chakra-sizes-3\/5:60%;--chakra-sizes-4\/5:80%;--chakra-sizes-1\/6:16.666667%;--chakra-sizes-2\/6:33.333333%;--chakra-sizes-3\/6:50%;--chakra-sizes-4\/6:66.666667%;--chakra-sizes-5\/6:83.333333%;--chakra-sizes-1\/12:8.333333%;--chakra-sizes-2\/12:16.666667%;--chakra-sizes-3\/12:25%;--chakra-sizes-4\/12:33.333333%;--chakra-sizes-5\/12:41.666667%;--chakra-sizes-6\/12:50%;--chakra-sizes-7\/12:58.333333%;--chakra-sizes-8\/12:66.666667%;--chakra-sizes-9\/12:75%;--chakra-sizes-10\/12:83.333333%;--chakra-sizes-11\/12:91.666667%;--chakra-sizes-max:max-content;--chakra-sizes-min:min-content;--chakra-sizes-fit:fit-content;--chakra-sizes-prose:60ch;--chakra-sizes-full:100%;--chakra-sizes-dvh:100dvh;--chakra-sizes-svh:100svh;--chakra-sizes-lvh:100lvh;--chakra-sizes-dvw:100dvw;--chakra-sizes-svw:100svw;--chakra-sizes-lvw:100lvw;--chakra-sizes-vw:100vw;--chakra-sizes-vh:100vh;--chakra-sizes-breakpoint-sm:480px;--chakra-sizes-breakpoint-md:768px;--chakra-sizes-breakpoint-lg:1024px;--chakra-sizes-breakpoint-xl:1280px;--chakra-sizes-breakpoint-2xl:1536px;--chakra-z-index-hide:-1;--chakra-z-index-base:0;--chakra-z-index-docked:10;--chakra-z-index-dropdown:1000;--chakra-z-index-sticky:1100;--chakra-z-index-banner:1200;--chakra-z-index-overlay:1300;--chakra-z-index-modal:1400;--chakra-z-index-popover:1500;--chakra-z-index-skip-nav:1600;--chakra-z-index-toast:1700;--chakra-z-index-tooltip:1800;--chakra-z-index-max:2147483647;--chakra-cursor-button:pointer;--chakra-cursor-checkbox:default;--chakra-cursor-disabled:not-allowed;--chakra-cursor-menuitem:default;--chakra-cursor-option:default;--chakra-cursor-radio:default;--chakra-cursor-slider:default;--chakra-cursor-switch:pointer;--chakra-breakpoints-sm:480px;--chakra-breakpoints-md:768px;--chakra-breakpoints-lg:1024px;--chakra-breakpoints-xl:1280px;--chakra-breakpoints-2xl:1536px;--chakra-colors-bg-error:var(--chakra-colors-red-50);--chakra-colors-bg-white:var(--chakra-colors-white);--chakra-colors-bg-secondary:var(--chakra-colors-blue-50);--chakra-colors-bg-disable:var(--chakra-colors-gray-50);--chakra-colors-bg-tooltip:var(--chakra-colors-gray-700);--chakra-colors-bg-overlay:rgba(0, 0, 0, 0.36);--chakra-colors-bg-public:var(--chakra-colors-green-50);--chakra-colors-bg-limited-public:var(--chakra-colors-yellow-50);--chakra-colors-bg-private:var(--chakra-colors-red-50);--chakra-colors-bg-processing:var(--chakra-colors-purple-50);--chakra-colors-border-default:var(--chakra-colors-black-alpha-500);--chakra-colors-border-weak:var(--chakra-colors-black-alpha-300);--chakra-colors-border-public:var(--chakra-colors-green-200);--chakra-colors-border-limited-public:var(--chakra-colors-yellow-300);--chakra-colors-border-private:var(--chakra-colors-red-200);--chakra-colors-font-primary:var(--chakra-colors-gray-800);--chakra-colors-font-secondary:var(--chakra-colors-gray-500);--chakra-colors-font-disable:var(--chakra-colors-gray-400);--chakra-colors-font-white:var(--chakra-colors-white);--chakra-colors-font-link:var(--chakra-colors-blue-500);--chakra-colors-font-visited:var(--chakra-colors-purple-700);--chakra-colors-font-error:var(--chakra-colors-red-500);--chakra-colors-font-ai-talking:var(--chakra-colors-purple-600);--chakra-colors-button-primary-default:var(--chakra-colors-gray-800);--chakra-colors-button-primary-hover:var(--chakra-colors-gray-600);--chakra-colors-button-primary-active:var(--chakra-colors-gray-900);--chakra-colors-button-hover:rgba(0, 0, 0, 0.06);--chakra-colors-button-active:rgba(0, 0, 0, 0.08);--chakra-radii-l1:var(--chakra-radii-xs);--chakra-radii-l2:var(--chakra-radii-sm);--chakra-radii-l3:var(--chakra-radii-md);}:root,.light{--chakra-colors-bg:var(--chakra-colors-white);--chakra-colors-bg-subtle:var(--chakra-colors-gray-50);--chakra-colors-bg-muted:var(--chakra-colors-gray-100);--chakra-colors-bg-emphasized:var(--chakra-colors-gray-200);--chakra-colors-bg-inverted:var(--chakra-colors-black);--chakra-colors-bg-panel:var(--chakra-colors-white);--chakra-colors-bg-warning:var(--chakra-colors-orange-50);--chakra-colors-bg-success:var(--chakra-colors-green-50);--chakra-colors-bg-info:var(--chakra-colors-blue-50);--chakra-colors-fg:var(--chakra-colors-black);--chakra-colors-fg-muted:var(--chakra-colors-gray-600);--chakra-colors-fg-subtle:var(--chakra-colors-gray-400);--chakra-colors-fg-inverted:var(--chakra-colors-gray-50);--chakra-colors-fg-error:var(--chakra-colors-red-500);--chakra-colors-fg-warning:var(--chakra-colors-orange-600);--chakra-colors-fg-success:var(--chakra-colors-green-600);--chakra-colors-fg-info:var(--chakra-colors-blue-600);--chakra-colors-border:var(--chakra-colors-gray-200);--chakra-colors-border-muted:var(--chakra-colors-gray-100);--chakra-colors-border-subtle:var(--chakra-colors-gray-50);--chakra-colors-border-emphasized:var(--chakra-colors-gray-300);--chakra-colors-border-inverted:var(--chakra-colors-gray-800);--chakra-colors-border-error:var(--chakra-colors-red-500);--chakra-colors-border-warning:var(--chakra-colors-orange-500);--chakra-colors-border-success:var(--chakra-colors-green-500);--chakra-colors-border-info:var(--chakra-colors-blue-500);--chakra-colors-gray-contrast:var(--chakra-colors-white);--chakra-colors-gray-fg:var(--chakra-colors-gray-800);--chakra-colors-gray-subtle:var(--chakra-colors-gray-100);--chakra-colors-gray-muted:var(--chakra-colors-gray-200);--chakra-colors-gray-emphasized:var(--chakra-colors-gray-300);--chakra-colors-gray-solid:var(--chakra-colors-gray-900);--chakra-colors-gray-focus-ring:var(--chakra-colors-gray-400);--chakra-colors-red-contrast:white;--chakra-colors-red-fg:var(--chakra-colors-red-700);--chakra-colors-red-subtle:var(--chakra-colors-red-100);--chakra-colors-red-muted:var(--chakra-colors-red-200);--chakra-colors-red-emphasized:var(--chakra-colors-red-300);--chakra-colors-red-solid:var(--chakra-colors-red-600);--chakra-colors-red-focus-ring:var(--chakra-colors-red-400);--chakra-colors-orange-contrast:white;--chakra-colors-orange-fg:var(--chakra-colors-orange-700);--chakra-colors-orange-subtle:var(--chakra-colors-orange-100);--chakra-colors-orange-muted:var(--chakra-colors-orange-200);--chakra-colors-orange-emphasized:var(--chakra-colors-orange-300);--chakra-colors-orange-solid:var(--chakra-colors-orange-600);--chakra-colors-orange-focus-ring:var(--chakra-colors-orange-400);--chakra-colors-green-contrast:white;--chakra-colors-green-fg:var(--chakra-colors-green-700);--chakra-colors-green-subtle:var(--chakra-colors-green-100);--chakra-colors-green-muted:var(--chakra-colors-green-200);--chakra-colors-green-emphasized:var(--chakra-colors-green-300);--chakra-colors-green-solid:var(--chakra-colors-green-600);--chakra-colors-green-focus-ring:var(--chakra-colors-green-400);--chakra-colors-blue-contrast:white;--chakra-colors-blue-fg:var(--chakra-colors-blue-700);--chakra-colors-blue-subtle:var(--chakra-colors-blue-100);--chakra-colors-blue-muted:var(--chakra-colors-blue-200);--chakra-colors-blue-emphasized:var(--chakra-colors-blue-300);--chakra-colors-blue-solid:var(--chakra-colors-blue-600);--chakra-colors-blue-focus-ring:var(--chakra-colors-blue-400);--chakra-colors-yellow-contrast:black;--chakra-colors-yellow-fg:var(--chakra-colors-yellow-800);--chakra-colors-yellow-subtle:var(--chakra-colors-yellow-100);--chakra-colors-yellow-muted:var(--chakra-colors-yellow-200);--chakra-colors-yellow-emphasized:var(--chakra-colors-yellow-300);--chakra-colors-yellow-solid:var(--chakra-colors-yellow-300);--chakra-colors-yellow-focus-ring:var(--chakra-colors-yellow-400);--chakra-colors-teal-contrast:white;--chakra-colors-teal-fg:var(--chakra-colors-teal-700);--chakra-colors-teal-subtle:var(--chakra-colors-teal-100);--chakra-colors-teal-muted:var(--chakra-colors-teal-200);--chakra-colors-teal-emphasized:var(--chakra-colors-teal-300);--chakra-colors-teal-solid:var(--chakra-colors-teal-600);--chakra-colors-teal-focus-ring:var(--chakra-colors-teal-400);--chakra-colors-purple-contrast:white;--chakra-colors-purple-fg:var(--chakra-colors-purple-700);--chakra-colors-purple-subtle:var(--chakra-colors-purple-100);--chakra-colors-purple-muted:var(--chakra-colors-purple-200);--chakra-colors-purple-emphasized:var(--chakra-colors-purple-300);--chakra-colors-purple-solid:var(--chakra-colors-purple-600);--chakra-colors-purple-focus-ring:var(--chakra-colors-purple-400);--chakra-colors-pink-contrast:white;--chakra-colors-pink-fg:var(--chakra-colors-pink-700);--chakra-colors-pink-subtle:var(--chakra-colors-pink-100);--chakra-colors-pink-muted:var(--chakra-colors-pink-200);--chakra-colors-pink-emphasized:var(--chakra-colors-pink-300);--chakra-colors-pink-solid:var(--chakra-colors-pink-600);--chakra-colors-pink-focus-ring:var(--chakra-colors-pink-400);--chakra-colors-cyan-contrast:white;--chakra-colors-cyan-fg:var(--chakra-colors-cyan-700);--chakra-colors-cyan-subtle:var(--chakra-colors-cyan-100);--chakra-colors-cyan-muted:var(--chakra-colors-cyan-200);--chakra-colors-cyan-emphasized:var(--chakra-colors-cyan-300);--chakra-colors-cyan-solid:var(--chakra-colors-cyan-600);--chakra-colors-cyan-focus-ring:var(--chakra-colors-cyan-400);--chakra-shadows-xs:0px 1px 2px color-mix(in srgb, var(--chakra-colors-gray-900) 10%, transparent),0px 0px 1px color-mix(in srgb, var(--chakra-colors-gray-900) 20%, transparent);--chakra-shadows-sm:0px 2px 4px color-mix(in srgb, var(--chakra-colors-gray-900) 10%, transparent),0px 0px 1px color-mix(in srgb, var(--chakra-colors-gray-900) 30%, transparent);--chakra-shadows-md:0px 4px 8px color-mix(in srgb, var(--chakra-colors-gray-900) 10%, transparent),0px 0px 1px color-mix(in srgb, var(--chakra-colors-gray-900) 30%, transparent);--chakra-shadows-lg:0px 8px 16px color-mix(in srgb, var(--chakra-colors-gray-900) 10%, transparent),0px 0px 1px color-mix(in srgb, var(--chakra-colors-gray-900) 30%, transparent);--chakra-shadows-xl:0px 16px 24px color-mix(in srgb, var(--chakra-colors-gray-900) 10%, transparent),0px 0px 1px color-mix(in srgb, var(--chakra-colors-gray-900) 30%, transparent);--chakra-shadows-2xl:0px 24px 40px color-mix(in srgb, var(--chakra-colors-gray-900) 16%, transparent),0px 0px 1px color-mix(in srgb, var(--chakra-colors-gray-900) 30%, transparent);--chakra-shadows-inner:inset 0 2px 4px 0 color-mix(in srgb, black 5%, transparent);--chakra-shadows-inset:inset 0 0 0 1px color-mix(in srgb, black 5%, transparent);}.dark,.dark .chakra-theme:not(.light){--chakra-colors-bg:var(--chakra-colors-black);--chakra-colors-bg-subtle:var(--chakra-colors-gray-950);--chakra-colors-bg-muted:var(--chakra-colors-gray-900);--chakra-colors-bg-emphasized:var(--chakra-colors-gray-800);--chakra-colors-bg-inverted:var(--chakra-colors-white);--chakra-colors-bg-panel:var(--chakra-colors-gray-950);--chakra-colors-bg-warning:var(--chakra-colors-orange-950);--chakra-colors-bg-success:var(--chakra-colors-green-950);--chakra-colors-bg-info:var(--chakra-colors-blue-950);--chakra-colors-fg:var(--chakra-colors-gray-50);--chakra-colors-fg-muted:var(--chakra-colors-gray-400);--chakra-colors-fg-subtle:var(--chakra-colors-gray-500);--chakra-colors-fg-inverted:var(--chakra-colors-black);--chakra-colors-fg-error:var(--chakra-colors-red-400);--chakra-colors-fg-warning:var(--chakra-colors-orange-300);--chakra-colors-fg-success:var(--chakra-colors-green-300);--chakra-colors-fg-info:var(--chakra-colors-blue-300);--chakra-colors-border:var(--chakra-colors-gray-800);--chakra-colors-border-muted:var(--chakra-colors-gray-900);--chakra-colors-border-subtle:var(--chakra-colors-gray-950);--chakra-colors-border-emphasized:var(--chakra-colors-gray-700);--chakra-colors-border-inverted:var(--chakra-colors-gray-200);--chakra-colors-border-error:var(--chakra-colors-red-400);--chakra-colors-border-warning:var(--chakra-colors-orange-400);--chakra-colors-border-success:var(--chakra-colors-green-400);--chakra-colors-border-info:var(--chakra-colors-blue-400);--chakra-colors-gray-contrast:var(--chakra-colors-black);--chakra-colors-gray-fg:var(--chakra-colors-gray-200);--chakra-colors-gray-subtle:var(--chakra-colors-gray-900);--chakra-colors-gray-muted:var(--chakra-colors-gray-800);--chakra-colors-gray-emphasized:var(--chakra-colors-gray-700);--chakra-colors-gray-solid:var(--chakra-colors-white);--chakra-colors-gray-focus-ring:var(--chakra-colors-gray-400);--chakra-colors-red-contrast:white;--chakra-colors-red-fg:var(--chakra-colors-red-300);--chakra-colors-red-subtle:var(--chakra-colors-red-900);--chakra-colors-red-muted:var(--chakra-colors-red-800);--chakra-colors-red-emphasized:var(--chakra-colors-red-700);--chakra-colors-red-solid:var(--chakra-colors-red-600);--chakra-colors-red-focus-ring:var(--chakra-colors-red-400);--chakra-colors-orange-contrast:black;--chakra-colors-orange-fg:var(--chakra-colors-orange-300);--chakra-colors-orange-subtle:var(--chakra-colors-orange-900);--chakra-colors-orange-muted:var(--chakra-colors-orange-800);--chakra-colors-orange-emphasized:var(--chakra-colors-orange-700);--chakra-colors-orange-solid:var(--chakra-colors-orange-500);--chakra-colors-orange-focus-ring:var(--chakra-colors-orange-400);--chakra-colors-green-contrast:white;--chakra-colors-green-fg:var(--chakra-colors-green-300);--chakra-colors-green-subtle:var(--chakra-colors-green-900);--chakra-colors-green-muted:var(--chakra-colors-green-800);--chakra-colors-green-emphasized:var(--chakra-colors-green-700);--chakra-colors-green-solid:var(--chakra-colors-green-600);--chakra-colors-green-focus-ring:var(--chakra-colors-green-400);--chakra-colors-blue-contrast:white;--chakra-colors-blue-fg:var(--chakra-colors-blue-300);--chakra-colors-blue-subtle:var(--chakra-colors-blue-900);--chakra-colors-blue-muted:var(--chakra-colors-blue-800);--chakra-colors-blue-emphasized:var(--chakra-colors-blue-700);--chakra-colors-blue-solid:var(--chakra-colors-blue-600);--chakra-colors-blue-focus-ring:var(--chakra-colors-blue-400);--chakra-colors-yellow-contrast:black;--chakra-colors-yellow-fg:var(--chakra-colors-yellow-300);--chakra-colors-yellow-subtle:var(--chakra-colors-yellow-900);--chakra-colors-yellow-muted:var(--chakra-colors-yellow-800);--chakra-colors-yellow-emphasized:var(--chakra-colors-yellow-700);--chakra-colors-yellow-solid:var(--chakra-colors-yellow-300);--chakra-colors-yellow-focus-ring:var(--chakra-colors-yellow-400);--chakra-colors-teal-contrast:white;--chakra-colors-teal-fg:var(--chakra-colors-teal-300);--chakra-colors-teal-subtle:var(--chakra-colors-teal-900);--chakra-colors-teal-muted:var(--chakra-colors-teal-800);--chakra-colors-teal-emphasized:var(--chakra-colors-teal-700);--chakra-colors-teal-solid:var(--chakra-colors-teal-600);--chakra-colors-teal-focus-ring:var(--chakra-colors-teal-400);--chakra-colors-purple-contrast:white;--chakra-colors-purple-fg:var(--chakra-colors-purple-300);--chakra-colors-purple-subtle:var(--chakra-colors-purple-900);--chakra-colors-purple-muted:var(--chakra-colors-purple-800);--chakra-colors-purple-emphasized:var(--chakra-colors-purple-700);--chakra-colors-purple-solid:var(--chakra-colors-purple-600);--chakra-colors-purple-focus-ring:var(--chakra-colors-purple-400);--chakra-colors-pink-contrast:white;--chakra-colors-pink-fg:var(--chakra-colors-pink-300);--chakra-colors-pink-subtle:var(--chakra-colors-pink-900);--chakra-colors-pink-muted:var(--chakra-colors-pink-800);--chakra-colors-pink-emphasized:var(--chakra-colors-pink-700);--chakra-colors-pink-solid:var(--chakra-colors-pink-600);--chakra-colors-pink-focus-ring:var(--chakra-colors-pink-400);--chakra-colors-cyan-contrast:white;--chakra-colors-cyan-fg:var(--chakra-colors-cyan-300);--chakra-colors-cyan-subtle:var(--chakra-colors-cyan-900);--chakra-colors-cyan-muted:var(--chakra-colors-cyan-800);--chakra-colors-cyan-emphasized:var(--chakra-colors-cyan-700);--chakra-colors-cyan-solid:var(--chakra-colors-cyan-600);--chakra-colors-cyan-focus-ring:var(--chakra-colors-cyan-400);--chakra-shadows-xs:0px 1px 1px color-mix(in srgb, black 64%, transparent),0px 0px 1px inset color-mix(in srgb, var(--chakra-colors-gray-300) 20%, transparent);--chakra-shadows-sm:0px 2px 4px color-mix(in srgb, black 64%, transparent),0px 0px 1px inset color-mix(in srgb, var(--chakra-colors-gray-300) 30%, transparent);--chakra-shadows-md:0px 4px 8px color-mix(in srgb, black 64%, transparent),0px 0px 1px inset color-mix(in srgb, var(--chakra-colors-gray-300) 30%, transparent);--chakra-shadows-lg:0px 8px 16px color-mix(in srgb, black 64%, transparent),0px 0px 1px inset color-mix(in srgb, var(--chakra-colors-gray-300) 30%, transparent);--chakra-shadows-xl:0px 16px 24px color-mix(in srgb, black 64%, transparent),0px 0px 1px inset color-mix(in srgb, var(--chakra-colors-gray-300) 30%, transparent);--chakra-shadows-2xl:0px 24px 40px color-mix(in srgb, black 64%, transparent),0px 0px 1px inset color-mix(in srgb, var(--chakra-colors-gray-300) 30%, transparent);--chakra-shadows-inner:inset 0 2px 4px 0 black;--chakra-shadows-inset:inset 0 0 0 1px color-mix(in srgb, var(--chakra-colors-gray-300) 5%, transparent);}}</style><style data-emotion="css 1sfo5kg">.css-1sfo5kg{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;gap:0.5rem;padding-block:0;padding-inline:var(--chakra-spacing-6);background:var(--chakra-colors-white);--bg-currentcolor:var(--chakra-colors-white);border-bottom:1px solid;border-color:var(--chakra-colors-border-weak);}</style><div class="chakra-stack container css-1sfo5kg"><style data-emotion="css 1phd9a0">.css-1phd9a0{object-fit:cover;}</style><img class="chakra-image css-1phd9a0" src="/kouchou-ai-reports/images/logo.svg" alt="広聴AI"/><style data-emotion="css j29jii">.css-j29jii{padding-block:var(--chakra-spacing-2);}@media screen and (min-width: 48rem){.css-j29jii{display:none;}}</style><div class="css-j29jii"><style data-emotion="css 1uaohat">.css-1uaohat{padding-inline:0;padding-block:0;}@layer recipes{.css-1uaohat{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;border-radius:var(--chakra-radii-lg);white-space:nowrap;vertical-align:middle;border-width:1px;border-color:var(--chakra-colors-transparent);cursor:var(--chakra-cursor-button);-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;outline:0;line-height:var(--chakra-line-heights-taller);isolation:isolate;font-weight:var(--chakra-font-weights-bold);transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,translate,transform;transition-duration:var(--chakra-durations-moderate);--focus-ring-color:rgba(0, 0, 0, 0.36);height:var(--chakra-sizes-12);min-width:var(--chakra-sizes-12);font-size:var(--chakra-font-sizes-md);padding-inline:var(--chakra-spacing-8);gap:var(--chakra-spacing-3);background:var(--chakra-colors-transparent);--bg-currentcolor:var(--chakra-colors-transparent);color:var(--chakra-colors-font-primary);font-family:var(--chakra-fonts-main);letter-spacing:0.4px;}.css-1uaohat:is(:focus-visible, [data-focus-visible]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}.css-1uaohat:is(:disabled, [disabled], [data-disabled], [aria-disabled=true]){opacity:0.5;cursor:not-allowed;}.css-1uaohat :where(svg){-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:auto;height:auto;}.css-1uaohat:is([aria-expanded=true], [data-expanded], [data-state=expanded]){--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-solid) 90%, transparent);background:var(--chakra-colors-button-active);--bg-currentcolor:var(--chakra-colors-button-active);box-shadow:var(--chakra-shadows-lg);}@media (hover: hover){.css-1uaohat:is(:hover, [data-hover]):not(:disabled, [data-disabled]){--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-solid) 90%, transparent);background:var(--chakra-colors-button-hover);--bg-currentcolor:var(--chakra-colors-button-hover);box-shadow:var(--chakra-shadows-lg);}.css-1uaohat:is(:hover, [data-hover]):not(:disabled, [data-disabled]):is(:active, [data-active]):not(:disabled, [data-disabled], [data-state=open]){background:var(--chakra-colors-button-active);--bg-currentcolor:var(--chakra-colors-button-active);}}}.css-1uaohat :where(svg){font-size:1.2em;}@media screen and (min-width: 48rem){.css-1uaohat{display:none;}}</style><button type="button" aria-label="メニューを開く" data-scope="dialog" data-part="trigger" dir="ltr" id="dialog:«R9kjrtb»:trigger" aria-haspopup="dialog" aria-expanded="false" data-state="closed" class="chakra-button chakra-drawer__trigger css-1uaohat"><svg xmlns="http://www.w3.org/2000/svg" width="32px" height="32px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu"><line x1="4" x2="20" y1="12" y2="12"></line><line x1="4" x2="20" y1="6" y2="6"></line><line x1="4" x2="20" y1="18" y2="18"></line></svg></button><style data-emotion="css q8f4jk">@layer recipes{.css-q8f4jk{background:var(--chakra-colors-black-alpha-500);--bg-currentcolor:var(--chakra-colors-black-alpha-500);position:fixed;inset-inline-start:0;top:0;width:100vw;height:100dvh;z-index:var(--chakra-z-index-overlay);}.css-q8f4jk:is([open], [data-open], [data-state=open]){-webkit-animation-name:fade-in;animation-name:fade-in;-webkit-animation-duration:var(--chakra-durations-slow);animation-duration:var(--chakra-durations-slow);}.css-q8f4jk:is([closed], [data-closed], [data-state=closed]){-webkit-animation-name:fade-out;animation-name:fade-out;-webkit-animation-duration:var(--chakra-durations-moderate);animation-duration:var(--chakra-durations-moderate);}}</style><style data-emotion="css 12830yj">@layer recipes{.css-12830yj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100vw;height:100dvh;position:fixed;inset-inline-start:0;top:0;z-index:var(--chakra-z-index-modal);overscroll-behavior-y:none;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;}}</style></div><style data-emotion="css jjta0n">@media screen and (max-width: 47.9975rem){.css-jjta0n{display:none;}}</style><div class="css-jjta0n"><style data-emotion="css oq8ihp">.css-oq8ihp{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;gap:var(--chakra-spacing-1);}@media screen and (max-width: 47.9975rem){.css-oq8ihp{display:none;}}</style><div class="chakra-stack css-oq8ihp"><style data-emotion="css pio4tx">.css-pio4tx{padding:var(--chakra-spacing-3);border-bottom:none;height:auto;border-radius:var(--chakra-radii-none);}@media (hover: hover){.css-pio4tx:is(:hover, [data-hover]):not(:disabled, [data-disabled]){color:var(--chakra-colors-font-link);}}</style><div class="css-pio4tx"><style data-emotion="css 2yvnes">@layer recipes{.css-2yvnes{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;outline:none;gap:var(--chakra-spacing-1\.5);cursor:pointer;border-radius:var(--chakra-radii-l1);--focus-ring-color:var(--chakra-colors-color-palette-focus-ring);color:var(--chakra-colors-color-palette-fg);}.css-2yvnes:is(:focus, [data-focus]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}@media (hover: hover){.css-2yvnes:is(:hover, [data-hover]):not(:disabled, [data-disabled]){-webkit-text-decoration:underline;text-decoration:underline;text-underline-offset:3px;--mix-textDecorationColor:color-mix(in srgb, currentColor 20%, transparent);text-decoration-color:var(--mix-textDecorationColor, currentColor);}}}</style><a class="chakra-link css-2yvnes" href="/kouchou-ai-reports/"><style data-emotion="css tl3ftk">.css-tl3ftk{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:0.5rem;}</style><div class="chakra-stack css-tl3ftk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-files"><path d="M20 7h-3a2 2 0 0 1-2-2V2"></path><path d="M9 18a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h7l4 4v10a2 2 0 0 1-2 2Z"></path><path d="M3 7.6v12.8A1.6 1.6 0 0 0 4.6 22h9.8"></path></svg><style data-emotion="css b5474f">.css-b5474f{font-family:var(--chakra-fonts-main);font-size:var(--chakra-font-sizes-xs);font-weight:var(--chakra-font-weights-normal);line-height:var(--chakra-line-heights-taller);letter-spacing:0.3px;}</style><p class="css-b5474f">レポート一覧</p></div></a></div><div class="css-pio4tx"><a class="chakra-link css-2yvnes" href="/kouchou-ai-reports/faq/"><div class="chakra-stack css-tl3ftk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-help"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><path d="M12 17h.01"></path></svg><p class="css-b5474f">よくあるご質問</p></div></a></div></div></div></div><style data-emotion="css 14kjqbm">.css-14kjqbm{margin-top:var(--chakra-spacing-8);}</style><div class="container css-14kjqbm"><style data-emotion="css khtfa">.css-khtfa{margin-inline:auto;max-width:750px;margin-bottom:var(--chakra-spacing-8);}</style><div class="css-khtfa"><style data-emotion="css 1f6ss8b">.css-1f6ss8b{text-align:left;font-size:var(--chakra-font-sizes-xl);margin-bottom:var(--chakra-spacing-5);}@layer recipes{.css-1f6ss8b{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-font-weights-semibold);font-size:var(--chakra-font-sizes-xl);line-height:1.875rem;}}</style><h2 class="chakra-heading css-1f6ss8b">レポート</h2><style data-emotion="css 1alprs1">.css-1alprs1{margin-bottom:var(--chakra-spacing-2);}@layer recipes{.css-1alprs1{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-font-weights-semibold);font-size:var(--chakra-font-sizes-4xl);line-height:2.75rem;letter-spacing:-0.025em;}}</style><h2 class="chakra-heading headingColor css-1alprs1">②自分が市長なら、2040年に向けてこんな課題に取り組む【10/28 12:00更新】</h2><style data-emotion="css 1l0wrhl">.css-1l0wrhl{font-weight:var(--chakra-font-weights-bold);font-size:var(--chakra-font-sizes-xl);margin-bottom:var(--chakra-spacing-2);}</style><p class="css-1l0wrhl"><style data-emotion="css 1828hs">.css-1828hs{margin-right:var(--chakra-spacing-1);}@layer recipes{.css-1828hs{display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentcolor;vertical-align:middle;}}</style><svg focusable="false" aria-hidden="true" class="chakra-icon css-1828hs lucide lucide-messages-square" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z"></path><path d="M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"></path></svg>70<!-- -->件</p><p>舞鶴市では観光振興と交通利便性の向上を通じて地域活性化を目指しており、公共交通の充実や子育て支援が重要視されています。また、地域経済の活性化には商業施設の誘致やコミュニティの再生が求められ、子育てと医療の充実も必要とされています。教育環境の向上や世代間交流の促進、安全な観光環境の整備も重要な課題として挙げられています。これらの取り組みにより、舞鶴市の持続可能な発展が期待されています。</p></div><div><style data-emotion="css tc5b4f">.css-tc5b4f{max-width:1200px;margin-inline:auto;margin-bottom:var(--chakra-spacing-2);}</style><div class="css-tc5b4f"><style data-emotion="css r4q0m0">.css-r4q0m0{display:grid;grid-template-columns:1fr;gap:var(--chakra-spacing-3);}@media screen and (min-width: 48rem){.css-r4q0m0{grid-template-columns:1fr auto;}}</style><div class="css-r4q0m0"><style data-emotion="css eujb6n">.css-eujb6n{justify-self:center;margin-left:0;width:100%;height:80px;}@layer recipes{.css-eujb6n{--segment-radius:var(--chakra-radii-l2);border-radius:var(--chakra-radii-l2);display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;box-shadow:var(--chakra-shadows-inset);min-width:-webkit-max-content;min-width:-moz-max-content;min-width:max-content;text-align:center;position:relative;isolation:isolate;background:var(--chakra-colors-bg-muted);--bg-currentcolor:var(--chakra-colors-bg-muted);}.css-eujb6n[data-orientation=vertical]{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}@media screen and (min-width: 48rem){.css-eujb6n{justify-self:left;width:auto;height:56px;}}@media screen and (min-width: 64rem){.css-eujb6n{justify-self:center;margin-left:104px;}}</style><div data-scope="segment-group" data-part="root" role="radiogroup" id="radio-group:«R2d6l3rtb»" aria-labelledby="radio-group:«R2d6l3rtb»:label" data-orientation="horizontal" aria-orientation="horizontal" dir="ltr" style="position:relative" class="chakra-segment-group__root css-eujb6n"><style data-emotion="css ydtx06">.css-ydtx06{background:var(--chakra-colors-white);--bg-currentcolor:var(--chakra-colors-white);border:1px solid #E4E4E7;box-shadow:0 4px 6px 0 rgba(0, 0, 0, 0.1);}@layer recipes{.css-ydtx06{box-shadow:var(--chakra-shadows-sm);position:absolute;width:var(--width);height:var(--height);top:var(--top);left:var(--left);z-index:-1;border-radius:var(--segment-radius);}.css-ydtx06:root .css-ydtx06,.light .css-ydtx06{background:var(--chakra-colors-bg);--bg-currentcolor:var(--chakra-colors-bg);}.dark .css-ydtx06,.dark .chakra-theme:not(.light) .css-ydtx06{background:var(--chakra-colors-bg-emphasized);--bg-currentcolor:var(--chakra-colors-bg-emphasized);}}</style><div id="radio-group:«R2d6l3rtb»:indicator" data-scope="segment-group" data-part="indicator" dir="ltr" data-orientation="horizontal" style="--transition-property:left, top, width, height;position:absolute;will-change:var(--transition-property);transition-property:var(--transition-property);transition-duration:0ms;transition-timing-function:var(--transition-timing-function);left:var(--left)" class="chakra-segment-group__indicator css-ydtx06"></div><style data-emotion="css 8gi34i">.css-8gi34i{width:calc(100% / 3);height:100%;cursor:pointer;}@layer recipes{.css-8gi34i{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;font-size:var(--chakra-font-sizes-sm);position:relative;color:var(--chakra-colors-fg);border-radius:var(--segment-radius);line-height:1.25rem;padding-inline:var(--chakra-spacing-4);gap:var(--chakra-spacing-2);height:var(--chakra-sizes-10);}.css-8gi34i:is(:disabled, [disabled], [data-disabled], [aria-disabled=true]){opacity:0.5;}.css-8gi34i:has(input:focus-visible){--focus-ring-color:var(--chakra-colors-color-palette-focus-ring);}.css-8gi34i:has(input:focus-visible):is(:focus, [data-focus]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}.css-8gi34i::before{content:"";position:absolute;background:var(--chakra-colors-border);--bg-currentcolor:var(--chakra-colors-border);-webkit-transition:opacity 0.2s;transition:opacity 0.2s;}.css-8gi34i[data-orientation=horizontal]::before{inset-inline-start:0;inset-block:var(--chakra-spacing-1\.5);width:1px;}.css-8gi34i[data-orientation=vertical]::before{inset-block-start:0;inset-inline:var(--chakra-spacing-1\.5);height:1px;}.css-8gi34i+.css-8gi34i[data-state=checked]::before,.css-8gi34i[data-state=checked]+.css-8gi34i::before,.css-8gi34i:first-of-type::before{opacity:0;}.css-8gi34i[data-state=checked][data-ssr]{box-shadow:var(--chakra-shadows-sm);background:var(--chakra-colors-bg);--bg-currentcolor:var(--chakra-colors-bg);border-radius:var(--segment-radius);}}@media screen and (min-width: 48rem){.css-8gi34i{width:162px;}}</style><label data-scope="segment-group" data-part="item" dir="ltr" id="radio-group:«R2d6l3rtb»:radio:scatterAll" for="radio-group:«R2d6l3rtb»:radio:input:scatterAll" data-state="checked" data-orientation="horizontal" data-ssr="" class="chakra-segment-group__item css-8gi34i"><span data-scope="segment-group" data-part="item-text" dir="ltr" id="radio-group:«R2d6l3rtb»:radio:label:scatterAll" data-state="checked" data-orientation="horizontal" data-ssr="" class="chakra-segment-group__itemText css-0"><style data-emotion="css 8gg8bx">.css-8gg8bx{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:var(--chakra-spacing-2);padding-inline:var(--chakra-spacing-4);padding-block:var(--chakra-spacing-2);position:absolute;top:0;left:0;right:0;bottom:0;color:var(--chakra-colors-gray-500);}@media screen and (min-width: 48rem){.css-8gg8bx{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><div class="chakra-stack css-8gg8bx"><style data-emotion="css 1qiwd9j">@layer recipes{.css-1qiwd9j{display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentcolor;vertical-align:middle;}}</style><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><title>All View</title><path d="M3 11C4.10457 11 5 10.1046 5 9C5 7.89543 4.10457 7 3 7C1.89543 7 1 7.89543 1 9C1 10.1046 1.89543 11 3 11Z" fill="currentColor"></path><path d="M9 5C10.1046 5 11 4.10457 11 3C11 1.89543 10.1046 1 9 1C7.89543 1 7 1.89543 7 3C7 4.10457 7.89543 5 9 5Z" fill="currentColor"></path><path d="M15 11C16.1046 11 17 10.1046 17 9C17 7.89543 16.1046 7 15 7C13.8954 7 13 7.89543 13 9C13 10.1046 13.8954 11 15 11Z" fill="currentColor"></path><path d="M21 5C22.1046 5 23 4.10457 23 3C23 1.89543 22.1046 1 21 1C19.8954 1 19 1.89543 19 3C19 4.10457 19.8954 5 21 5Z" fill="currentColor"></path><path d="M3 23C4.10457 23 5 22.1046 5 21C5 19.8954 4.10457 19 3 19C1.89543 19 1 19.8954 1 21C1 22.1046 1.89543 23 3 23Z" fill="currentColor"></path><path d="M9 17C10.1046 17 11 16.1046 11 15C11 13.8954 10.1046 13 9 13C7.89543 13 7 13.8954 7 15C7 16.1046 7.89543 17 9 17Z" fill="currentColor"></path><path d="M15 23C16.1046 23 17 22.1046 17 21C17 19.8954 16.1046 19 15 19C13.8954 19 13 19.8954 13 21C13 22.1046 13.8954 23 15 23Z" fill="currentColor"></path><path d="M21 17C22.1046 17 23 16.1046 23 15C23 13.8954 22.1046 13 21 13C19.8954 13 19 13.8954 19 15C19 16.1046 19.8954 17 21 17Z" fill="currentColor"></path></svg><style data-emotion="css my4acw">.css-my4acw{font-size:14px;font-weight:var(--chakra-font-weights-bold);line-height:1;text-wrap:nowrap;}@media screen and (min-width: 48rem){.css-my4acw{font-size:16px;}}</style><div class="css-my4acw">全体</div></div></span><input data-ownedby="radio-group:«R2d6l3rtb»" id="radio-group:«R2d6l3rtb»:radio:input:scatterAll" type="radio" style="border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap;word-wrap:normal" name="«R2d6l3rtb»" checked="" value="scatterAll"/></label><label data-scope="segment-group" data-part="item" dir="ltr" id="radio-group:«R2d6l3rtb»:radio:scatterDensity" for="radio-group:«R2d6l3rtb»:radio:input:scatterDensity" data-state="unchecked" data-orientation="horizontal" data-ssr="" class="chakra-segment-group__item css-8gi34i"><span data-scope="segment-group" data-part="item-text" dir="ltr" id="radio-group:«R2d6l3rtb»:radio:label:scatterDensity" data-state="unchecked" data-orientation="horizontal" data-ssr="" class="chakra-segment-group__itemText css-0"><div class="chakra-stack css-8gg8bx"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Dense View</title><path d="M3.5 11C4.88071 11 6 9.88071 6 8.5C6 7.11929 4.88071 6 3.5 6C2.11929 6 1 7.11929 1 8.5C1 9.88071 2.11929 11 3.5 11Z" fill="currentColor"></path><path d="M20.5 6C21.8807 6 23 4.88071 23 3.5C23 2.11929 21.8807 1 20.5 1C19.1193 1 18 2.11929 18 3.5C18 4.88071 19.1193 6 20.5 6Z" fill="currentColor"></path><path d="M14.5 23C15.8807 23 17 21.8807 17 20.5C17 19.1193 15.8807 18 14.5 18C13.1193 18 12 19.1193 12 20.5C12 21.8807 13.1193 23 14.5 23Z" fill="currentColor"></path></svg><style data-emotion="css fgouga">.css-fgouga{font-size:14px;font-weight:var(--chakra-font-weights-normal);line-height:1;text-wrap:nowrap;}@media screen and (min-width: 48rem){.css-fgouga{font-size:16px;}}</style><div class="css-fgouga">濃い意見</div></div></span><input data-ownedby="radio-group:«R2d6l3rtb»" id="radio-group:«R2d6l3rtb»:radio:input:scatterDensity" type="radio" style="border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap;word-wrap:normal" name="«R2d6l3rtb»" value="scatterDensity"/></label><label data-scope="segment-group" data-part="item" dir="ltr" id="radio-group:«R2d6l3rtb»:radio:treemap" for="radio-group:«R2d6l3rtb»:radio:input:treemap" data-state="unchecked" data-orientation="horizontal" data-ssr="" class="chakra-segment-group__item css-8gi34i"><span data-scope="segment-group" data-part="item-text" dir="ltr" id="radio-group:«R2d6l3rtb»:radio:label:treemap" data-state="unchecked" data-orientation="horizontal" data-ssr="" class="chakra-segment-group__itemText css-0"><div class="chakra-stack css-8gg8bx"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Hierarchy View</title><rect x="7" y="12" width="15" height="10" rx="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><rect x="2" y="2" width="10" height="10" rx="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect><rect x="12" y="2" width="7" height="10" rx="2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></rect></svg><div class="css-fgouga">階層</div></div></span><input data-ownedby="radio-group:«R2d6l3rtb»" id="radio-group:«R2d6l3rtb»:radio:input:treemap" type="radio" style="border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap;word-wrap:normal" name="«R2d6l3rtb»" value="treemap"/></label></div><style data-emotion="css fmdzs9">.css-fmdzs9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;gap:var(--chakra-spacing-1);justify-self:end;-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;}</style><div class="chakra-stack css-fmdzs9"><style data-emotion="css 17mydn8">.css-17mydn8{height:50px;width:50px;padding:0;}@layer recipes{.css-17mydn8{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;border-radius:var(--chakra-radii-l2);white-space:nowrap;vertical-align:middle;border-width:1px;border-color:var(--chakra-colors-color-palette-muted);cursor:var(--chakra-cursor-button);-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;outline:0;line-height:1.25rem;isolation:isolate;font-weight:var(--chakra-font-weights-medium);transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,translate,transform;transition-duration:var(--chakra-durations-moderate);--focus-ring-color:var(--chakra-colors-color-palette-focus-ring);height:var(--chakra-sizes-10);min-width:var(--chakra-sizes-10);font-size:var(--chakra-font-sizes-sm);padding-inline:var(--chakra-spacing-4);gap:var(--chakra-spacing-2);color:var(--chakra-colors-color-palette-fg);}.css-17mydn8:is(:focus-visible, [data-focus-visible]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}.css-17mydn8:is(:disabled, [disabled], [data-disabled], [aria-disabled=true]){opacity:0.5;cursor:not-allowed;}.css-17mydn8 :where(svg){-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:var(--chakra-sizes-5);height:var(--chakra-sizes-5);}.css-17mydn8:is([aria-expanded=true], [data-expanded], [data-state=expanded]){background:var(--chakra-colors-color-palette-subtle);--bg-currentcolor:var(--chakra-colors-color-palette-subtle);}@media (hover: hover){.css-17mydn8:is(:hover, [data-hover]):not(:disabled, [data-disabled]){background:var(--chakra-colors-color-palette-subtle);--bg-currentcolor:var(--chakra-colors-color-palette-subtle);}}}</style><button type="button" data-scope="tooltip" data-part="trigger" id="tooltip:«Ral6l3rtb»:trigger" dir="ltr" data-state="closed" class="chakra-button chakra-tooltip__trigger css-17mydn8"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-cog chakra-icon css-1qiwd9j" focusable="false" aria-hidden="true"><path d="M12 20a8 8 0 1 0 0-16 8 8 0 0 0 0 16Z"></path><path d="M12 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z"></path><path d="M12 2v2"></path><path d="M12 22v-2"></path><path d="m17 20.66-1-1.73"></path><path d="M11 10.27 7 3.34"></path><path d="m20.66 17-1.73-1"></path><path d="m3.34 7 1.73 1"></path><path d="M14 12h8"></path><path d="M2 12h2"></path><path d="m20.66 7-1.73 1"></path><path d="m3.34 17 1.73-1"></path><path d="m17 3.34-1 1.73"></path><path d="m11 13.73-4 6.93"></path></svg></button><button type="button" data-scope="tooltip" data-part="trigger" id="tooltip:«Rel6l3rtb»:trigger" dir="ltr" data-state="closed" class="chakra-button chakra-tooltip__trigger css-17mydn8"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-fullscreen chakra-icon css-1qiwd9j" focusable="false" aria-hidden="true"><path d="M3 7V5a2 2 0 0 1 2-2h2"></path><path d="M17 3h2a2 2 0 0 1 2 2v2"></path><path d="M21 17v2a2 2 0 0 1-2 2h-2"></path><path d="M7 21H5a2 2 0 0 1-2-2v-2"></path><rect width="10" height="8" x="7" y="8" rx="1"></rect></svg></button></div></div></div><style data-emotion="css 116lysx">.css-116lysx{margin-inline:auto;width:100%;max-width:1200px;margin-bottom:var(--chakra-spacing-10);border:1px solid #ccc;}</style><div class="css-116lysx"><style data-emotion="css 6at9a9">.css-6at9a9{height:500px;margin-bottom:0;}</style><div class="css-6at9a9"><style data-emotion="css 1v8gcgw">.css-1v8gcgw{width:100%;height:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}</style><div class="css-1v8gcgw"><style data-emotion="css 1jlnwea">.css-1jlnwea{position:relative;-webkit-flex:1;-ms-flex:1;flex:1;}</style><div class="css-1jlnwea"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><style data-emotion="css 1ztrau">.css-1ztrau{margin-inline:auto;padding:var(--chakra-spacing-5);max-width:800px;--chakra-colors-color-palette-50:var(--chakra-colors-cyan-50);--chakra-colors-color-palette-100:var(--chakra-colors-cyan-100);--chakra-colors-color-palette-200:var(--chakra-colors-cyan-200);--chakra-colors-color-palette-300:var(--chakra-colors-cyan-300);--chakra-colors-color-palette-400:var(--chakra-colors-cyan-400);--chakra-colors-color-palette-500:var(--chakra-colors-cyan-500);--chakra-colors-color-palette-600:var(--chakra-colors-cyan-600);--chakra-colors-color-palette-700:var(--chakra-colors-cyan-700);--chakra-colors-color-palette-800:var(--chakra-colors-cyan-800);--chakra-colors-color-palette-900:var(--chakra-colors-cyan-900);--chakra-colors-color-palette-950:var(--chakra-colors-cyan-950);--chakra-colors-color-palette-contrast:var(--chakra-colors-cyan-contrast);--chakra-colors-color-palette-fg:var(--chakra-colors-cyan-fg);--chakra-colors-color-palette-subtle:var(--chakra-colors-cyan-subtle);--chakra-colors-color-palette-muted:var(--chakra-colors-cyan-muted);--chakra-colors-color-palette-emphasized:var(--chakra-colors-cyan-emphasized);--chakra-colors-color-palette-solid:var(--chakra-colors-cyan-solid);--chakra-colors-color-palette-focus-ring:var(--chakra-colors-cyan-focus-ring);}@layer recipes{.css-1ztrau{font-size:var(--chakra-font-sizes-sm);line-height:1.25rem;position:relative;}}</style><div dir="ltr" data-scope="progress" data-part="root" id="progress-«R1al8l3rtb»" data-max="100" data-state="indeterminate" data-orientation="horizontal" class="chakra-progress__root css-1ztrau"><style data-emotion="css 64k0s4">.css-64k0s4{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;gap:var(--chakra-spacing-5);}</style><div class="chakra-stack css-64k0s4"><style data-emotion="css 19ou3zc">.css-19ou3zc{-webkit-flex:1;-ms-flex:1;flex:1;}@layer recipes{.css-19ou3zc{overflow:hidden;position:relative;box-shadow:var(--chakra-shadows-inset);background-color:var(--chakra-colors-bg-muted);--bg-currentcolor:var(--chakra-colors-bg-muted);height:var(--chakra-sizes-4);border-radius:var(--chakra-radii-l1);}}</style><div dir="ltr" id="progress-«R1al8l3rtb»-track" data-scope="progress" data-part="track" role="progressbar" aria-label="loading..." data-max="100" aria-valuemin="0" aria-valuemax="100" data-orientation="horizontal" data-state="indeterminate" class="chakra-progress__track css-19ou3zc"><style data-emotion="css i9zykr">@layer recipes{.css-i9zykr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;transition-property:width,height;transition-duration:var(--chakra-durations-slow);height:100%;background-color:var(--chakra-colors-color-palette-solid);--bg-currentcolor:var(--chakra-colors-color-palette-solid);}.css-i9zykr:is(:indeterminate, [data-indeterminate], [aria-checked=mixed], [data-state=indeterminate]){--animate-from-x:-40%;--animate-to-x:100%;position:absolute;will-change:left;min-width:50%;-webkit-animation:position 1s ease infinite normal none running;animation:position 1s ease infinite normal none running;background-image:linear-gradient(to right, transparent 0%, var(--track-color) 50%, transparent 100%);}}</style><div dir="ltr" data-scope="progress" data-part="range" data-orientation="horizontal" data-state="indeterminate" class="chakra-progress__range css-i9zykr"></div></div><style data-emotion="css ntdy8p">@layer recipes{.css-ntdy8p{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;font-weight:var(--chakra-font-weights-medium);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:var(--chakra-spacing-1);}}</style><label dir="ltr" id="progress-«R1al8l3rtb»-label" data-scope="progress" data-part="label" data-orientation="horizontal" class="chakra-progress__label css-ntdy8p">Visualizing...</label></div></div><!--/$--></div></div></div></div><style data-emotion="css 1b8t3l2">.css-1b8t3l2{margin-inline:auto;max-width:750px;margin-bottom:var(--chakra-spacing-12);}</style><div class="css-1b8t3l2"><style data-emotion="css c1sqso">.css-c1sqso{margin-bottom:var(--chakra-spacing-2);}</style><div class="css-c1sqso"><style data-emotion="css 1q3iou7">.css-1q3iou7{position:relative;}@layer recipes{.css-1q3iou7{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;outline:none;gap:var(--chakra-spacing-1\.5);cursor:pointer;border-radius:var(--chakra-radii-l1);--focus-ring-color:var(--chakra-colors-color-palette-focus-ring);color:var(--chakra-colors-color-palette-fg);}.css-1q3iou7:is(:focus, [data-focus]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}@media (hover: hover){.css-1q3iou7:is(:hover, [data-hover]):not(:disabled, [data-disabled]){-webkit-text-decoration:underline;text-decoration:underline;text-underline-offset:3px;--mix-textDecorationColor:color-mix(in srgb, currentColor 20%, transparent);text-decoration-color:var(--mix-textDecorationColor, currentColor);}}}@media (hover: hover){.css-1q3iou7:is(:hover, [data-hover]):not(:disabled, [data-disabled]):before{content:"#";font-size:var(--chakra-font-sizes-2xl);position:absolute;left:-1.4rem;}}</style><a id="舞鶴市の観光振興と交通利便性向上による地域活性化" href="#舞鶴市の観光振興と交通利便性向上による地域活性化" class="chakra-link headingColor css-1q3iou7"><style data-emotion="css 1pbrf1e">.css-1pbrf1e{font-size:var(--chakra-font-sizes-2xl);margin-bottom:0;}@layer recipes{.css-1pbrf1e{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-font-weights-semibold);font-size:var(--chakra-font-sizes-xl);line-height:1.875rem;}}</style><h2 class="chakra-heading css-1pbrf1e">舞鶴市の観光振興と交通利便性向上による地域活性化</h2></a><style data-emotion="css 18jnlh3">.css-18jnlh3{font-weight:var(--chakra-font-weights-bold);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:var(--chakra-spacing-1);margin-top:var(--chakra-spacing-2);}</style><p class="css-18jnlh3"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-messages-square"><path d="M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z"></path><path d="M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"></path></svg>20<!-- -->件</p></div><p class="css-0">舞鶴市の観光業を赤レンガや地域資源を活用して振興し、観光客の増加を目指すとともに、交通インフラの充実を図ることで、地域全体の活性化を促進することが求められています。具体的には、公共交通機関の本数を増やし、通勤者の利便性を向上させる施策や、地域の魅力を引き出すための子育て支援の強化が重要視されています。これにより、舞鶴市が住み続けたいと思える地域となり、人口増加や地域発展が期待されています。</p></div><div class="css-1b8t3l2"><div class="css-c1sqso"><a id="地域経済の活性化とコミュニティの再生に向けた多様な取り組み" href="#地域経済の活性化とコミュニティの再生に向けた多様な取り組み" class="chakra-link headingColor css-1q3iou7"><h2 class="chakra-heading css-1pbrf1e">地域経済の活性化とコミュニティの再生に向けた多様な取り組み</h2></a><p class="css-18jnlh3"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-messages-square"><path d="M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z"></path><path d="M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"></path></svg>16<!-- -->件</p></div><p class="css-0">地域の商業活動を活性化させるために、大型商業施設やアウトレットの誘致を進めるとともに、市民が利用できる無料のコワーキングスペースや休憩スペースの創出が求められています。また、地域の芸術活動を促進し、自主運営の場を提供することで、地域社会のつながりを深めることが重要視されています。さらに、企業誘致のための税制優遇や、地域企業の技術力向上を図ることで、理系学生のUターンを促進し、地域の雇用問題の解決にも寄与することが期待されています。</p></div><div class="css-1b8t3l2"><div class="css-c1sqso"><a id="地域全体で支える子育てと医療の充実" href="#地域全体で支える子育てと医療の充実" class="chakra-link headingColor css-1q3iou7"><h2 class="chakra-heading css-1pbrf1e">地域全体で支える子育てと医療の充実</h2></a><p class="css-18jnlh3"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-messages-square"><path d="M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z"></path><path d="M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"></path></svg>15<!-- -->件</p></div><p class="css-0">子育て世帯が生活しやすくなるための具体的な施策や、包括的な医療体制の構築が求められています。子育て支援金や病児保育の充実、医療機関の統合と専門性の強化を通じて、少子高齢化対策を進めることが重要です。また、結婚支援や地域活性化のための支援策、補助金活用のための意見収集システムの構築も必要とされ、地域全体で子どもや家庭を支える環境を整えることが求められています。</p></div><div class="css-1b8t3l2"><div class="css-c1sqso"><a id="地域資源を活用した教育環境の充実と健康志向の推進" href="#地域資源を活用した教育環境の充実と健康志向の推進" class="chakra-link headingColor css-1q3iou7"><h2 class="chakra-heading css-1pbrf1e">地域資源を活用した教育環境の充実と健康志向の推進</h2></a><p class="css-18jnlh3"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-messages-square"><path d="M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z"></path><path d="M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"></path></svg>12<!-- -->件</p></div><p class="css-0">地域の特性を活かした教育と食育の連携を強化し、地元の資源を活用した学校給食の地産地消やオーガニック化を推進することで、子供たちが健康的に成長できる環境を整えます。また、教育者の道徳的責任を重視し、指導者の育成や生涯学習の仕組みを構築することで、全世代が参加できる教育環境の質を向上させることが求められています。</p></div><div class="css-1b8t3l2"><div class="css-c1sqso"><a id="世代を超えた交流と安全な観光環境の整備" href="#世代を超えた交流と安全な観光環境の整備" class="chakra-link headingColor css-1q3iou7"><h2 class="chakra-heading css-1pbrf1e">世代を超えた交流と安全な観光環境の整備</h2></a><p class="css-18jnlh3"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-messages-square"><path d="M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z"></path><path d="M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"></path></svg>7<!-- -->件</p></div><p class="css-0">高齢者や子供が安全に観光を楽しむためのアクセス改善と、世代を超えた人々が交流できる働く場所の確保が求められています。特に、通行止めとなっているケーブルの改善や高潮対策が重要視されており、これにより観光地の安全性が向上します。また、60代以上の高齢者や女性がそれぞれのライフステージに応じて活躍できる環境を整えることで、より多様な働き方が実現され、全ての人が生き生きと暮らせる社会の形成が期待されています。</p></div></div><style data-emotion="css 1o1m1e9">.css-1o1m1e9{margin-inline:auto;max-width:750px;margin-bottom:var(--chakra-spacing-12);cursor:default;}</style><div class="css-1o1m1e9"><style data-emotion="css 18e2hlm">.css-18e2hlm{margin-top:var(--chakra-spacing-20);margin-bottom:var(--chakra-spacing-12);}@layer recipes{.css-18e2hlm{display:block;border-color:var(--chakra-colors-border);--separator-thickness:1px;border-style:solid;border-top-width:var(--separator-thickness);}}</style><span role="separator" aria-orientation="horizontal" class="chakra-separator css-18e2hlm"></span><style data-emotion="css cmij8f">.css-cmij8f{text-align:center;font-size:var(--chakra-font-sizes-xl);margin-bottom:var(--chakra-spacing-5);}@layer recipes{.css-cmij8f{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-font-weights-semibold);font-size:var(--chakra-font-sizes-xl);line-height:1.875rem;}}</style><h2 class="chakra-heading css-cmij8f">分析の概要</h2><style data-emotion="css 1iyrt3k">.css-1iyrt3k{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;gap:0.5rem;margin-bottom:var(--chakra-spacing-5);}</style><div class="chakra-stack css-1iyrt3k"><style data-emotion="css r2vxxm">.css-r2vxxm{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:0;width:200px;}</style><div class="chakra-stack chakra-tooltip__trigger css-r2vxxm" data-scope="tooltip" data-part="trigger" id="tooltip:«Rcst3rtb»:trigger" dir="ltr" data-state="closed"><style data-emotion="css 130utcn">.css-130utcn{margin-bottom:var(--chakra-spacing-2);}@layer recipes{.css-130utcn{display:inline-block;line-height:1em;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;color:currentcolor;vertical-align:middle;}}</style><svg xmlns="http://www.w3.org/2000/svg" width="30px" height="30px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle-warning chakra-icon css-130utcn" focusable="false" aria-hidden="true"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path><path d="M12 8v4"></path><path d="M12 16h.01"></path></svg><style data-emotion="css 37e2li">.css-37e2li{font-size:var(--chakra-font-sizes-3xl);font-weight:var(--chakra-font-weights-bold);line-height:1;margin-bottom:var(--chakra-spacing-1);}</style><p class="headingColor css-37e2li">124</p><style data-emotion="css 1auzp06">.css-1auzp06{font-size:var(--chakra-font-sizes-xs);}</style><p class="css-1auzp06">コメント数</p></div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right"><path d="m9 18 6-6-6-6"></path></svg><div class="chakra-stack chakra-tooltip__trigger css-r2vxxm" data-scope="tooltip" data-part="trigger" id="tooltip:«Rsst3rtb»:trigger" dir="ltr" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="30px" height="30px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-messages-square chakra-icon css-130utcn" focusable="false" aria-hidden="true"><path d="M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z"></path><path d="M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"></path></svg><p class="headingColor css-37e2li">70</p><p class="css-1auzp06">抽出した意見数</p></div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-right"><path d="m9 18 6-6-6-6"></path></svg><div class="chakra-stack chakra-tooltip__trigger css-r2vxxm" data-scope="tooltip" data-part="trigger" id="tooltip:«R1cst3rtb»:trigger" dir="ltr" data-state="closed"><svg xmlns="http://www.w3.org/2000/svg" width="30px" height="30px" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard-check chakra-icon css-130utcn" focusable="false" aria-hidden="true"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"></rect><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><path d="m9 14 2 2 4-4"></path></svg><style data-emotion="css 6cpqb8">.css-6cpqb8{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;gap:var(--chakra-spacing-1);}</style><div class="chakra-stack css-6cpqb8"><p class="headingColor css-37e2li">5</p><style data-emotion="css mq9eh">.css-mq9eh{font-size:var(--chakra-font-sizes-md);}</style><p class="css-mq9eh">→</p><p class="headingColor css-37e2li">25</p></div><p class="css-1auzp06">集約した意見グループ数</p></div></div><style data-emotion="css cj6llo">.css-cj6llo{margin-bottom:var(--chakra-spacing-5);}</style><p class="css-cj6llo">（例）教育環境を充実させる。公共交通を充実させる。産業を発展させる。等々
分析対象となったデータの件数は124件で、これらのデータに対してOpenAI API (gpt-4o-mini)を用いて70件の意見（議論）を抽出し、クラスタリングを行った。
</p><div class="css-0"><style data-emotion="css 1shpirj">.css-1shpirj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:var(--chakra-spacing-5);}</style><div class="css-1shpirj"><style data-emotion="css 12foufc">.css-12foufc{font-size:var(--chakra-font-sizes-md);}@layer recipes{.css-12foufc{font-family:var(--chakra-fonts-heading);font-weight:var(--chakra-font-weights-semibold);font-size:var(--chakra-font-sizes-xl);line-height:1.875rem;}}</style><h2 class="chakra-heading css-12foufc">分析手順</h2><style data-emotion="css 1hgzy19">.css-1hgzy19{margin-left:var(--chakra-spacing-2);}@layer recipes{.css-1hgzy19{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;border-radius:var(--chakra-radii-l2);white-space:nowrap;vertical-align:middle;border-width:1px;border-color:var(--chakra-colors-color-palette-muted);cursor:var(--chakra-cursor-button);-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;outline:0;line-height:1.25rem;isolation:isolate;font-weight:var(--chakra-font-weights-medium);transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,translate,transform;transition-duration:var(--chakra-durations-moderate);--focus-ring-color:var(--chakra-colors-color-palette-focus-ring);height:var(--chakra-sizes-9);min-width:var(--chakra-sizes-9);padding-inline:var(--chakra-spacing-3\.5);font-size:var(--chakra-font-sizes-sm);gap:var(--chakra-spacing-2);color:var(--chakra-colors-color-palette-fg);}.css-1hgzy19:is(:focus-visible, [data-focus-visible]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}.css-1hgzy19:is(:disabled, [disabled], [data-disabled], [aria-disabled=true]){opacity:0.5;cursor:not-allowed;}.css-1hgzy19 :where(svg){-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:var(--chakra-sizes-4);height:var(--chakra-sizes-4);}.css-1hgzy19:is([aria-expanded=true], [data-expanded], [data-state=expanded]){background:var(--chakra-colors-color-palette-subtle);--bg-currentcolor:var(--chakra-colors-color-palette-subtle);}@media (hover: hover){.css-1hgzy19:is(:hover, [data-hover]):not(:disabled, [data-disabled]){background:var(--chakra-colors-color-palette-subtle);--bg-currentcolor:var(--chakra-colors-color-palette-subtle);}}}</style><button type="button" class="chakra-button css-1hgzy19">表示</button></div><div class="css-0" data-state="closed" hidden="" data-scope="presence" data-part="root"><style data-emotion="css 1a001f1">@layer recipes{.css-1a001f1{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:var(--chakra-sizes-full);--timeline-thickness:1px;--timeline-gutter:4px;--timeline-indicator-size:var(--chakra-sizes-6);--timeline-font-size:var(--chakra-font-sizes-xs);}}</style><div role="list" class="chakra-timeline__root css-1a001f1"><style data-emotion="css 1dy84gp">@layer recipes{.css-1dy84gp{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:relative;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;gap:var(--chakra-spacing-4);}.css-1dy84gp:last-of-type :where(.chakra-timeline__separator){display:none;}}</style><div role="listitem" class="chakra-timeline__item css-1dy84gp"><style data-emotion="css 1aqa645">@layer recipes{.css-1aqa645{-webkit-align-self:stretch;-ms-flex-item-align:stretch;align-self:stretch;position:relative;}}</style><div class="chakra-timeline__connector css-1aqa645"><style data-emotion="css 125t34c">@layer recipes{.css-125t34c{position:absolute;border-inline-start-width:var(--timeline-thickness);-webkit-margin-start:calc(-1 * var(--timeline-thickness) / 2);margin-inline-start:calc(-1 * var(--timeline-thickness) / 2);inset-inline-start:calc(var(--timeline-indicator-size) / 2);inset-block:0;border-color:var(--chakra-colors-border);}}</style><div class="chakra-timeline__separator css-125t34c"></div><style data-emotion="css i15w5k">@layer recipes{.css-i15w5k{outline:2px solid var(--chakra-colors-bg);position:relative;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:var(--timeline-indicator-size);height:var(--timeline-indicator-size);font-size:var(--timeline-font-size);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;border-radius:var(--chakra-radii-full);font-weight:var(--chakra-font-weights-medium);background:var(--chakra-colors-color-palette-solid);--bg-currentcolor:var(--chakra-colors-color-palette-solid);color:var(--chakra-colors-color-palette-contrast);}}</style><div class="chakra-timeline__indicator css-i15w5k"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-arrow-down"><circle cx="12" cy="12" r="10"></circle><path d="M12 8v8"></path><path d="m8 12 4 4 4-4"></path></svg></div></div><style data-emotion="css qe3ut8">@layer recipes{.css-qe3ut8{padding-bottom:var(--chakra-spacing-6);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:var(--chakra-sizes-full);gap:var(--chakra-spacing-2);}}</style><div class="chakra-timeline__content css-qe3ut8"><style data-emotion="css oo9l53">.css-oo9l53{font-weight:var(--chakra-font-weights-bold);}@layer recipes{.css-oo9l53{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;font-weight:var(--chakra-font-weights-medium);-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;gap:var(--chakra-spacing-1\.5);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-top:var(--chakra-spacing-0\.5);font-size:var(--chakra-font-sizes-sm);line-height:1.25rem;}}</style><div class="chakra-timeline__title css-oo9l53">抽出 (<!-- -->gpt-4o-mini<!-- -->)</div><style data-emotion="css 1p340iu">@layer recipes{.css-1p340iu{color:var(--chakra-colors-fg-muted);font-size:var(--chakra-font-sizes-xs);line-height:1rem;}}</style><div class="chakra-timeline__description css-1p340iu">コメントデータから意見を抽出するステップです。<br/></div><style data-emotion="css 1igwmid">.css-1igwmid{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;gap:0.5rem;}</style><div class="chakra-stack css-1igwmid"><style data-emotion="css scamzs">@layer recipes{.css-scamzs{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;border-radius:var(--chakra-radii-l2);white-space:nowrap;vertical-align:middle;border-width:1px;border-color:var(--chakra-colors-color-palette-muted);cursor:var(--chakra-cursor-button);-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;outline:0;line-height:1rem;isolation:isolate;font-weight:var(--chakra-font-weights-medium);transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,translate,transform;transition-duration:var(--chakra-durations-moderate);--focus-ring-color:var(--chakra-colors-color-palette-focus-ring);height:var(--chakra-sizes-8);min-width:var(--chakra-sizes-8);font-size:var(--chakra-font-sizes-xs);padding-inline:var(--chakra-spacing-2\.5);gap:var(--chakra-spacing-1);color:var(--chakra-colors-color-palette-fg);}.css-scamzs:is(:focus-visible, [data-focus-visible]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}.css-scamzs:is(:disabled, [disabled], [data-disabled], [aria-disabled=true]){opacity:0.5;cursor:not-allowed;}.css-scamzs :where(svg){-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:var(--chakra-sizes-4);height:var(--chakra-sizes-4);}.css-scamzs:is([aria-expanded=true], [data-expanded], [data-state=expanded]){background:var(--chakra-colors-color-palette-subtle);--bg-currentcolor:var(--chakra-colors-color-palette-subtle);}@media (hover: hover){.css-scamzs:is(:hover, [data-hover]):not(:disabled, [data-disabled]){background:var(--chakra-colors-color-palette-subtle);--bg-currentcolor:var(--chakra-colors-color-palette-subtle);}}}</style><button type="button" class="chakra-button css-scamzs">ソースコード</button><button type="button" class="chakra-button css-scamzs">プロンプト</button></div></div></div><div role="listitem" class="chakra-timeline__item css-1dy84gp"><div class="chakra-timeline__connector css-1aqa645"><div class="chakra-timeline__separator css-125t34c"></div><div class="chakra-timeline__indicator css-i15w5k"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-arrow-down"><circle cx="12" cy="12" r="10"></circle><path d="M12 8v8"></path><path d="m8 12 4 4 4-4"></path></svg></div></div><div class="chakra-timeline__content css-qe3ut8"><div class="chakra-timeline__title css-oo9l53">埋め込み (<!-- -->text-embedding-3-small<!-- -->)</div><div class="chakra-timeline__description css-1p340iu">抽出された意見に対して埋め込み（ベクトル表現）を生成するステップです。<br/>これにより、意見の内容を数値ベクトルとして表現します。</div><div class="chakra-stack css-1igwmid"><button type="button" class="chakra-button css-scamzs">ソースコード</button></div></div></div><div role="listitem" class="chakra-timeline__item css-1dy84gp"><div class="chakra-timeline__connector css-1aqa645"><div class="chakra-timeline__separator css-125t34c"></div><div class="chakra-timeline__indicator css-i15w5k"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-arrow-down"><circle cx="12" cy="12" r="10"></circle><path d="M12 8v8"></path><path d="m8 12 4 4 4-4"></path></svg></div></div><div class="chakra-timeline__content css-qe3ut8"><div class="chakra-timeline__title css-oo9l53">意見グループ化</div><div class="chakra-timeline__description css-1p340iu">埋め込みベクトルの値に基づいて意見の意見グループ化を行うステップです。<br/></div><div class="chakra-stack css-1igwmid"><button type="button" class="chakra-button css-scamzs">ソースコード</button></div></div></div><div role="listitem" class="chakra-timeline__item css-1dy84gp"><div class="chakra-timeline__connector css-1aqa645"><div class="chakra-timeline__separator css-125t34c"></div><div class="chakra-timeline__indicator css-i15w5k"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-arrow-down"><circle cx="12" cy="12" r="10"></circle><path d="M12 8v8"></path><path d="m8 12 4 4 4-4"></path></svg></div></div><div class="chakra-timeline__content css-qe3ut8"><div class="chakra-timeline__title css-oo9l53">初期ラベリング (<!-- -->gpt-4o-mini<!-- -->)</div><div class="chakra-timeline__description css-1p340iu">意見グループ化の結果に対して、各意見グループに適切なタイトル・説明文を生成（ラベリング）するステップです。<br/>このステップでは、最も細かい粒度の意見グループ（最下層の意見グループ）に対して、各意見グループに属する意見に基づいて意見グループのタイトルと説明文を生成します。</div><div class="chakra-stack css-1igwmid"><button type="button" class="chakra-button css-scamzs">ソースコード</button><button type="button" class="chakra-button css-scamzs">プロンプト</button></div></div></div><div role="listitem" class="chakra-timeline__item css-1dy84gp"><div class="chakra-timeline__connector css-1aqa645"><div class="chakra-timeline__separator css-125t34c"></div><div class="chakra-timeline__indicator css-i15w5k"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-arrow-down"><circle cx="12" cy="12" r="10"></circle><path d="M12 8v8"></path><path d="m8 12 4 4 4-4"></path></svg></div></div><div class="chakra-timeline__content css-qe3ut8"><div class="chakra-timeline__title css-oo9l53">統合ラベリング (<!-- -->gpt-4o-mini<!-- -->)</div><div class="chakra-timeline__description css-1p340iu">意見グループを統合し、統合されたグループのタイトルと説明文を生成（ラベリング）するステップです。<br/>このステップでは、下層の意見グループのタイトル及び説明文と、意見に基づいて上層の意見グループのタイトル及び説明文を生成します。</div><div class="chakra-stack css-1igwmid"><button type="button" class="chakra-button css-scamzs">ソースコード</button><button type="button" class="chakra-button css-scamzs">プロンプト</button></div></div></div><div role="listitem" class="chakra-timeline__item css-1dy84gp"><div class="chakra-timeline__connector css-1aqa645"><div class="chakra-timeline__separator css-125t34c"></div><div class="chakra-timeline__indicator css-i15w5k"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-arrow-down"><circle cx="12" cy="12" r="10"></circle><path d="M12 8v8"></path><path d="m8 12 4 4 4-4"></path></svg></div></div><div class="chakra-timeline__content css-qe3ut8"><div class="chakra-timeline__title css-oo9l53">要約 (<!-- -->gpt-4o-mini<!-- -->)</div><div class="chakra-timeline__description css-1p340iu">意見グループの概要を作成するステップです。<br/>各意見グループのタイトル及び説明文をもとに、全体の概要をまとめます。</div><div class="chakra-stack css-1igwmid"><button type="button" class="chakra-button css-scamzs">ソースコード</button><button type="button" class="chakra-button css-scamzs">プロンプト</button></div></div></div><div role="listitem" class="chakra-timeline__item css-1dy84gp"><div class="chakra-timeline__connector css-1aqa645"><div class="chakra-timeline__separator css-125t34c"></div><div class="chakra-timeline__indicator css-i15w5k"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-arrow-down"><circle cx="12" cy="12" r="10"></circle><path d="M12 8v8"></path><path d="m8 12 4 4 4-4"></path></svg></div></div><div class="chakra-timeline__content css-qe3ut8"><div class="chakra-timeline__title css-oo9l53">出力</div><div class="chakra-timeline__description css-1p340iu">最終的な結果を出力するステップです。<br/>意見および各分析結果を含むJSONファイルを出力します。</div><div class="chakra-stack css-1igwmid"><button type="button" class="chakra-button css-scamzs">ソースコード</button></div></div></div><div role="listitem" class="chakra-timeline__item css-1dy84gp"><div class="chakra-timeline__connector css-1aqa645"><div class="chakra-timeline__separator css-125t34c"></div><div class="chakra-timeline__indicator css-i15w5k"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-arrow-down"><circle cx="12" cy="12" r="10"></circle><path d="M12 8v8"></path><path d="m8 12 4 4 4-4"></path></svg></div></div><div class="chakra-timeline__content css-qe3ut8"><div class="chakra-timeline__title css-oo9l53">表示</div><div class="chakra-timeline__description css-1p340iu">出力されたJSONファイルをグラフィカルに表示するステップです。<br/>意見グループの概要、意見の内容などを可視化します。あなたが見ているこの画面が出来上がります。</div><div class="chakra-stack css-1igwmid"><button type="button" class="chakra-button css-scamzs">ソースコード</button></div></div></div></div></div></div><style data-emotion="css q8f4jk">@layer recipes{.css-q8f4jk{background:var(--chakra-colors-black-alpha-500);--bg-currentcolor:var(--chakra-colors-black-alpha-500);position:fixed;inset-inline-start:0;top:0;width:100vw;height:100dvh;z-index:var(--chakra-z-index-overlay);}.css-q8f4jk:is([open], [data-open], [data-state=open]){-webkit-animation-name:fade-in;animation-name:fade-in;-webkit-animation-duration:var(--chakra-durations-slow);animation-duration:var(--chakra-durations-slow);}.css-q8f4jk:is([closed], [data-closed], [data-state=closed]){-webkit-animation-name:fade-out;animation-name:fade-out;-webkit-animation-duration:var(--chakra-durations-moderate);animation-duration:var(--chakra-durations-moderate);}}</style><style data-emotion="css 12830yj">@layer recipes{.css-12830yj{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100vw;height:100dvh;position:fixed;inset-inline-start:0;top:0;z-index:var(--chakra-z-index-modal);overscroll-behavior-y:none;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;}}</style></div><style data-emotion="css whetvv">.css-whetvv{width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;margin-inline:auto;}</style><div class="css-whetvv"><a href="/kouchou-ai-reports/"><style data-emotion="css 1ocnt5x">@layer recipes{.css-1ocnt5x{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;border-radius:var(--chakra-radii-l2);white-space:nowrap;vertical-align:middle;border-width:1px;border-color:var(--chakra-colors-color-palette-muted);cursor:var(--chakra-cursor-button);-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;outline:0;line-height:1.25rem;isolation:isolate;font-weight:var(--chakra-font-weights-medium);transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,translate,transform;transition-duration:var(--chakra-durations-moderate);--focus-ring-color:var(--chakra-colors-color-palette-focus-ring);height:var(--chakra-sizes-10);min-width:var(--chakra-sizes-10);font-size:var(--chakra-font-sizes-sm);padding-inline:var(--chakra-spacing-4);gap:var(--chakra-spacing-2);color:var(--chakra-colors-color-palette-fg);}.css-1ocnt5x:is(:focus-visible, [data-focus-visible]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}.css-1ocnt5x:is(:disabled, [disabled], [data-disabled], [aria-disabled=true]){opacity:0.5;cursor:not-allowed;}.css-1ocnt5x :where(svg){-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:var(--chakra-sizes-5);height:var(--chakra-sizes-5);}.css-1ocnt5x:is([aria-expanded=true], [data-expanded], [data-state=expanded]){background:var(--chakra-colors-color-palette-subtle);--bg-currentcolor:var(--chakra-colors-color-palette-subtle);}@media (hover: hover){.css-1ocnt5x:is(:hover, [data-hover]):not(:disabled, [data-disabled]){background:var(--chakra-colors-color-palette-subtle);--bg-currentcolor:var(--chakra-colors-color-palette-subtle);}}}</style><button type="button" class="chakra-button css-1ocnt5x"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevron-left"><path d="m15 18-6-6 6-6"></path></svg>一覧へ戻る</button></a></div><style data-emotion="css 16rnmml">.css-16rnmml{margin-block:var(--chakra-spacing-12);max-width:750px;margin-inline:auto;}@layer recipes{.css-16rnmml{display:block;border-color:var(--chakra-colors-border);--separator-thickness:1px;border-style:solid;border-top-width:var(--separator-thickness);}}</style><span role="separator" aria-orientation="horizontal" class="chakra-separator css-16rnmml"></span><style data-emotion="css 1etwhu0">.css-1etwhu0{max-width:750px;margin-inline:auto;margin-bottom:var(--chakra-spacing-24);}</style><div class="css-1etwhu0"><style data-emotion="css 4ovtr5">.css-4ovtr5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:var(--chakra-spacing-4);color:var(--chakra-colors-gray-600);}</style><div class="css-4ovtr5"><style data-emotion="css pm8bda">.css-pm8bda{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}@media screen and (min-width: 48rem){.css-pm8bda{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}}</style><div class="css-pm8bda"><style data-emotion="css 15f3qk">.css-15f3qk{margin-bottom:var(--chakra-spacing-4);margin-right:0;}.css-15f3qk:is(:empty, [data-empty]){display:none;}@media screen and (min-width: 48rem){.css-15f3qk{margin-bottom:0;margin-right:var(--chakra-spacing-4);}}</style><div class="css-15f3qk"><style data-emotion="css 4w27t5">.css-4w27t5{object-fit:cover;max-width:150px;}</style><img class="chakra-image css-4w27t5" src="/kouchou-ai-reports/meta/reporter.png" alt="「#みんなでつくる舞鶴2040」プロジェクト"/></div><style data-emotion="css 70oe1e">.css-70oe1e{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;color:var(--chakra-colors-gray-600);}</style><div class="css-70oe1e"><style data-emotion="css b5474f">.css-b5474f{font-family:var(--chakra-fonts-main);font-size:var(--chakra-font-sizes-xs);font-weight:var(--chakra-font-weights-normal);line-height:var(--chakra-line-heights-taller);letter-spacing:0.3px;}</style><p class="css-b5474f">レポーター</p><style data-emotion="css 1nk0d0w">.css-1nk0d0w{font-family:var(--chakra-fonts-main);font-size:var(--chakra-font-sizes-md);font-weight:var(--chakra-font-weights-bold);line-height:var(--chakra-line-heights-taller);letter-spacing:0.4px;}</style><p class="css-1nk0d0w">「#みんなでつくる舞鶴2040」プロジェクト</p></div></div><style data-emotion="css ipxif5">.css-ipxif5{font-family:var(--chakra-fonts-main);font-size:var(--chakra-font-sizes-md);font-weight:var(--chakra-font-weights-normal);line-height:var(--chakra-line-heights-taller);letter-spacing:0.4px;color:var(--chakra-colors-gray-600);text-align:left;white-space:normal;word-break:break-all;}</style><div class="css-ipxif5">この取組では、みなさま一人ひとりの「2040年の舞鶴ってこうなってほしいな」「こんなことやってみたい！」といっ<style data-emotion="css 4nx0in">.css-4nx0in{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;font-family:var(--chakra-fonts-main);font-size:var(--chakra-font-sizes-md);font-weight:var(--chakra-font-weights-normal);line-height:var(--chakra-line-heights-taller);letter-spacing:0.4px;}</style><div class="css-4nx0in"><style data-emotion="css t5irqm">.css-t5irqm{margin-right:0.4rem;}</style><p class="css-t5irqm">...</p><style data-emotion="css 11zqpeq">@layer recipes{.css-11zqpeq{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;outline:none;gap:var(--chakra-spacing-1\.5);cursor:pointer;border-radius:var(--chakra-radii-l1);--focus-ring-color:var(--chakra-colors-color-palette-focus-ring);color:var(--chakra-colors-font-link);-webkit-text-decoration:underline;text-decoration:underline;text-underline-offset:3px;--mix-textDecorationColor:color-mix(in srgb, currentColor 20%, transparent);text-decoration-color:var(--mix-textDecorationColor, currentColor);}.css-11zqpeq:is(:focus, [data-focus]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}@media (hover: hover){.css-11zqpeq:is(:hover, [data-hover]):not(:disabled, [data-disabled]){-webkit-text-decoration:none;text-decoration:none;text-underline-offset:3px;--mix-textDecorationColor:color-mix(in srgb, currentColor 20%, transparent);text-decoration-color:var(--mix-textDecorationColor, currentColor);opacity:0.75;}}}</style><a class="chakra-link css-11zqpeq">全文表示</a></div></div><style data-emotion="css 1xz93p3">.css-1xz93p3{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:var(--chakra-spacing-3);-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;}.css-1xz93p3:is(:empty, [data-empty]){display:none;}</style><div class="css-1xz93p3"><style data-emotion="css 1osowcw">@layer recipes{.css-1osowcw{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;border-radius:var(--chakra-radii-full);white-space:nowrap;vertical-align:middle;border-width:1px;border-color:var(--chakra-colors-gray-300);cursor:var(--chakra-cursor-button);-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;outline:0;line-height:var(--chakra-line-heights-taller);isolation:isolate;font-weight:var(--chakra-font-weights-bold);transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,translate,transform;transition-duration:var(--chakra-durations-moderate);--focus-ring-color:rgba(0, 0, 0, 0.36);height:var(--chakra-sizes-8);min-width:var(--chakra-sizes-8);font-size:var(--chakra-font-sizes-xs);padding-inline:var(--chakra-spacing-5);gap:var(--chakra-spacing-2);background:var(--chakra-colors-white);--bg-currentcolor:var(--chakra-colors-white);color:var(--chakra-colors-font-primary);font-family:var(--chakra-fonts-main);letter-spacing:0.3px;}.css-1osowcw:is(:focus-visible, [data-focus-visible]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}.css-1osowcw:is(:disabled, [disabled], [data-disabled], [aria-disabled=true]){opacity:0.5;cursor:not-allowed;}.css-1osowcw :where(svg){-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:var(--chakra-sizes-4);height:var(--chakra-sizes-4);}.css-1osowcw:is([aria-expanded=true], [data-expanded], [data-state=expanded]){--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-solid) 90%, transparent);background:var(--chakra-colors-button-active);--bg-currentcolor:var(--chakra-colors-button-active);box-shadow:var(--chakra-shadows-lg);}@media (hover: hover){.css-1osowcw:is(:hover, [data-hover]):not(:disabled, [data-disabled]){--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-solid) 90%, transparent);background:var(--chakra-colors-button-hover);--bg-currentcolor:var(--chakra-colors-button-hover);box-shadow:var(--chakra-shadows-lg);}.css-1osowcw:is(:hover, [data-hover]):not(:disabled, [data-disabled]):is(:active, [data-active]):not(:disabled, [data-disabled], [data-state=open]){background:var(--chakra-colors-button-active);--bg-currentcolor:var(--chakra-colors-button-active);}}}.css-1osowcw :where(svg){width:14px;height:14px;}</style><a type="button" class="chakra-button css-1osowcw" href="/" target="_blank" rel="noopener noreferrer"><style data-emotion="css 152l0rs">.css-152l0rs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:var(--chakra-spacing-1);-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-152l0rs"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-globe"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"></path><path d="M2 12h20"></path></svg>ウェブページ</div></a><style data-emotion="css 1db2vx4">@layer recipes{.css-1db2vx4{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;border-radius:var(--chakra-radii-full);white-space:nowrap;vertical-align:middle;border-width:1px;border-color:var(--chakra-colors-gray-300);cursor:var(--chakra-cursor-button);-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;outline:0;line-height:var(--chakra-line-heights-taller);isolation:isolate;font-weight:var(--chakra-font-weights-bold);transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,translate,transform;transition-duration:var(--chakra-durations-moderate);--focus-ring-color:rgba(0, 0, 0, 0.36);height:var(--chakra-sizes-8);min-width:var(--chakra-sizes-8);font-size:var(--chakra-font-sizes-xs);padding-inline:var(--chakra-spacing-5);gap:var(--chakra-spacing-2);background:var(--chakra-colors-white);--bg-currentcolor:var(--chakra-colors-white);color:var(--chakra-colors-font-primary);font-family:var(--chakra-fonts-main);letter-spacing:0.3px;}.css-1db2vx4:is(:focus-visible, [data-focus-visible]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}.css-1db2vx4:is(:disabled, [disabled], [data-disabled], [aria-disabled=true]){opacity:0.5;cursor:not-allowed;}.css-1db2vx4 :where(svg){-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:var(--chakra-sizes-4);height:var(--chakra-sizes-4);}.css-1db2vx4:is([aria-expanded=true], [data-expanded], [data-state=expanded]){--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-solid) 90%, transparent);background:var(--chakra-colors-button-active);--bg-currentcolor:var(--chakra-colors-button-active);box-shadow:var(--chakra-shadows-lg);}@media (hover: hover){.css-1db2vx4:is(:hover, [data-hover]):not(:disabled, [data-disabled]){--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-solid) 90%, transparent);background:var(--chakra-colors-button-hover);--bg-currentcolor:var(--chakra-colors-button-hover);box-shadow:var(--chakra-shadows-lg);}.css-1db2vx4:is(:hover, [data-hover]):not(:disabled, [data-disabled]):is(:active, [data-active]):not(:disabled, [data-disabled], [data-state=open]){background:var(--chakra-colors-button-active);--bg-currentcolor:var(--chakra-colors-button-active);}}}</style><a type="button" class="chakra-button css-1db2vx4" href="/" target="_blank" rel="noopener noreferrer">プライバシーポリシー</a></div></div></div></div><style data-emotion="css jgpr3k">.css-jgpr3k{color:var(--chakra-colors-gray-800);}</style><footer class="css-jgpr3k"><style data-emotion="css 19zzqp6">.css-19zzqp6{background:url('/kouchou-ai-reports/images/footer-bg.webp');--bg-currentcolor:url('/kouchou-ai-reports/images/footer-bg.webp');-webkit-background-size:cover;background-size:cover;-webkit-background-position:center;background-position:center;padding-block:var(--chakra-spacing-6);padding-inline:var(--chakra-spacing-6);}@media screen and (min-width: 48rem){.css-19zzqp6{padding-block:var(--chakra-spacing-10);padding-inline:var(--chakra-spacing-12);}}</style><div class="css-19zzqp6"><style data-emotion="css 7igs1j">.css-7igs1j{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;background:var(--chakra-colors-white);--bg-currentcolor:var(--chakra-colors-white);padding-block:var(--chakra-spacing-8);padding-inline:var(--chakra-spacing-8);border-radius:var(--chakra-radii-3xl);max-width:1024px;margin-inline:auto;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:var(--chakra-spacing-8);}@media screen and (min-width: 64rem){.css-7igs1j{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:flex-end;-webkit-box-align:flex-end;-ms-flex-align:flex-end;align-items:flex-end;}}</style><div class="css-7igs1j"><img alt="広聴AI すべての声が社会を動かす力になる。" loading="lazy" width="256" height="102" decoding="async" data-nimg="1" style="color:transparent" src="/kouchou-ai-reports/images/kouchouai-logo.svg"/><style data-emotion="css 1nkdwiq">.css-1nkdwiq{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:var(--chakra-spacing-4);}</style><div class="css-1nkdwiq"><style data-emotion="css b5474f">.css-b5474f{font-family:var(--chakra-fonts-main);font-size:var(--chakra-font-sizes-xs);font-weight:var(--chakra-font-weights-normal);line-height:var(--chakra-line-heights-taller);letter-spacing:0.3px;}</style><p class="css-b5474f">広聴AIは、デジタル民主主義2030プロジェクトから生まれたオープンソース（OSS）アプリケーションです。<style data-emotion="css fbw0mq">.css-fbw0mq{display:none;}@media screen and (min-width: 64rem){.css-fbw0mq{display:inline;}}</style><br class="css-fbw0mq"/>本ページは、そのOSS成果物を活用して構築されています。</p><style data-emotion="css aqhavr">.css-aqhavr{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:var(--chakra-spacing-3);}</style><div class="css-aqhavr"><style data-emotion="css 1dhaav">@layer recipes{.css-1dhaav{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;border-radius:var(--chakra-radii-full);white-space:nowrap;vertical-align:middle;border-width:1px;border-color:var(--chakra-colors-gray-800);cursor:var(--chakra-cursor-button);-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;outline:0;line-height:var(--chakra-line-heights-taller);isolation:isolate;font-weight:var(--chakra-font-weights-bold);transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,translate,transform;transition-duration:var(--chakra-durations-moderate);--focus-ring-color:rgba(0, 0, 0, 0.36);height:var(--chakra-sizes-8);min-width:var(--chakra-sizes-8);font-size:var(--chakra-font-sizes-xs);padding-inline:var(--chakra-spacing-5);gap:var(--chakra-spacing-2);background:var(--chakra-colors-white);--bg-currentcolor:var(--chakra-colors-white);color:var(--chakra-colors-font-primary);font-family:var(--chakra-fonts-main);letter-spacing:0.3px;}.css-1dhaav:is(:focus-visible, [data-focus-visible]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}.css-1dhaav:is(:disabled, [disabled], [data-disabled], [aria-disabled=true]){opacity:0.5;cursor:not-allowed;}.css-1dhaav :where(svg){-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:var(--chakra-sizes-4);height:var(--chakra-sizes-4);}.css-1dhaav:is([aria-expanded=true], [data-expanded], [data-state=expanded]){--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-solid) 90%, transparent);background:var(--chakra-colors-button-active);--bg-currentcolor:var(--chakra-colors-button-active);box-shadow:var(--chakra-shadows-lg);}@media (hover: hover){.css-1dhaav:is(:hover, [data-hover]):not(:disabled, [data-disabled]){--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-solid) 90%, transparent);background:var(--chakra-colors-button-hover);--bg-currentcolor:var(--chakra-colors-button-hover);box-shadow:var(--chakra-shadows-lg);}.css-1dhaav:is(:hover, [data-hover]):not(:disabled, [data-disabled]):is(:active, [data-active]):not(:disabled, [data-disabled], [data-state=open]){background:var(--chakra-colors-button-active);--bg-currentcolor:var(--chakra-colors-button-active);}}}</style><a type="button" class="chakra-button css-1dhaav" href="https://dd2030.org/kouchou-ai" target="_blank" rel="noopener noreferrer">広聴AIについて<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up-right"><path d="M7 7h10v10"></path><path d="M7 17 17 7"></path></svg></a><style data-emotion="css 1jepfc0">@layer recipes{.css-1jepfc0{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;border-radius:var(--chakra-radii-full);white-space:nowrap;vertical-align:middle;border-width:1px;border-color:var(--chakra-colors-gray-800);cursor:var(--chakra-cursor-button);-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;outline:0;line-height:var(--chakra-line-heights-taller);isolation:isolate;font-weight:var(--chakra-font-weights-bold);transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,translate,transform;transition-duration:var(--chakra-durations-moderate);--focus-ring-color:rgba(0, 0, 0, 0.36);height:var(--chakra-sizes-8);min-width:var(--chakra-sizes-8);font-size:var(--chakra-font-sizes-xs);padding-inline:var(--chakra-spacing-5);gap:var(--chakra-spacing-2);background:var(--chakra-colors-white);--bg-currentcolor:var(--chakra-colors-white);color:var(--chakra-colors-font-primary);font-family:var(--chakra-fonts-main);letter-spacing:0.3px;}.css-1jepfc0:is(:focus-visible, [data-focus-visible]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}.css-1jepfc0:is(:disabled, [disabled], [data-disabled], [aria-disabled=true]){opacity:0.5;cursor:not-allowed;}.css-1jepfc0 :where(svg){-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:var(--chakra-sizes-4);height:var(--chakra-sizes-4);}.css-1jepfc0:is([aria-expanded=true], [data-expanded], [data-state=expanded]){--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-solid) 90%, transparent);background:var(--chakra-colors-button-active);--bg-currentcolor:var(--chakra-colors-button-active);box-shadow:var(--chakra-shadows-lg);}@media (hover: hover){.css-1jepfc0:is(:hover, [data-hover]):not(:disabled, [data-disabled]){--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-solid) 90%, transparent);background:var(--chakra-colors-button-hover);--bg-currentcolor:var(--chakra-colors-button-hover);box-shadow:var(--chakra-shadows-lg);}.css-1jepfc0:is(:hover, [data-hover]):not(:disabled, [data-disabled]):is(:active, [data-active]):not(:disabled, [data-disabled], [data-state=open]){background:var(--chakra-colors-button-active);--bg-currentcolor:var(--chakra-colors-button-active);}}}</style><button type="button" data-scope="dialog" data-part="trigger" dir="ltr" id="dialog:«Raladjrtb»:trigger" aria-haspopup="dialog" aria-expanded="false" data-state="closed" class="chakra-button chakra-dialog__trigger css-1jepfc0">謝辞</button><style data-emotion="css 1mlw21">@layer recipes{.css-1mlw21{background:var(--chakra-colors-black-alpha-500);--bg-currentcolor:var(--chakra-colors-black-alpha-500);position:fixed;left:0;top:0;width:100vw;height:100dvh;z-index:var(--chakra-z-index-overlay);}.css-1mlw21:is([open], [data-open], [data-state=open]){-webkit-animation-name:fade-in;animation-name:fade-in;-webkit-animation-duration:var(--chakra-durations-slow);animation-duration:var(--chakra-durations-slow);}.css-1mlw21:is([closed], [data-closed], [data-state=closed]){-webkit-animation-name:fade-out;animation-name:fade-out;-webkit-animation-duration:var(--chakra-durations-moderate);animation-duration:var(--chakra-durations-moderate);}}</style><style data-emotion="css ah9m9u">@layer recipes{.css-ah9m9u{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100vw;height:100dvh;position:fixed;left:0;top:0;--dialog-z-index:var(--chakra-z-index-modal);z-index:calc(var(--dialog-z-index) + var(--layer-index, 0));-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;overscroll-behavior-y:none;overflow:auto;pointer-events:auto;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}</style></div></div></div></div><style data-emotion="css 13geuf0">.css-13geuf0{background:#F1F6F8;--bg-currentcolor:#F1F6F8;padding-block:var(--chakra-spacing-6);padding-inline:var(--chakra-spacing-6);margin-inline:auto;}@media screen and (min-width: 48rem){.css-13geuf0{padding-block:var(--chakra-spacing-10);padding-inline:var(--chakra-spacing-12);}}</style><div class="css-13geuf0"><style data-emotion="css 1p9o6oq">.css-1p9o6oq{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;background:var(--chakra-colors-white);--bg-currentcolor:var(--chakra-colors-white);padding-block:var(--chakra-spacing-8);padding-inline:var(--chakra-spacing-8);border-radius:var(--chakra-radii-3xl);max-width:1024px;margin-inline:auto;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;gap:var(--chakra-spacing-8);}@media screen and (min-width: 64rem){.css-1p9o6oq{-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><div class="css-1p9o6oq"><img alt="デジタル民主主義2030" loading="lazy" width="256" height="80" decoding="async" data-nimg="1" style="color:transparent" src="/kouchou-ai-reports/images/dd2030-logo-full.svg"/><div class="css-1nkdwiq"><p class="css-b5474f">2030年には、情報技術により民主主義のあり方はアップデートされており、一人ひとりの声が政治・行政に届き、適切に合意形成・政策反映されていくような社会が当たり前になる、──そんな未来を目指して立ち上げられたのがデジタル民主主義2030プロジェクトです。</p><style data-emotion="css m986kn">.css-m986kn{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:var(--chakra-spacing-3);-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}</style><div class="css-m986kn"><a type="button" class="chakra-button css-1dhaav" href="https://dd2030.org" rel="noopener noreferrer" target="_blank">プロジェクトサイト<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up-right"><path d="M7 7h10v10"></path><path d="M7 17 17 7"></path></svg></a><a type="button" class="chakra-button css-1dhaav" href="https://x.com/dd2030jp" rel="noopener noreferrer" target="_blank"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><title>x</title><path d="M9.14334 7.01186L13.6106 1.72168H12.552L8.67308 6.31507L5.57499 1.72168H2.00171L6.68663 8.6677L2.00171 14.2153H3.06037L7.15662 9.36449L10.4284 14.2153H14.0017L9.14308 7.01186H9.14334ZM7.69336 8.72889L7.21868 8.03723L3.44182 2.53356H5.06786L8.11583 6.97519L8.59051 7.66686L12.5525 13.4403H10.9265L7.69336 8.72916V8.72889Z" fill="currentColor"></path></svg></a><style data-emotion="css 6gsk1g">@layer recipes{.css-6gsk1g{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;border-radius:var(--chakra-radii-full);white-space:nowrap;vertical-align:middle;border-width:1px;border-color:var(--chakra-colors-gray-800);cursor:var(--chakra-cursor-button);-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;outline:0;line-height:var(--chakra-line-heights-taller);isolation:isolate;font-weight:var(--chakra-font-weights-bold);transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,translate,transform;transition-duration:var(--chakra-durations-moderate);--focus-ring-color:rgba(0, 0, 0, 0.36);height:var(--chakra-sizes-8);min-width:var(--chakra-sizes-8);font-size:var(--chakra-font-sizes-xs);padding-inline:var(--chakra-spacing-5);gap:var(--chakra-spacing-2);background:var(--chakra-colors-white);--bg-currentcolor:var(--chakra-colors-white);color:var(--chakra-colors-font-primary);font-family:var(--chakra-fonts-main);letter-spacing:0.3px;}.css-6gsk1g:is(:focus-visible, [data-focus-visible]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}.css-6gsk1g:is(:disabled, [disabled], [data-disabled], [aria-disabled=true]){opacity:0.5;cursor:not-allowed;}.css-6gsk1g :where(svg){-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:var(--chakra-sizes-4);height:var(--chakra-sizes-4);}.css-6gsk1g:is([aria-expanded=true], [data-expanded], [data-state=expanded]){--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-solid) 90%, transparent);background:var(--chakra-colors-button-active);--bg-currentcolor:var(--chakra-colors-button-active);box-shadow:var(--chakra-shadows-lg);}@media (hover: hover){.css-6gsk1g:is(:hover, [data-hover]):not(:disabled, [data-disabled]){--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-solid) 90%, transparent);background:var(--chakra-colors-button-hover);--bg-currentcolor:var(--chakra-colors-button-hover);box-shadow:var(--chakra-shadows-lg);}.css-6gsk1g:is(:hover, [data-hover]):not(:disabled, [data-disabled]):is(:active, [data-active]):not(:disabled, [data-disabled], [data-state=open]){background:var(--chakra-colors-button-active);--bg-currentcolor:var(--chakra-colors-button-active);}}}.css-6gsk1g :where(svg){width:42px;height:12px;}</style><a type="button" class="chakra-button css-6gsk1g" href="https://note.com/dd2030" rel="noopener noreferrer" target="_blank"><svg width="42" height="12" viewBox="0 0 42 12" fill="none" xmlns="http://www.w3.org/2000/svg"><title>note</title><path d="M15.9277 2.43555C18.077 2.43555 19.8281 4.19453 19.8281 6.36035C19.8281 8.52626 18.077 10.2852 15.9277 10.2852C13.7786 10.2852 12.0274 8.52626 12.0273 6.36035C12.0273 4.19454 13.7786 2.43555 15.9277 2.43555ZM36.4756 2.43555C38.6249 2.43555 40.376 4.19453 40.376 6.36035C40.376 6.56783 40.3506 6.75876 40.3174 6.95801H34.4844C34.5673 7.39751 34.7498 7.75408 35.0068 7.98633C35.4217 8.37641 35.9944 8.55957 36.9404 8.55957C37.6872 8.55957 38.6245 8.09468 38.998 7.7627L39.8779 8.94141C38.8078 10.1277 37.3228 10.2851 36.75 10.2852C35.5716 10.2852 34.6912 9.93729 34.0605 9.43945C33.1561 8.71748 32.5752 7.62998 32.5752 6.36035C32.5752 4.19458 34.3265 2.43563 36.4756 2.43555ZM0.767578 2.50293C2.28616 2.50293 4.37746 2.4194 5.87109 2.46094C7.8791 2.51073 8.6347 3.3822 8.66797 5.54785C8.69273 6.76177 8.66821 10.236 8.66797 10.2695H6.49316C6.49317 7.20807 6.50971 6.70162 6.49316 5.73926C6.46828 4.89288 6.22782 4.48588 5.57227 4.41113C4.87519 4.32816 2.94141 4.39453 2.94141 4.39453V10.2695H0.767578V2.50293ZM15.9277 4.29395C14.7992 4.29395 13.8867 5.2156 13.8867 6.35254C13.8869 7.48918 14.7994 8.41015 15.9277 8.41016C17.0562 8.41016 17.9685 7.4975 17.9688 6.35254C17.9688 5.2156 17.0563 4.29395 15.9277 4.29395ZM27.2139 1.71387V3.89648H29.3057V5.80469H27.2139V8.07031H25.1816V5.80469H23.0898V3.89648H25.1816V1.71387H27.2139ZM36.4678 4.04492C35.3641 4.04492 34.7167 4.72557 34.501 5.64648H38.4258C38.2266 4.77538 37.6209 4.04503 36.4678 4.04492Z" fill="currentColor"></path></svg></a><a type="button" class="chakra-button css-1dhaav" href="https://dd2030.slack.com" rel="noopener noreferrer" target="_blank"><svg width="17" height="16" viewBox="0 0 17 16" fill="none" xmlns="http://www.w3.org/2000/svg"><title>Slack</title><g clip-path="url(#clip0_1082_1428)"><path d="M10.8095 2.33301C10.8095 1.78072 10.3618 1.33301 9.80953 1.33301C9.25725 1.33301 8.80953 1.78072 8.80953 2.33301V5.66634C8.80953 6.21863 9.25725 6.66634 9.80953 6.66634C10.3618 6.66634 10.8095 6.21863 10.8095 5.66634V2.33301Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12.8095 5.66634V6.66634H13.8095C14.0073 6.66634 14.2006 6.60769 14.3651 6.49781C14.5295 6.38793 14.6577 6.23175 14.7334 6.04902C14.8091 5.8663 14.8289 5.66523 14.7903 5.47125C14.7517 5.27727 14.6565 5.09909 14.5166 4.95923C14.3768 4.81938 14.1986 4.72414 14.0046 4.68556C13.8106 4.64697 13.6096 4.66677 13.4268 4.74246C13.2441 4.81815 13.0879 4.94632 12.9781 5.11077C12.8682 5.27522 12.8095 5.46856 12.8095 5.66634Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M7.4762 10.333C7.4762 9.78072 7.02848 9.33301 6.4762 9.33301C5.92391 9.33301 5.4762 9.78072 5.4762 10.333V13.6663C5.4762 14.2186 5.92391 14.6663 6.4762 14.6663C7.02848 14.6663 7.4762 14.2186 7.4762 13.6663V10.333Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M3.4762 10.333V9.33301H2.4762C2.27842 9.33301 2.08508 9.39166 1.92063 9.50154C1.75618 9.61142 1.628 9.7676 1.55232 9.95032C1.47663 10.1331 1.45683 10.3341 1.49541 10.5281C1.534 10.7221 1.62924 10.9003 1.76909 11.0401C1.90894 11.18 2.08713 11.2752 2.28111 11.3138C2.47509 11.3524 2.67615 11.3326 2.85888 11.2569C3.04161 11.1812 3.19778 11.053 3.30767 10.8886C3.41755 10.7241 3.4762 10.5308 3.4762 10.333Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M13.8095 8.66634H10.4762C9.92391 8.66634 9.4762 9.11406 9.4762 9.66634C9.4762 10.2186 9.92391 10.6663 10.4762 10.6663H13.8095C14.3618 10.6663 14.8095 10.2186 14.8095 9.66634C14.8095 9.11406 14.3618 8.66634 13.8095 8.66634Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M10.4762 12.6663H9.4762V13.6663C9.4762 13.8641 9.53485 14.0575 9.64473 14.2219C9.75461 14.3864 9.91079 14.5145 10.0935 14.5902C10.2762 14.6659 10.4773 14.6857 10.6713 14.6471C10.8653 14.6085 11.0435 14.5133 11.1833 14.3734C11.3232 14.2336 11.4184 14.0554 11.457 13.8614C11.4956 13.6674 11.4758 13.4664 11.4001 13.2837C11.3244 13.1009 11.1962 12.9448 11.0318 12.8349C10.8673 12.725 10.674 12.6663 10.4762 12.6663Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M5.80953 5.33301H2.4762C1.92391 5.33301 1.4762 5.78072 1.4762 6.33301C1.4762 6.88529 1.92391 7.33301 2.4762 7.33301H5.80953C6.36181 7.33301 6.80953 6.88529 6.80953 6.33301C6.80953 5.78072 6.36181 5.33301 5.80953 5.33301Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M5.80953 3.33301H6.80953V2.33301C6.80953 2.13523 6.75088 1.94189 6.641 1.77744C6.53112 1.61299 6.37494 1.48482 6.19221 1.40913C6.00949 1.33344 5.80842 1.31364 5.61444 1.35222C5.42046 1.39081 5.24228 1.48605 5.10242 1.6259C4.96257 1.76575 4.86733 1.94394 4.82874 2.13792C4.79016 2.3319 4.80996 2.53297 4.88565 2.71569C4.96134 2.89842 5.08951 3.0546 5.25396 3.16448C5.41841 3.27436 5.61175 3.33301 5.80953 3.33301Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></g><defs><clipPath id="clip0_1082_1428"><rect width="16" height="16" fill="white" transform="translate(0.142822)"></rect></clipPath></defs></svg>slack</a><a type="button" class="chakra-button css-1dhaav" href="https://github.com/digitaldemocracy2030" rel="noopener noreferrer" target="_blank"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M10 14.6663V11.9997C10.0928 11.1645 9.85333 10.3264 9.33337 9.66634C11.3334 9.66634 13.3334 8.33301 13.3334 5.99967C13.3867 5.16634 13.1534 4.34634 12.6667 3.66634C12.8534 2.89967 12.8534 2.09967 12.6667 1.33301C12.6667 1.33301 12 1.33301 10.6667 2.33301C8.90671 1.99967 7.09337 1.99967 5.33337 2.33301C4.00004 1.33301 3.33337 1.33301 3.33337 1.33301C3.13337 2.09967 3.13337 2.89967 3.33337 3.66634C2.84796 4.3436 2.61236 5.1682 2.66671 5.99967C2.66671 8.33301 4.66671 9.66634 6.66671 9.66634C6.40671 9.99301 6.21337 10.3663 6.10004 10.7663C5.98671 11.1663 5.95337 11.5863 6.00004 11.9997M6.00004 11.9997V14.6663M6.00004 11.9997C2.99337 13.333 2.66671 10.6663 1.33337 10.6663" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>GitHub</a></div></div></div></div><style data-emotion="css kv0et7">.css-kv0et7{background:var(--chakra-colors-white);--bg-currentcolor:var(--chakra-colors-white);padding-block:var(--chakra-spacing-6);padding-inline:var(--chakra-spacing-6);text-align:center;}@media screen and (min-width: 48rem){.css-kv0et7{padding-inline:var(--chakra-spacing-12);}}@media screen and (min-width: 64rem){.css-kv0et7{padding-block:var(--chakra-spacing-4);}}</style><div class="css-kv0et7"><style data-emotion="css 8p2j6l">.css-8p2j6l{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;max-width:1024px;margin-inline:auto;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-flex-direction:column-reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse;gap:var(--chakra-spacing-4);}@media screen and (min-width: 64rem){.css-8p2j6l{-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><div class="css-8p2j6l"><style data-emotion="css 8igsd4">.css-8igsd4{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;color:var(--chakra-colors-gray-500);font-family:var(--chakra-fonts-main);font-size:var(--chakra-font-sizes-xs);font-weight:var(--chakra-font-weights-normal);line-height:var(--chakra-line-heights-taller);letter-spacing:0.3px;}</style><p class="css-8igsd4">© 2025 デジタル民主主義2030<style data-emotion="css 1ccrm74">.css-1ccrm74{margin-inline:0.4em;display:none;}@media screen and (min-width: 64rem){.css-1ccrm74{display:inline;}}</style><span class="css-1ccrm74">|</span><style data-emotion="css 1q1l6ct">.css-1q1l6ct{display:inline;}@media screen and (min-width: 64rem){.css-1q1l6ct{display:none;}}</style><br class="css-1q1l6ct"/>レポート内容はレポーターに帰属します</p><style data-emotion="css 1jtn8ea">.css-1jtn8ea{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:0;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:var(--chakra-colors-gray-800);}</style><div class="css-1jtn8ea"><style data-emotion="css 1iep8e3">@layer recipes{.css-1iep8e3{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;appearance:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;border-radius:var(--chakra-radii-full);white-space:nowrap;vertical-align:middle;border-width:1px;border-color:var(--chakra-colors-transparent);cursor:var(--chakra-cursor-button);-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;outline:0;line-height:var(--chakra-line-heights-taller);isolation:isolate;font-weight:var(--chakra-font-weights-bold);transition-property:background-color,border-color,color,fill,stroke,opacity,box-shadow,translate,transform;transition-duration:var(--chakra-durations-moderate);--focus-ring-color:rgba(0, 0, 0, 0.36);height:var(--chakra-sizes-8);min-width:var(--chakra-sizes-8);font-size:var(--chakra-font-sizes-xs);padding-inline:var(--chakra-spacing-5);gap:var(--chakra-spacing-2);background:var(--chakra-colors-transparent);--bg-currentcolor:var(--chakra-colors-transparent);color:var(--chakra-colors-font-primary);font-family:var(--chakra-fonts-main);letter-spacing:0.3px;}.css-1iep8e3:is(:focus-visible, [data-focus-visible]){outline-width:var(--focus-ring-width, 2px);outline-offset:var(--focus-ring-offset, 2px);outline-style:var(--focus-ring-style, solid);outline-color:var(--focus-ring-color);}.css-1iep8e3:is(:disabled, [disabled], [data-disabled], [aria-disabled=true]){opacity:0.5;cursor:not-allowed;}.css-1iep8e3 :where(svg){-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:var(--chakra-sizes-4);height:var(--chakra-sizes-4);}.css-1iep8e3:is([aria-expanded=true], [data-expanded], [data-state=expanded]){--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-solid) 90%, transparent);background:var(--chakra-colors-button-active);--bg-currentcolor:var(--chakra-colors-button-active);box-shadow:var(--chakra-shadows-lg);}@media (hover: hover){.css-1iep8e3:is(:hover, [data-hover]):not(:disabled, [data-disabled]){--mix-background:color-mix(in srgb, var(--chakra-colors-color-palette-solid) 90%, transparent);background:var(--chakra-colors-button-hover);--bg-currentcolor:var(--chakra-colors-button-hover);box-shadow:var(--chakra-shadows-lg);}.css-1iep8e3:is(:hover, [data-hover]):not(:disabled, [data-disabled]):is(:active, [data-active]):not(:disabled, [data-disabled], [data-state=open]){background:var(--chakra-colors-button-active);--bg-currentcolor:var(--chakra-colors-button-active);}}}</style><button type="button" data-scope="dialog" data-part="trigger" dir="ltr" id="dialog:«Rlatjrtb»:trigger" aria-haspopup="dialog" aria-expanded="false" data-state="closed" class="chakra-button chakra-dialog__trigger css-1iep8e3">免責</button></div></div></div></footer><script src="/kouchou-ai-reports/_next/static/chunks/webpack-785c399c8fec64c2.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[8708,[\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"458\",\"static/chunks/458-4db2abcd82f4c9c6.js\",\"124\",\"static/chunks/124-8b6d8ff5759d10e8.js\",\"48\",\"static/chunks/48-3a76f8478d544215.js\",\"177\",\"static/chunks/app/layout-2c53d293b9a0602f.js\"],\"Provider\"]\n3:I[87555,[],\"\"]\n4:I[31295,[],\"\"]\n5:I[32176,[\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"567\",\"static/chunks/567-13e48369edb584ec.js\",\"335\",\"static/chunks/app/%5Bslug%5D/error-6cef2ad01af28fcb.js\"],\"default\"]\n6:I[6874,[\"150\",\"static/chunks/59650de3-481cc0c44db376d7.js\",\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"567\",\"static/chunks/567-13e48369edb584ec.js\",\"458\",\"static/chunks/458-4db2abcd82f4c9c6.js\",\"874\",\"static/chunks/874-e31c245f344a6bb3.js\",\"261\",\"static/chunks/261-224f03b48189144a.js\",\"124\",\"static/chunks/124-8b6d8ff5759d10e8.js\",\"116\",\"static/chunks/116-746bc821fa46af6a.js\",\"49\",\"static/chunks/49-fab65c398860e39e.js\",\"609\",\"static/chunks/609-98106995dfc9adbb.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-e1d928255840716e.js\"],\"\"]\n7:I[38567,[\"150\",\"static/chunks/59650de3-481cc0c44db376d7.js\",\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"567\",\"static/chunks/567-13e48369edb584ec.js\",\"458\",\"static/chunks/458-4db2abcd82f4c9c6.js\",\"874\",\"static/chunks/874-e31c245f344a6bb3.js\",\"261\",\"static/chunks/261-224f03b48189144a.js\",\"124\",\"static/chunks/124-8b6d8ff5759d10e8.js\",\"116\",\"static/chunks/116-746bc821fa46af6a.js\",\"49\",\"static/chunks/49-fab65c398860e39e.js\",\"609\",\"static/chunks/609-98106995dfc9adbb.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-e1d928255840716e.js\"],\"Button\"]\n9:I[59665,[],\"OutletBoundary\"]\nc:I[59665,[],\"ViewportBoundary\"]\ne:I[59665,[],\"MetadataBoundary\"]\n10:I[26614,[],\"\"]\n:HL[\"/kouchou-ai-reports/_next/static/css/a63443551c7d7d9f.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"miUT5QfcUq0IFJwxqqyuS\",\"p\":\"/kouchou-ai-reports\",\"c\":[\"\",\"f538f0d7-e637-4c71-820f-5b9e615ff83f\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[[\"slug\",\"f538f0d7-e637-4c71-820f-5b9e615ff83f\",\"d\"],{\"children\":[\"__PAGE__\",{}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/kouchou-ai-reports/_next/static/css/a63443551c7d7d9f.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"suppressHydrationWarning\":true,\"lang\":\"ja\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.googleapis.com\"}],[\"$\",\"link\",null,{\"rel\":\"preconnect\",\"href\":\"https://fonts.gstatic.com\",\"crossOrigin\":\"anonymous\"}],[\"$\",\"link\",null,{\"href\":\"https://fonts.googleapis.com/css2?family=BIZ+UDPGothic\u0026display=swap\",\"rel\":\"stylesheet\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"href\":\"/kouchou-ai-reports/meta/icon.png\",\"sizes\":\"any\"}],false]}],[\"$\",\"body\",null,{\"children\":[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}]]}],{\"children\":[[\"slug\",\"f538f0d7-e637-4c71-820f-5b9e615ff83f\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$5\",\"errorStyles\":[],\"errorScripts\":[],\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"p\",null,{\"children\":\"ページが見つかりませんでした\"}],[\"$\",\"$L6\",null,{\"href\":\"/\",\"children\":[\"$\",\"$L7\",null,{\"children\":\"トップに戻る\"}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L8\",\"$undefined\",null,[\"$\",\"$L9\",null,{\"children\":[\"$La\",\"$Lb\",null]}]]}],{},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"kJcS5L-qOmSAd9lQGkA0t\",{\"children\":[[\"$\",\"$Lc\",null,{\"children\":\"$Ld\"}],null]}],[\"$\",\"$Le\",null,{\"children\":\"$Lf\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$10\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"d:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\na:null\n"])</script><script>self.__next_f.push([1,"11:I[6091,[\"150\",\"static/chunks/59650de3-481cc0c44db376d7.js\",\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"567\",\"static/chunks/567-13e48369edb584ec.js\",\"458\",\"static/chunks/458-4db2abcd82f4c9c6.js\",\"874\",\"static/chunks/874-e31c245f344a6bb3.js\",\"261\",\"static/chunks/261-224f03b48189144a.js\",\"124\",\"static/chunks/124-8b6d8ff5759d10e8.js\",\"116\",\"static/chunks/116-746bc821fa46af6a.js\",\"49\",\"static/chunks/49-fab65c398860e39e.js\",\"609\",\"static/chunks/609-98106995dfc9adbb.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-e1d928255840716e.js\"],\"Header\"]\n12:I[81068,[\"150\",\"static/chunks/59650de3-481cc0c44db376d7.js\",\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"567\",\"static/chunks/567-13e48369edb584ec.js\",\"458\",\"static/chunks/458-4db2abcd82f4c9c6.js\",\"874\",\"static/chunks/874-e31c245f344a6bb3.js\",\"261\",\"static/chunks/261-224f03b48189144a.js\",\"124\",\"static/chunks/124-8b6d8ff5759d10e8.js\",\"116\",\"static/chunks/116-746bc821fa46af6a.js\",\"49\",\"static/chunks/49-fab65c398860e39e.js\",\"609\",\"static/chunks/609-98106995dfc9adbb.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-e1d928255840716e.js\"],\"Box\"]\n13:I[17921,[\"150\",\"static/chunks/59650de3-481cc0c44db376d7.js\",\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"567\",\"static/chunks/567-13e48369edb584ec.js\",\"458\",\"static/chunks/458-4db2abcd82f4c9c6.js\",\"874\",\"static/chunks/874-e31c245f344a6bb3.js\",\"261\",\"static/chunks/261-224f03b48189144a.js\",\"124\",\"static/chunks/124-8b6d8ff5759d10e8.js\",\"116\",\"static/chunks/116-746bc821fa46af6a.js\",\"49\",\"static/chunks/49-fab65c398860e39e.js\",\"609\",\"static/chunks/609-98106995dfc9adbb.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-e1d928255840716e.js\"],\"Heading\"]\n14:I[90310,[\"150\",\"static/chunks/59650de3-481cc0c44db376d7.js\",\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"567\",\"static/chunks/567-13e48369edb584ec.js\",\"458\",\"static/chunks/458-4db2abcd82f4c9c6.js\",\"874\",\"static/chunks/874-e31c245f344a6bb3.js\",\"261\",\"static/chunks/261-224f03b48189144a.js\",\"124\",\"static/chunks/124-8b6d8ff5759d10e8.js\",\"116\",\"static/chunks/116-746bc821fa46af6a.js\",\"49\",\"static/chunks/49"])</script><script>self.__next_f.push([1,"-fab65c398860e39e.js\",\"609\",\"static/chunks/609-98106995dfc9adbb.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-e1d928255840716e.js\"],\"Text\"]\n15:I[7684,[\"150\",\"static/chunks/59650de3-481cc0c44db376d7.js\",\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"567\",\"static/chunks/567-13e48369edb584ec.js\",\"458\",\"static/chunks/458-4db2abcd82f4c9c6.js\",\"874\",\"static/chunks/874-e31c245f344a6bb3.js\",\"261\",\"static/chunks/261-224f03b48189144a.js\",\"124\",\"static/chunks/124-8b6d8ff5759d10e8.js\",\"116\",\"static/chunks/116-746bc821fa46af6a.js\",\"49\",\"static/chunks/49-fab65c398860e39e.js\",\"609\",\"static/chunks/609-98106995dfc9adbb.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-e1d928255840716e.js\"],\"Icon\"]\n16:I[4618,[\"150\",\"static/chunks/59650de3-481cc0c44db376d7.js\",\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"567\",\"static/chunks/567-13e48369edb584ec.js\",\"458\",\"static/chunks/458-4db2abcd82f4c9c6.js\",\"874\",\"static/chunks/874-e31c245f344a6bb3.js\",\"261\",\"static/chunks/261-224f03b48189144a.js\",\"124\",\"static/chunks/124-8b6d8ff5759d10e8.js\",\"116\",\"static/chunks/116-746bc821fa46af6a.js\",\"49\",\"static/chunks/49-fab65c398860e39e.js\",\"609\",\"static/chunks/609-98106995dfc9adbb.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-e1d928255840716e.js\"],\"ClientContainer\"]\n2c:I[17264,[\"150\",\"static/chunks/59650de3-481cc0c44db376d7.js\",\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"567\",\"static/chunks/567-13e48369edb584ec.js\",\"458\",\"static/chunks/458-4db2abcd82f4c9c6.js\",\"874\",\"static/chunks/874-e31c245f344a6bb3.js\",\"261\",\"static/chunks/261-224f03b48189144a.js\",\"124\",\"static/chunks/124-8b6d8ff5759d10e8.js\",\"116\",\"static/chunks/116-746bc821fa46af6a.js\",\"49\",\"static/chunks/49-fab65c398860e39e.js\",\"609\",\"static/chunks/609-98106995dfc9adbb.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-e1d928255840716e.js\"],\"Analysis\"]\n2d:I[91548,[\"150\",\"static/chunks/59650de3-481cc0c44db376d7.js\",\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"567\",\"static/chunks/567-13e48369edb584ec.js\",\"458\",\"static/chunks/458-4db2abcd82f4c9c6.js\",\"874\",\"static/chunks/874-e31c245f344a6bb3.js\",\"261\",\"stat"])</script><script>self.__next_f.push([1,"ic/chunks/261-224f03b48189144a.js\",\"124\",\"static/chunks/124-8b6d8ff5759d10e8.js\",\"116\",\"static/chunks/116-746bc821fa46af6a.js\",\"49\",\"static/chunks/49-fab65c398860e39e.js\",\"609\",\"static/chunks/609-98106995dfc9adbb.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-e1d928255840716e.js\"],\"Separator\"]\n2f:I[18607,[\"150\",\"static/chunks/59650de3-481cc0c44db376d7.js\",\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"567\",\"static/chunks/567-13e48369edb584ec.js\",\"458\",\"static/chunks/458-4db2abcd82f4c9c6.js\",\"874\",\"static/chunks/874-e31c245f344a6bb3.js\",\"261\",\"static/chunks/261-224f03b48189144a.js\",\"124\",\"static/chunks/124-8b6d8ff5759d10e8.js\",\"116\",\"static/chunks/116-746bc821fa46af6a.js\",\"49\",\"static/chunks/49-fab65c398860e39e.js\",\"609\",\"static/chunks/609-98106995dfc9adbb.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-e1d928255840716e.js\"],\"Footer\"]\n17:T194c,"])</script><script>self.__next_f.push([1,"import concurrent.futures\nimport json\nimport logging\nimport os\nimport re\n\nimport pandas as pd\nfrom pydantic import BaseModel, Field\nfrom tqdm import tqdm\n\nfrom services.llm import request_to_chat_ai\nfrom services.parse_json_list import parse_extraction_response\nfrom utils import update_progress\n\nCOMMA_AND_SPACE_AND_RIGHT_BRACKET = re.compile(r\",\\s*(\\])\")\n\n\nclass ExtractionResponse(BaseModel):\n    extractedOpinionList: list[str] = Field(..., description=\"抽出した意見のリスト\")\n\n\ndef _validate_property_columns(property_columns: list[str], comments: pd.DataFrame) -\u003e None:\n    if not all(property in comments.columns for property in property_columns):\n        raise ValueError(f\"Properties {property_columns} not found in comments. Columns are {comments.columns}\")\n\n\ndef extraction(config):\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/args.csv\"\n    model = config[\"extraction\"][\"model\"]\n    prompt = config[\"extraction\"][\"prompt\"]\n    workers = config[\"extraction\"][\"workers\"]\n    limit = config[\"extraction\"][\"limit\"]\n    property_columns = config[\"extraction\"][\"properties\"]\n\n    if \"provider\" not in config:\n        raise RuntimeError(\"provider is not set\")\n    provider = config[\"provider\"]\n\n    # カラム名だけを読み込み、必要なカラムが含まれているか確認する\n    comments = pd.read_csv(f\"inputs/{config['input']}.csv\", nrows=0)\n    _validate_property_columns(property_columns, comments)\n    # エラーが出なかった場合、すべての行を読み込む\n    comments = pd.read_csv(\n        f\"inputs/{config['input']}.csv\", usecols=[\"comment-id\", \"comment-body\"] + config[\"extraction\"][\"properties\"]\n    )\n    comment_ids = (comments[\"comment-id\"].values)[:limit]\n    comments.set_index(\"comment-id\", inplace=True)\n    results = pd.DataFrame()\n    update_progress(config, total=len(comment_ids))\n\n    argument_map = {}\n    relation_rows = []\n\n    for i in tqdm(range(0, len(comment_ids), workers)):\n        batch = comment_ids[i : i + workers]\n        batch_inputs = [comments.loc[id][\"comment-body\"] for id in batch]\n        batch_results = extract_batch(\n            batch_inputs, prompt, model, workers, provider, config.get(\"local_llm_address\"), config\n        )\n\n        for comment_id, extracted_args in zip(batch, batch_results, strict=False):\n            for j, arg in enumerate(extracted_args):\n                if arg not in argument_map:\n                    # argumentテーブルに追加\n                    arg_id = f\"A{comment_id}_{j}\"\n                    argument = arg\n                    argument_map[arg] = {\n                        \"arg-id\": arg_id,\n                        \"argument\": argument,\n                    }\n                else:\n                    arg_id = argument_map[arg][\"arg-id\"]\n\n                # relationテーブルにcommentとargの関係を追加\n                relation_row = {\n                    \"arg-id\": arg_id,\n                    \"comment-id\": comment_id,\n                }\n                relation_rows.append(relation_row)\n\n        update_progress(config, incr=len(batch))\n\n    # DataFrame化\n    results = pd.DataFrame(argument_map.values())\n    relation_df = pd.DataFrame(relation_rows)\n\n    if results.empty:\n        raise RuntimeError(\"result is empty, maybe bad prompt\")\n\n    results.to_csv(path, index=False)\n    # comment-idとarg-idの関係を保存\n    relation_df.to_csv(f\"outputs/{dataset}/relations.csv\", index=False)\n\n\nlogging.basicConfig(level=logging.DEBUG)\n\n\ndef extract_batch(batch, prompt, model, workers, provider=\"openai\", local_llm_address=None, config=None):\n    with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor:\n        futures_with_index = [\n            (i, executor.submit(extract_arguments, input, prompt, model, provider, local_llm_address))\n            for i, input in enumerate(batch)\n        ]\n\n        done, not_done = concurrent.futures.wait([f for _, f in futures_with_index], timeout=30)\n        results = [[] for _ in range(len(batch))]\n        total_token_input = 0\n        total_token_output = 0\n        total_token_usage = 0\n\n        for _, future in futures_with_index:\n            if future in not_done and not future.cancelled():\n                future.cancel()\n\n        for i, future in futures_with_index:\n            if future in done:\n                try:\n                    result = future.result()\n                    if isinstance(result, tuple) and len(result) == 4:\n                        items, token_input, token_output, token_total = result\n                        results[i] = items\n                        total_token_input += token_input\n                        total_token_output += token_output\n                        total_token_usage += token_total\n                    else:\n                        results[i] = result\n                except Exception as e:\n                    logging.error(f\"Task {future} failed with error: {e}\")\n                    results[i] = []\n\n        if config is not None:\n            config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0) + total_token_usage\n            config[\"token_usage_input\"] = config.get(\"token_usage_input\", 0) + total_token_input\n            config[\"token_usage_output\"] = config.get(\"token_usage_output\", 0) + total_token_output\n            print(\n                f\"Extraction batch: input={total_token_input}, output={total_token_output}, total={total_token_usage} tokens\"\n            )\n\n        return results\n\n\ndef extract_arguments(input, prompt, model, provider=\"openai\", local_llm_address=None):\n    messages = [\n        {\"role\": \"system\", \"content\": prompt},\n        {\"role\": \"user\", \"content\": input},\n    ]\n    try:\n        response, token_input, token_output, token_total = request_to_chat_ai(\n            messages=messages,\n            model=model,\n            is_json=False,\n            json_schema=ExtractionResponse,\n            provider=provider,\n            local_llm_address=local_llm_address,\n            user_api_key=os.getenv(\"USER_API_KEY\"),\n        )\n        items = parse_extraction_response(response)\n        items = list(filter(None, items))  # omit empty strings\n        return items, token_input, token_output, token_total\n    except json.decoder.JSONDecodeError as e:\n        print(\"JSON error:\", e)\n        print(\"Input was:\", input)\n        print(\"Response was:\", response)\n        print(\"Silently giving up on trying to generate valid list.\")\n        return []\n"])</script><script>self.__next_f.push([1,"18:T1149,"])</script><script>self.__next_f.push([1,"\"\"\"Cluster the arguments using UMAP + HDBSCAN and GPT-4.\"\"\"\n\nfrom importlib import import_module\n\nimport numpy as np\nimport pandas as pd\nimport scipy.cluster.hierarchy as sch\nfrom sklearn.cluster import KMeans\n\n\ndef hierarchical_clustering(config):\n    UMAP = import_module(\"umap\").UMAP\n\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/hierarchical_clusters.csv\"\n    arguments_df = pd.read_csv(f\"outputs/{dataset}/args.csv\", usecols=[\"arg-id\", \"argument\"])\n    embeddings_df = pd.read_pickle(f\"outputs/{dataset}/embeddings.pkl\")\n    embeddings_array = np.asarray(embeddings_df[\"embedding\"].values.tolist())\n    cluster_nums = config[\"hierarchical_clustering\"][\"cluster_nums\"]\n\n    n_samples = embeddings_array.shape[0]\n    # デフォルト設定は15\n    default_n_neighbors = 15\n\n    # テスト等サンプルが少なすぎる場合、n_neighborsの設定値を下げる\n    if n_samples \u003c= default_n_neighbors:\n        n_neighbors = max(2, n_samples - 1)  # 最低2以上\n    else:\n        n_neighbors = default_n_neighbors\n\n    umap_model = UMAP(random_state=42, n_components=2, n_neighbors=n_neighbors)\n    # TODO 詳細エラーメッセージを加える\n    # 以下のエラーの場合、おそらく元の意見件数が少なすぎることが原因\n    # TypeError: Cannot use scipy.linalg.eigh for sparse A with k \u003e= N. Use scipy.linalg.eigh(A.toarray()) or reduce k.\n    umap_embeds = umap_model.fit_transform(embeddings_array)\n\n    cluster_results = hierarchical_clustering_embeddings(\n        umap_embeds=umap_embeds,\n        cluster_nums=cluster_nums,\n    )\n    result_df = pd.DataFrame(\n        {\n            \"arg-id\": arguments_df[\"arg-id\"],\n            \"argument\": arguments_df[\"argument\"],\n            \"x\": umap_embeds[:, 0],\n            \"y\": umap_embeds[:, 1],\n        }\n    )\n\n    for cluster_level, final_labels in enumerate(cluster_results.values(), start=1):\n        result_df[f\"cluster-level-{cluster_level}-id\"] = [f\"{cluster_level}_{label}\" for label in final_labels]\n\n    result_df.to_csv(path, index=False)\n\n\ndef generate_cluster_count_list(min_clusters: int, max_clusters: int):\n    cluster_counts = []\n    current = min_clusters\n    cluster_counts.append(current)\n\n    if min_clusters == max_clusters:\n        return cluster_counts\n\n    while True:\n        next_double = current * 2\n        next_triple = current * 3\n\n        if next_double \u003e= max_clusters:\n            if cluster_counts[-1] != max_clusters:\n                cluster_counts.append(max_clusters)\n            break\n\n        # 次の倍はまだ max_clusters に収まるが、3倍だと超える\n        # -\u003e (次の倍は細かすぎるので)スキップして max_clusters に飛ぶ\n        if next_triple \u003e max_clusters:\n            cluster_counts.append(max_clusters)\n            break\n\n        cluster_counts.append(next_double)\n        current = next_double\n\n    return cluster_counts\n\n\ndef merge_clusters_with_hierarchy(\n    cluster_centers: np.ndarray,\n    kmeans_labels: np.ndarray,\n    umap_array: np.ndarray,\n    n_cluster_cut: int,\n):\n    Z = sch.linkage(cluster_centers, method=\"ward\")\n    cluster_labels_merged = sch.fcluster(Z, t=n_cluster_cut, criterion=\"maxclust\")\n\n    n_samples = umap_array.shape[0]\n    final_labels = np.zeros(n_samples, dtype=int)\n\n    for i in range(n_samples):\n        original_label = kmeans_labels[i]\n        final_labels[i] = cluster_labels_merged[original_label]\n\n    return final_labels\n\n\ndef hierarchical_clustering_embeddings(\n    umap_embeds,\n    cluster_nums,\n):\n    # 最大分割数でクラスタリングを実施\n    print(\"start initial clustering\")\n    initial_cluster_num = cluster_nums[-1]\n    kmeans_model = KMeans(n_clusters=initial_cluster_num, random_state=42)\n    kmeans_model.fit(umap_embeds)\n    print(\"end initial clustering\")\n\n    results = {}\n    print(\"start hierarchical clustering\")\n    cluster_nums.sort()\n    print(cluster_nums)\n    for n_cluster_cut in cluster_nums[:-1]:\n        print(\"n_cluster_cut: \", n_cluster_cut)\n        final_labels = merge_clusters_with_hierarchy(\n            cluster_centers=kmeans_model.cluster_centers_,\n            kmeans_labels=kmeans_model.labels_,\n            umap_array=umap_embeds,\n            n_cluster_cut=n_cluster_cut,\n        )\n        results[n_cluster_cut] = final_labels\n\n    results[initial_cluster_num] = kmeans_model.labels_\n    print(\"end hierarchical clustering\")\n\n    return results\n"])</script><script>self.__next_f.push([1,"19:T1c36,"])</script><script>self.__next_f.push([1,"import json\nimport os\nfrom concurrent.futures import ThreadPoolExecutor\nfrom functools import partial\nfrom typing import TypedDict\n\nimport pandas as pd\nfrom pydantic import BaseModel, Field\n\nfrom services.llm import request_to_chat_ai\n\n\nclass LabellingResult(TypedDict):\n    \"\"\"各クラスタのラベリング結果を表す型\"\"\"\n\n    cluster_id: str  # クラスタのID\n    label: str  # クラスタのラベル名\n    description: str  # クラスタの説明文\n\n\ndef hierarchical_initial_labelling(config: dict) -\u003e None:\n    \"\"\"階層的クラスタリングの初期ラベリングを実行する\n\n    Args:\n        config: 設定情報を含む辞書\n            - output_dir: 出力ディレクトリ名\n            - hierarchical_initial_labelling: 初期ラベリングの設定\n                - sampling_num: サンプリング数\n                - prompt: LLMへのプロンプト\n                - model: 使用するLLMモデル名\n                - workers: 並列処理のワーカー数\n            - provider: LLMプロバイダー\n    \"\"\"\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/hierarchical_initial_labels.csv\"\n    clusters_argument_df = pd.read_csv(f\"outputs/{dataset}/hierarchical_clusters.csv\")\n\n    cluster_id_columns = [col for col in clusters_argument_df.columns if col.startswith(\"cluster-level-\")]\n    initial_cluster_id_column = cluster_id_columns[-1]\n    sampling_num = config[\"hierarchical_initial_labelling\"][\"sampling_num\"]\n    initial_labelling_prompt = config[\"hierarchical_initial_labelling\"][\"prompt\"]\n    model = config[\"hierarchical_initial_labelling\"][\"model\"]\n    workers = config[\"hierarchical_initial_labelling\"][\"workers\"]\n\n    # トークン使用量を追跡するための変数を初期化\n    config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0)\n\n    initial_label_df = initial_labelling(\n        initial_labelling_prompt,\n        clusters_argument_df,\n        sampling_num,\n        model,\n        workers,\n        config[\"provider\"],\n        config.get(\"local_llm_address\"),\n        config,  # configを渡して、トークン使用量を累積できるようにする\n    )\n    print(\"start initial labelling\")\n    initial_clusters_argument_df = clusters_argument_df.merge(\n        initial_label_df,\n        left_on=initial_cluster_id_column,\n        right_on=\"cluster_id\",\n        how=\"left\",\n    ).rename(\n        columns={\n            \"label\": f\"{initial_cluster_id_column.replace('-id', '')}-label\",\n            \"description\": f\"{initial_cluster_id_column.replace('-id', '')}-description\",\n        }\n    )\n    print(\"end initial labelling\")\n    initial_clusters_argument_df.to_csv(path, index=False)\n\n\ndef initial_labelling(\n    prompt: str,\n    clusters_df: pd.DataFrame,\n    sampling_num: int,\n    model: str,\n    workers: int,\n    provider: str = \"openai\",\n    local_llm_address: str | None = None,\n    config: dict | None = None,  # configを追加\n) -\u003e pd.DataFrame:\n    \"\"\"各クラスタに対して初期ラベリングを実行する\n\n    Args:\n        prompt: LLMへのプロンプト\n        clusters_df: クラスタリング結果のDataFrame\n        sampling_num: 各クラスタからサンプリングする意見の数\n        model: 使用するLLMモデル名\n        workers: 並列処理のワーカー数\n        provider: LLMプロバイダー\n        local_llm_address: ローカルLLMのアドレス\n        config: 設定情報を含む辞書（トークン使用量の累積に使用）\n\n    Returns:\n        各クラスタのラベリング結果を含むDataFrame\n    \"\"\"\n    cluster_columns = [col for col in clusters_df.columns if col.startswith(\"cluster-level-\")]\n    initial_cluster_column = cluster_columns[-1]\n    cluster_ids = clusters_df[initial_cluster_column].unique()\n    process_func = partial(\n        process_initial_labelling,\n        df=clusters_df,\n        prompt=prompt,\n        sampling_num=sampling_num,\n        target_column=initial_cluster_column,\n        model=model,\n        provider=provider,\n        local_llm_address=local_llm_address,\n        config=config,  # configを渡す\n    )\n    with ThreadPoolExecutor(max_workers=workers) as executor:\n        results = list(executor.map(process_func, cluster_ids))\n    return pd.DataFrame(results)\n\n\nclass LabellingFromat(BaseModel):\n    \"\"\"ラベリング結果のフォーマットを定義する\"\"\"\n\n    label: str = Field(..., description=\"クラスタのラベル名\")\n    description: str = Field(..., description=\"クラスタの説明文\")\n\n\ndef process_initial_labelling(\n    cluster_id: str,\n    df: pd.DataFrame,\n    prompt: str,\n    sampling_num: int,\n    target_column: str,\n    model: str,\n    provider: str = \"openai\",\n    local_llm_address: str | None = None,\n    config: dict | None = None,  # configを追加\n) -\u003e LabellingResult:\n    \"\"\"個別のクラスタに対してラベリングを実行する\n\n    Args:\n        cluster_id: 処理対象のクラスタID\n        df: クラスタリング結果のDataFrame\n        prompt: LLMへのプロンプト\n        sampling_num: サンプリングする意見の数\n        target_column: クラスタIDが格納されている列名\n        model: 使用するLLMモデル名\n        provider: LLMプロバイダー\n        local_llm_address: ローカルLLMのアドレス\n        config: 設定情報を含む辞書（トークン使用量の累積に使用）\n\n    Returns:\n        クラスタのラベリング結果\n    \"\"\"\n    cluster_data = df[df[target_column] == cluster_id]\n    sampling_num = min(sampling_num, len(cluster_data))\n    cluster = cluster_data.sample(sampling_num)\n    input = \"\\n\".join(cluster[\"argument\"].values)\n    messages = [\n        {\"role\": \"system\", \"content\": prompt},\n        {\"role\": \"user\", \"content\": input},\n    ]\n    try:\n        response_text, token_input, token_output, token_total = request_to_chat_ai(\n            messages=messages,\n            model=model,\n            provider=provider,\n            json_schema=LabellingFromat,\n            local_llm_address=local_llm_address,\n            user_api_key=os.getenv(\"USER_API_KEY\"),\n        )\n\n        # トークン使用量を累積（configが渡されている場合）\n        if config is not None:\n            config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0) + token_total\n            config[\"token_usage_input\"] = config.get(\"token_usage_input\", 0) + token_input\n            config[\"token_usage_output\"] = config.get(\"token_usage_output\", 0) + token_output\n\n        response_json = json.loads(response_text) if isinstance(response_text, str) else response_text\n        return LabellingResult(\n            cluster_id=cluster_id,\n            label=response_json.get(\"label\", \"エラーでラベル名が取得できませんでした\"),\n            description=response_json.get(\"description\", \"エラーで解説が取得できませんでした\"),\n        )\n    except Exception as e:\n        print(e)\n        return LabellingResult(\n            cluster_id=cluster_id,\n            label=\"エラーでラベル名が取得できませんでした\",\n            description=\"エラーで解説が取得できませんでした\",\n        )\n"])</script><script>self.__next_f.push([1,"1a:T337b,"])</script><script>self.__next_f.push([1,"import json\nimport os\nfrom concurrent.futures import ThreadPoolExecutor\nfrom dataclasses import dataclass\nfrom functools import partial\n\nimport numpy as np\nimport pandas as pd\nfrom pydantic import BaseModel, Field\nfrom tqdm import tqdm\n\nfrom services.llm import request_to_chat_ai\n\n\n@dataclass\nclass ClusterColumns:\n    \"\"\"同一階層のクラスター関連のカラム名を管理するクラス\"\"\"\n\n    id: str\n    label: str\n    description: str\n\n    @classmethod\n    def from_id_column(cls, id_column: str) -\u003e \"ClusterColumns\":\n        \"\"\"ID列名から関連するカラム名を生成\"\"\"\n        return cls(\n            id=id_column,\n            label=id_column.replace(\"-id\", \"-label\"),\n            description=id_column.replace(\"-id\", \"-description\"),\n        )\n\n\n@dataclass\nclass ClusterValues:\n    \"\"\"対象クラスタのlabel/descriptionを管理するクラス\"\"\"\n\n    label: str\n    description: str\n\n    def to_prompt_text(self) -\u003e str:\n        return f\"- {self.label}: {self.description}\"\n\n\ndef hierarchical_merge_labelling(config: dict) -\u003e None:\n    \"\"\"階層的クラスタリングの結果に対してマージラベリングを実行する\n\n    Args:\n        config: 設定情報を含む辞書\n            - output_dir: 出力ディレクトリ名\n            - hierarchical_merge_labelling: マージラベリングの設定\n                - sampling_num: サンプリング数\n                - prompt: LLMへのプロンプト\n                - model: 使用するLLMモデル名\n                - workers: 並列処理のワーカー数\n            - provider: LLMプロバイダー\n    \"\"\"\n    dataset = config[\"output_dir\"]\n    merge_path = f\"outputs/{dataset}/hierarchical_merge_labels.csv\"\n    clusters_df = pd.read_csv(f\"outputs/{dataset}/hierarchical_initial_labels.csv\")\n\n    cluster_id_columns: list[str] = _filter_id_columns(clusters_df.columns)\n    # ボトムクラスタのラベル・説明とクラスタid付きの各argumentを入力し、各階層のクラスタラベル・説明を生成し、argumentに付けたdfを作成\n    merge_result_df = merge_labelling(\n        clusters_df=clusters_df,\n        cluster_id_columns=sorted(cluster_id_columns, reverse=True),\n        config=config,\n    )\n    # 上記のdfから各クラスタのlevel, id, label, description, valueを取得してdfを作成\n    melted_df = melt_cluster_data(merge_result_df)\n    # 上記のdfに親子関係を追加\n    parent_child_df = _build_parent_child_mapping(merge_result_df, cluster_id_columns)\n    melted_df = melted_df.merge(parent_child_df, on=[\"level\", \"id\"], how=\"left\")\n    density_df = calculate_cluster_density(melted_df, config)\n    density_df.to_csv(merge_path, index=False)\n\n\ndef _build_parent_child_mapping(df: pd.DataFrame, cluster_id_columns: list[str]):\n    \"\"\"クラスタ間の親子関係をマッピングする\n\n    Args:\n        df: クラスタリング結果のDataFrame\n        cluster_id_columns: クラスタIDのカラム名のリスト\n\n    Returns:\n        親子関係のマッピング情報を含むDataFrame\n    \"\"\"\n    results = []\n    top_cluster_column = cluster_id_columns[0]\n    top_cluster_values = df[top_cluster_column].unique()\n    for c in top_cluster_values:\n        results.append(\n            {\n                \"level\": 1,\n                \"id\": c,\n                \"parent\": \"0\",  # aggregationで追加する全体クラスタのid\n            }\n        )\n\n    for idx in range(len(cluster_id_columns) - 1):\n        current_column = cluster_id_columns[idx]\n        children_column = cluster_id_columns[idx + 1]\n        current_level = current_column.replace(\"-id\", \"\").replace(\"cluster-level-\", \"\")\n        # 現在のレベルのクラスタid\n        current_cluster_values = df[current_column].unique()\n        for current_id in current_cluster_values:\n            children_ids = df.loc[df[current_column] == current_id, children_column].unique()\n            for child_id in children_ids:\n                results.append(\n                    {\n                        \"level\": int(current_level) + 1,\n                        \"id\": child_id,\n                        \"parent\": current_id,\n                    }\n                )\n    return pd.DataFrame(results)\n\n\ndef _filter_id_columns(columns: list[str]) -\u003e list[str]:\n    \"\"\"クラスタIDのカラム名をフィルタリングする\n\n    Args:\n        columns: 全カラム名のリスト\n\n    Returns:\n        クラスタIDのカラム名のリスト\n    \"\"\"\n    return [col for col in columns if col.startswith(\"cluster-level-\") and col.endswith(\"-id\")]\n\n\ndef melt_cluster_data(df: pd.DataFrame) -\u003e pd.DataFrame:\n    \"\"\"クラスタデータを行形式に変換する\n\n    cluster-level-n-(id|label|description) を行形式 (level, id, label, description, value) にまとめる。\n    [cluster-level-n-id, cluster-level-n-label, cluster-level-n-description] を [level, id, label, description, value(件数)] に変換する。\n\n    Args:\n        df: クラスタリング結果のDataFrame\n\n    Returns:\n        行形式に変換されたDataFrame\n    \"\"\"\n    id_columns: list[str] = _filter_id_columns(df.columns)\n    levels: set[int] = {int(col.replace(\"cluster-level-\", \"\").replace(\"-id\", \"\")) for col in id_columns}\n    all_rows: list[dict] = []\n\n    # levelごとに各クラスタの出現件数を集計・縦持ちにする\n    for level in levels:\n        cluster_columns = ClusterColumns.from_id_column(f\"cluster-level-{level}-id\")\n        # クラスタidごとの件数集計\n        level_count_df = df.groupby(cluster_columns.id).size().reset_index(name=\"value\")\n\n        level_unique_val_df = df[\n            [cluster_columns.id, cluster_columns.label, cluster_columns.description]\n        ].drop_duplicates()\n        level_unique_val_df = level_unique_val_df.merge(level_count_df, on=cluster_columns.id, how=\"left\")\n        level_unique_vals = [\n            {\n                \"level\": level,\n                \"id\": row[cluster_columns.id],\n                \"label\": row[cluster_columns.label],\n                \"description\": row[cluster_columns.description],\n                \"value\": row[\"value\"],\n            }\n            for _, row in level_unique_val_df.iterrows()\n        ]\n        all_rows.extend(level_unique_vals)\n    return pd.DataFrame(all_rows)\n\n\ndef merge_labelling(clusters_df: pd.DataFrame, cluster_id_columns: list[str], config) -\u003e pd.DataFrame:\n    \"\"\"階層的なクラスタのマージラベリングを実行する\n\n    Args:\n        clusters_df: クラスタリング結果のDataFrame\n        cluster_id_columns: クラスタIDのカラム名のリスト\n        config: 設定情報を含む辞書\n\n    Returns:\n        マージラベリング結果を含むDataFrame\n    \"\"\"\n    for idx in tqdm(range(len(cluster_id_columns) - 1)):\n        previous_columns = ClusterColumns.from_id_column(cluster_id_columns[idx])\n        current_columns = ClusterColumns.from_id_column(cluster_id_columns[idx + 1])\n\n        process_fn = partial(\n            process_merge_labelling,\n            result_df=clusters_df,\n            current_columns=current_columns,\n            previous_columns=previous_columns,\n            config=config,\n        )\n\n        current_cluster_ids = sorted(clusters_df[current_columns.id].unique())\n        with ThreadPoolExecutor(max_workers=config[\"hierarchical_merge_labelling\"][\"workers\"]) as executor:\n            responses = list(\n                tqdm(\n                    executor.map(process_fn, current_cluster_ids),\n                    total=len(current_cluster_ids),\n                )\n            )\n\n        current_result_df = pd.DataFrame(responses)\n        clusters_df = clusters_df.merge(current_result_df, on=[current_columns.id])\n    return clusters_df\n\n\nclass LabellingFromat(BaseModel):\n    \"\"\"ラベリング結果のフォーマットを定義する\"\"\"\n\n    label: str = Field(..., description=\"クラスタのラベル名\")\n    description: str = Field(..., description=\"クラスタの説明文\")\n\n\ndef process_merge_labelling(\n    target_cluster_id: str,\n    result_df: pd.DataFrame,\n    current_columns: ClusterColumns,\n    previous_columns: ClusterColumns,\n    config,\n):\n    \"\"\"個別のクラスタに対してマージラベリングを実行する\n\n    Args:\n        target_cluster_id: 処理対象のクラスタID\n        result_df: クラスタリング結果のDataFrame\n        current_columns: 現在のレベルのカラム情報\n        previous_columns: 前のレベルのカラム情報\n        config: 設定情報を含む辞書\n\n    Returns:\n        マージラベリング結果を含む辞書\n    \"\"\"\n\n    def filter_previous_values(df: pd.DataFrame, previous_columns: ClusterColumns) -\u003e list[ClusterValues]:\n        \"\"\"前のレベルのクラスタ情報を取得する\"\"\"\n        previous_records = df[df[current_columns.id] == target_cluster_id][\n            [previous_columns.label, previous_columns.description]\n        ].drop_duplicates()\n        previous_values = [\n            ClusterValues(\n                label=row[previous_columns.label],\n                description=row[previous_columns.description],\n            )\n            for _, row in previous_records.iterrows()\n        ]\n        return previous_values\n\n    previous_values = filter_previous_values(result_df, previous_columns)\n    if len(previous_values) == 1:\n        return {\n            current_columns.id: target_cluster_id,\n            current_columns.label: previous_values[0].label,\n            current_columns.description: previous_values[0].description,\n        }\n    elif len(previous_values) == 0:\n        raise ValueError(f\"クラスタ {target_cluster_id} には前のレベルのクラスタが存在しません。\")\n\n    current_cluster_data = result_df[result_df[current_columns.id] == target_cluster_id]\n    sampling_num = min(\n        config[\"hierarchical_merge_labelling\"][\"sampling_num\"],\n        len(current_cluster_data),\n    )\n    sampled_data = current_cluster_data.sample(sampling_num)\n    sampled_argument_text = \"\\n\".join(sampled_data[\"argument\"].values)\n    cluster_text = \"\\n\".join([value.to_prompt_text() for value in previous_values])\n    messages = [\n        {\"role\": \"system\", \"content\": config[\"hierarchical_merge_labelling\"][\"prompt\"]},\n        {\n            \"role\": \"user\",\n            \"content\": \"クラスタラベル\\n\" + cluster_text + \"\\n\" + \"クラスタの意見\\n\" + sampled_argument_text,\n        },\n    ]\n    try:\n        response_text, token_input, token_output, token_total = request_to_chat_ai(\n            messages=messages,\n            model=config[\"hierarchical_merge_labelling\"][\"model\"],\n            json_schema=LabellingFromat,\n            provider=config[\"provider\"],\n            local_llm_address=config.get(\"local_llm_address\"),\n            user_api_key=os.getenv(\"USER_API_KEY\"),\n        )\n\n        config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0) + token_total\n        config[\"token_usage_input\"] = config.get(\"token_usage_input\", 0) + token_input\n        config[\"token_usage_output\"] = config.get(\"token_usage_output\", 0) + token_output\n        print(f\"Merge labelling: input={token_input}, output={token_output}, total={token_total} tokens\")\n\n        response_json = json.loads(response_text) if isinstance(response_text, str) else response_text\n        return {\n            current_columns.id: target_cluster_id,\n            current_columns.label: response_json.get(\"label\", \"エラーでラベル名が取得できませんでした\"),\n            current_columns.description: response_json.get(\"description\", \"エラーで解説が取得できませんでした\"),\n        }\n    except Exception as e:\n        print(f\"エラーが発生しました: {e}\")\n        return {\n            current_columns.id: target_cluster_id,\n            current_columns.label: \"エラーでラベル名が取得できませんでした\",\n            current_columns.description: \"エラーで解説が取得できませんでした\",\n        }\n\n\ndef calculate_cluster_density(melted_df: pd.DataFrame, config: dict):\n    \"\"\"クラスタ内の密度計算\"\"\"\n    hierarchical_cluster_df = pd.read_csv(f\"outputs/{config['output_dir']}/hierarchical_clusters.csv\")\n\n    densities = []\n    for level, c_id in zip(melted_df[\"level\"], melted_df[\"id\"], strict=False):\n        cluster_embeds = hierarchical_cluster_df[hierarchical_cluster_df[f\"cluster-level-{level}-id\"] == c_id][\n            [\"x\", \"y\"]\n        ].values\n        density = calculate_density(cluster_embeds)\n        densities.append(density)\n\n    # 密度のランクを計算\n    melted_df[\"density\"] = densities\n    melted_df[\"density_rank\"] = melted_df.groupby(\"level\")[\"density\"].rank(ascending=False, method=\"first\")\n    melted_df[\"density_rank_percentile\"] = melted_df.groupby(\"level\")[\"density_rank\"].transform(lambda x: x / len(x))\n    return melted_df\n\n\ndef calculate_density(embeds: np.ndarray):\n    \"\"\"平均距離に基づいて密度を計算\"\"\"\n    center = np.mean(embeds, axis=0)\n    distances = np.linalg.norm(embeds - center, axis=1)\n    avg_distance = np.mean(distances)\n    density = 1 / (avg_distance + 1e-10)\n    return density\n"])</script><script>self.__next_f.push([1,"1b:Ta82,"])</script><script>self.__next_f.push([1,"\"\"\"Create summaries for the clusters.\"\"\"\n\nimport json\nimport os\nimport re\n\nimport pandas as pd\nfrom pydantic import BaseModel, Field\n\nfrom services.llm import request_to_chat_ai\n\n\nclass OverviewResponse(BaseModel):\n    summary: str = Field(..., description=\"クラスターの全体的な要約\")\n\n\ndef hierarchical_overview(config):\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/hierarchical_overview.txt\"\n\n    hierarchical_label_df = pd.read_csv(f\"outputs/{dataset}/hierarchical_merge_labels.csv\")\n\n    prompt = config[\"hierarchical_overview\"][\"prompt\"]\n    model = config[\"hierarchical_overview\"][\"model\"]\n\n    # TODO: level1で固定にしているが、設定で変えられるようにする\n    target_level = 1\n    target_records = hierarchical_label_df[hierarchical_label_df[\"level\"] == target_level]\n    ids = target_records[\"id\"].to_list()\n    labels = target_records[\"label\"].to_list()\n    descriptions = target_records[\"description\"].to_list()\n    target_records.set_index(\"id\", inplace=True)\n\n    input_text = \"\"\n    for i, _ in enumerate(ids):\n        input_text += f\"# Cluster {i}/{len(ids)}: {labels[i]}\\n\\n\"\n        input_text += descriptions[i] + \"\\n\\n\"\n\n    messages = [{\"role\": \"system\", \"content\": prompt}, {\"role\": \"user\", \"content\": input_text}]\n    response_text, token_input, token_output, token_total = request_to_chat_ai(\n        messages=messages,\n        model=model,\n        provider=config[\"provider\"],\n        local_llm_address=config.get(\"local_llm_address\"),\n        user_api_key=os.getenv(\"USER_API_KEY\"),\n        json_schema=OverviewResponse,\n    )\n\n    # トークン使用量を累積\n    config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0) + token_total\n    config[\"token_usage_input\"] = config.get(\"token_usage_input\", 0) + token_input\n    config[\"token_usage_output\"] = config.get(\"token_usage_output\", 0) + token_output\n    print(f\"Hierarchical overview: input={token_input}, output={token_output}, total={token_total} tokens\")\n\n    try:\n        # structured outputとしてパースできるなら処理する\n        if isinstance(response_text, dict):\n            parsed_response = response_text\n        else:\n            parsed_response = json.loads(response_text)\n\n        with open(path, \"w\") as file:\n            file.write(parsed_response[\"summary\"])\n\n    except Exception:\n        # thinkタグが出力されるReasoningモデル用に、thinkタグを除去する\n        thinking_removed = re.sub(\n            r\"\u003cthink\\b[^\u003e]*\u003e.*?\u003c/think\u003e\",\n            \"\",\n            response_text,\n            flags=re.DOTALL,\n        )\n\n        with open(path, \"w\") as file:\n            file.write(thinking_removed)\n"])</script><script>self.__next_f.push([1,"1c:T3f38,"])</script><script>self.__next_f.push([1,"\"\"\"Generate a convenient JSON output file.\"\"\"\n\nimport json\nfrom collections import defaultdict\nfrom pathlib import Path\nfrom typing import Any, TypedDict\n\nimport numpy as np\nimport pandas as pd\n\nROOT_DIR = Path(__file__).parent.parent.parent.parent\nCONFIG_DIR = ROOT_DIR / \"scatter\" / \"pipeline\" / \"configs\"\nPIPELINE_DIR = ROOT_DIR / \"broadlistening\" / \"pipeline\"\n\n\ndef json_serialize_numpy(obj: Any) -\u003e Any:\n    \"\"\"\n    Recursively convert NumPy data types to native Python types for JSON serialization.\n\n    Args:\n        obj: Any Python object which might contain NumPy data types\n\n    Returns:\n        The same object structure with NumPy types converted to Python native types\n    \"\"\"\n    if isinstance(obj, np.integer):\n        return int(obj)\n    elif isinstance(obj, np.floating):\n        return float(obj)\n    elif isinstance(obj, np.ndarray):\n        return obj.tolist()\n    elif isinstance(obj, dict):\n        return {k: json_serialize_numpy(v) for k, v in obj.items()}\n    elif isinstance(obj, list):\n        return [json_serialize_numpy(item) for item in obj]\n    elif isinstance(obj, tuple):\n        return tuple(json_serialize_numpy(item) for item in obj)\n    else:\n        return obj\n\n\nclass Argument(TypedDict):\n    arg_id: str\n    argument: str\n    comment_id: str\n    x: float\n    y: float\n    p: float\n    cluster_ids: list[str]\n    attributes: dict[str, str] | None\n    url: str | None\n\n\nclass Cluster(TypedDict):\n    level: int\n    id: str\n    label: str\n    takeaway: str\n    value: int\n    parent: str\n    density_rank_percentile: float | None\n\n\ndef hierarchical_aggregation(config) -\u003e bool:\n    try:\n        path = f\"outputs/{config['output_dir']}/hierarchical_result.json\"\n        results = {\n            \"arguments\": [],\n            \"clusters\": [],\n            \"comments\": {},\n            \"propertyMap\": {},\n            \"translations\": {},\n            \"overview\": \"\",\n            \"config\": config,\n        }\n\n        arguments = pd.read_csv(f\"outputs/{config['output_dir']}/args.csv\")\n        arguments.set_index(\"arg-id\", inplace=True)\n        arg_num = len(arguments)\n        relation_df = pd.read_csv(f\"outputs/{config['output_dir']}/relations.csv\")\n        comments = pd.read_csv(f\"inputs/{config['input']}.csv\")\n        clusters = pd.read_csv(f\"outputs/{config['output_dir']}/hierarchical_clusters.csv\")\n        labels = pd.read_csv(f\"outputs/{config['output_dir']}/hierarchical_merge_labels.csv\")\n\n        hidden_properties_map: dict[str, list[str]] = config[\"hierarchical_aggregation\"][\"hidden_properties\"]\n\n        results[\"arguments\"] = _build_arguments(clusters, comments, relation_df, config)\n        results[\"clusters\"] = _build_cluster_value(labels, arg_num)\n\n        # results[\"comments\"] = _build_comments_value(\n        #     comments, arguments, hidden_properties_map\n        # )\n        results[\"comment_num\"] = len(comments)\n        results[\"translations\"] = _build_translations(config)\n        # 属性情報のカラムは、元データに対して指定したカラムとclassificationするカテゴリを合わせたもの\n        results[\"propertyMap\"] = _build_property_map(arguments, comments, hidden_properties_map, config)\n\n        with open(f\"outputs/{config['output_dir']}/hierarchical_overview.txt\") as f:\n            overview = f.read()\n        print(\"overview\")\n        print(overview)\n        results[\"overview\"] = overview\n\n        # Convert non-serializable NumPy types to native Python types\n        results = json_serialize_numpy(results)\n\n        with open(path, \"w\") as file:\n            json.dump(results, file, indent=2, ensure_ascii=False)\n        # TODO: サンプリングロジックを実装したいが、現状は全件抽出\n        create_custom_intro(config)\n        if config[\"is_pubcom\"]:\n            add_original_comments(labels, arguments, relation_df, clusters, config)\n        return True\n    except Exception as e:\n        print(\"error\")\n        print(e)\n        return False\n\n\ndef create_custom_intro(config):\n    dataset = config[\"output_dir\"]\n    args_path = PIPELINE_DIR / f\"outputs/{dataset}/args.csv\"\n    comments = pd.read_csv(PIPELINE_DIR / f\"inputs/{config['input']}.csv\")\n    result_path = PIPELINE_DIR / f\"outputs/{dataset}/hierarchical_result.json\"\n\n    input_count = len(comments)\n    args_count = len(pd.read_csv(args_path))\n    processed_num = min(input_count, config[\"extraction\"][\"limit\"])\n\n    print(f\"Input count: {input_count}\")\n    print(f\"Args count: {args_count}\")\n\n    # LLMプロバイダーとモデル名の判定\n    def get_llm_provider_display():\n        # configからプロバイダー情報を取得（優先）\n        provider = config.get(\"provider\", \"openai\")\n        model = config.get(\"model\", \"unknown\")\n\n        # プロバイダー名をマッピング\n        provider_names = {\n            \"openai\": \"OpenAI API\",\n            \"azure\": \"Azure OpenAI API\",\n            \"openrouter\": \"OpenRouter API\",\n            \"local\": \"Local LLM\",\n        }\n\n        provider_name = provider_names.get(provider, f\"{provider} API\")\n        return f\"{provider_name} ({model})\"\n\n    llm_provider = get_llm_provider_display()\n\n    base_custom_intro = \"\"\"{intro}\n分析対象となったデータの件数は{processed_num}件で、これらのデータに対して{llm_provider}を用いて{args_count}件の意見（議論）を抽出し、クラスタリングを行った。\n\"\"\"\n\n    intro = config[\"intro\"]\n    custom_intro = base_custom_intro.format(\n        intro=intro, processed_num=processed_num, args_count=args_count, llm_provider=llm_provider\n    )\n\n    with open(result_path) as f:\n        result = json.load(f)\n    result[\"config\"][\"intro\"] = custom_intro\n    with open(result_path, \"w\") as f:\n        json.dump(result, f, indent=2, ensure_ascii=False)\n\n\ndef add_original_comments(labels, arguments, relation_df, clusters, config):\n    # 大カテゴリ（cluster-level-1）に該当するラベルだけ抽出\n    labels_lv1 = labels[labels[\"level\"] == 1][[\"id\", \"label\"]].rename(\n        columns={\"id\": \"cluster-level-1-id\", \"label\": \"category_label\"}\n    )\n\n    # arguments と clusters をマージ（カテゴリ情報付与）\n    merged = arguments.merge(clusters[[\"arg-id\", \"cluster-level-1-id\"]], on=\"arg-id\").merge(\n        labels_lv1, on=\"cluster-level-1-id\", how=\"left\"\n    )\n\n    # relation_df と結合\n    merged = merged.merge(relation_df, on=\"arg-id\", how=\"left\")\n\n    # 元コメント取得\n    comments = pd.read_csv(PIPELINE_DIR / f\"inputs/{config['input']}.csv\")\n    comments[\"comment-id\"] = comments[\"comment-id\"].astype(str)\n    merged[\"comment-id\"] = merged[\"comment-id\"].astype(str)\n\n    # 元コメント本文などとマージ\n    final_df = merged.merge(comments, on=\"comment-id\", how=\"left\")\n\n    # 必要カラムのみ整形\n    final_cols = [\"comment-id\", \"comment-body\", \"arg-id\", \"argument\", \"cluster-level-1-id\", \"category_label\"]\n\n    # 基本カラム\n    for col in [\"x\", \"y\", \"source\", \"url\"]:\n        if col in comments.columns:\n            final_cols.append(col)\n\n    # 属性カラムを追加\n    attribute_columns = []\n    for col in comments.columns:\n        # attributeプレフィックスが付いたカラムを探す\n        if col.startswith(\"attribute_\"):\n            attribute_columns.append(col)\n            final_cols.append(col)\n\n    print(f\"属性カラム検出: {attribute_columns}\")\n\n    # 必要なカラムだけ選択\n    final_df = final_df[final_cols]\n    final_df = final_df.rename(\n        columns={\n            \"cluster-level-1-id\": \"category_id\",\n            \"category_label\": \"category\",\n            \"arg-id\": \"arg_id\",\n            \"argument\": \"argument\",\n            \"comment-body\": \"original-comment\",\n        }\n    )\n\n    # 保存\n    final_df.to_csv(PIPELINE_DIR / f\"outputs/{config['output_dir']}/final_result_with_comments.csv\", index=False)\n\n\ndef _build_arguments(\n    clusters: pd.DataFrame, comments: pd.DataFrame, relation_df: pd.DataFrame, config: dict\n) -\u003e list[Argument]:\n    \"\"\"\n    Build the arguments list including attribute information from original comments\n\n    Args:\n        clusters: DataFrame containing cluster information for each argument\n        comments: DataFrame containing original comments with attribute columns\n        relation_df: DataFrame relating arguments to original comments\n        config: Configuration dictionary containing enable_source_link setting\n    \"\"\"\n    cluster_columns = [col for col in clusters.columns if col.startswith(\"cluster-level-\") and \"id\" in col]\n\n    # Prepare for merging with original comments to get attributes\n    comments_copy = comments.copy()\n    comments_copy[\"comment-id\"] = comments_copy[\"comment-id\"].astype(str)\n\n    # Get argument to comment mapping\n    arg_comment_map = {}\n    if \"comment-id\" in relation_df.columns:\n        relation_df[\"comment-id\"] = relation_df[\"comment-id\"].astype(str)\n        arg_comment_map = dict(zip(relation_df[\"arg-id\"], relation_df[\"comment-id\"], strict=False))\n\n    # Find attribute columns in comments dataframe\n    attribute_columns = [col for col in comments.columns if col.startswith(\"attribute_\")]\n    print(f\"属性カラム検出: {attribute_columns}\")\n\n    arguments: list[Argument] = []\n    for _, row in clusters.iterrows():\n        cluster_ids = [\"0\"]\n        for cluster_column in cluster_columns:\n            cluster_ids.append(str(row[cluster_column]))  # Convert to string to ensure serializable\n\n        # Create base argument\n        argument: Argument = {\n            \"arg_id\": str(row[\"arg-id\"]),  # Convert to string to ensure serializable\n            \"argument\": str(row[\"argument\"]),\n            \"x\": float(row[\"x\"]),  # Convert to native float\n            \"y\": float(row[\"y\"]),  # Convert to native float\n            \"p\": 0,  # NOTE: 一旦全部0でいれる\n            \"cluster_ids\": cluster_ids,\n            \"attributes\": None,\n            \"url\": None,\n        }\n\n        # Add attributes and URL if available\n        if row[\"arg-id\"] in arg_comment_map:\n            comment_id = arg_comment_map[row[\"arg-id\"]]\n            comment_rows = comments_copy[comments_copy[\"comment-id\"] == comment_id]\n\n            if not comment_rows.empty:\n                comment_row = comment_rows.iloc[0]\n\n                # Add URL if available and enabled\n                if config.get(\"enable_source_link\", False) and \"url\" in comment_row and comment_row[\"url\"] is not None:\n                    argument[\"url\"] = str(comment_row[\"url\"])\n\n                # Add attributes if available\n                if attribute_columns:\n                    attributes = {}\n                    for attr_col in attribute_columns:\n                        # Remove \"attribute_\" prefix for cleaner attribute names\n                        attr_name = attr_col[len(\"attribute_\") :]\n                        # Convert potential numpy types to Python native types\n                        attr_value = comment_row.get(attr_col, None)\n                        if attr_value is not None:\n                            if isinstance(attr_value, np.integer):\n                                attr_value = int(attr_value)\n                            elif isinstance(attr_value, np.floating):\n                                attr_value = float(attr_value)\n                            elif isinstance(attr_value, np.ndarray):\n                                attr_value = attr_value.tolist()\n                        attributes[attr_name] = attr_value\n\n                    # Only add non-empty attributes\n                    if any(v is not None for v in attributes.values()):\n                        argument[\"attributes\"] = attributes\n\n        arguments.append(argument)\n    return arguments\n\n\ndef _build_cluster_value(melted_labels: pd.DataFrame, total_num: int) -\u003e list[Cluster]:\n    results: list[Cluster] = [\n        Cluster(\n            level=0,\n            id=\"0\",\n            label=\"全体\",\n            takeaway=\"\",\n            value=int(total_num),  # Convert to native int\n            parent=\"\",\n            density_rank_percentile=0,\n        )\n    ]\n\n    for _, melted_label in melted_labels.iterrows():\n        # Convert potential NumPy types to native Python types\n        level = (\n            int(melted_label[\"level\"]) if isinstance(melted_label[\"level\"], int | np.integer) else melted_label[\"level\"]\n        )\n        cluster_id = str(melted_label[\"id\"])\n        label = str(melted_label[\"label\"])\n        takeaway = str(melted_label[\"description\"])\n        value = (\n            int(melted_label[\"value\"]) if isinstance(melted_label[\"value\"], int | np.integer) else melted_label[\"value\"]\n        )\n        parent = str(melted_label.get(\"parent\", \"全体\"))\n\n        # Handle density_rank_percentile which might be None or a numeric value\n        density_rank = melted_label.get(\"density_rank_percentile\")\n        if density_rank is not None:\n            if isinstance(density_rank, float | np.floating):\n                density_rank = float(density_rank)\n            elif isinstance(density_rank, int | np.integer):\n                density_rank = int(density_rank)\n\n        cluster_value = Cluster(\n            level=level,\n            id=cluster_id,\n            label=label,\n            takeaway=takeaway,\n            value=value,\n            parent=parent,\n            density_rank_percentile=density_rank,\n        )\n        results.append(cluster_value)\n    return results\n\n\ndef _build_comments_value(\n    comments: pd.DataFrame,\n    arguments: pd.DataFrame,\n    hidden_properties_map: dict[str, list[str]],\n):\n    comment_dict: dict[str, dict[str, str]] = {}\n    useful_comment_ids = set(arguments[\"comment-id\"].values)\n    for _, row in comments.iterrows():\n        id = row[\"comment-id\"]\n        if id in useful_comment_ids:\n            res = {\"comment\": row[\"comment-body\"]}\n            should_skip = any(row[prop] in hidden_values for prop, hidden_values in hidden_properties_map.items())\n            if should_skip:\n                continue\n            comment_dict[str(id)] = res\n\n    return comment_dict\n\n\ndef _build_translations(config):\n    languages = list(config.get(\"translation\", {}).get(\"languages\", []))\n    if len(languages) \u003e 0:\n        with open(PIPELINE_DIR / f\"outputs/{config['output_dir']}/translations.json\") as f:\n            translations = f.read()\n        return json.loads(translations)\n    return {}\n\n\ndef _build_property_map(\n    arguments: pd.DataFrame, comments: pd.DataFrame, hidden_properties_map: dict[str, list[str]], config: dict\n) -\u003e dict[str, dict[str, str]]:\n    property_columns = list(hidden_properties_map.keys()) + list(config[\"extraction\"][\"categories\"].keys())\n    property_map = defaultdict(dict)\n\n    # 指定された property_columns が arguments に存在するかチェック\n    missing_cols = [col for col in property_columns if col not in arguments.columns]\n    if missing_cols:\n        raise ValueError(\n            f\"指定されたカラム {missing_cols} が args.csv に存在しません。\"\n            \"設定ファイルaggregation / hidden_propertiesから該当カラムを取り除いてください。\"\n        )\n\n    for prop in property_columns:\n        for arg_id, row in arguments.iterrows():\n            # LLMによるcategory classificationがうまく行かず、NaNの場合はNoneにする\n            value = row[prop] if not pd.isna(row[prop]) else None\n\n            # Convert NumPy types to Python native types\n            if value is not None:\n                if isinstance(value, np.integer):\n                    value = int(value)\n                elif isinstance(value, np.floating):\n                    value = float(value)\n                elif isinstance(value, np.ndarray):\n                    value = value.tolist()\n                else:\n                    # Convert any other types to string to ensure serialization\n                    try:\n                        value = str(value)\n                    except Exception as e:\n                        print(f\"Error converting value to string: {e}\")\n                        value = None\n\n            # Make sure arg_id is string\n            str_arg_id = str(arg_id)\n            property_map[prop][str_arg_id] = value\n\n    return property_map\n"])</script><script>self.__next_f.push([1,"1d:T194c,"])</script><script>self.__next_f.push([1,"import concurrent.futures\nimport json\nimport logging\nimport os\nimport re\n\nimport pandas as pd\nfrom pydantic import BaseModel, Field\nfrom tqdm import tqdm\n\nfrom services.llm import request_to_chat_ai\nfrom services.parse_json_list import parse_extraction_response\nfrom utils import update_progress\n\nCOMMA_AND_SPACE_AND_RIGHT_BRACKET = re.compile(r\",\\s*(\\])\")\n\n\nclass ExtractionResponse(BaseModel):\n    extractedOpinionList: list[str] = Field(..., description=\"抽出した意見のリスト\")\n\n\ndef _validate_property_columns(property_columns: list[str], comments: pd.DataFrame) -\u003e None:\n    if not all(property in comments.columns for property in property_columns):\n        raise ValueError(f\"Properties {property_columns} not found in comments. Columns are {comments.columns}\")\n\n\ndef extraction(config):\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/args.csv\"\n    model = config[\"extraction\"][\"model\"]\n    prompt = config[\"extraction\"][\"prompt\"]\n    workers = config[\"extraction\"][\"workers\"]\n    limit = config[\"extraction\"][\"limit\"]\n    property_columns = config[\"extraction\"][\"properties\"]\n\n    if \"provider\" not in config:\n        raise RuntimeError(\"provider is not set\")\n    provider = config[\"provider\"]\n\n    # カラム名だけを読み込み、必要なカラムが含まれているか確認する\n    comments = pd.read_csv(f\"inputs/{config['input']}.csv\", nrows=0)\n    _validate_property_columns(property_columns, comments)\n    # エラーが出なかった場合、すべての行を読み込む\n    comments = pd.read_csv(\n        f\"inputs/{config['input']}.csv\", usecols=[\"comment-id\", \"comment-body\"] + config[\"extraction\"][\"properties\"]\n    )\n    comment_ids = (comments[\"comment-id\"].values)[:limit]\n    comments.set_index(\"comment-id\", inplace=True)\n    results = pd.DataFrame()\n    update_progress(config, total=len(comment_ids))\n\n    argument_map = {}\n    relation_rows = []\n\n    for i in tqdm(range(0, len(comment_ids), workers)):\n        batch = comment_ids[i : i + workers]\n        batch_inputs = [comments.loc[id][\"comment-body\"] for id in batch]\n        batch_results = extract_batch(\n            batch_inputs, prompt, model, workers, provider, config.get(\"local_llm_address\"), config\n        )\n\n        for comment_id, extracted_args in zip(batch, batch_results, strict=False):\n            for j, arg in enumerate(extracted_args):\n                if arg not in argument_map:\n                    # argumentテーブルに追加\n                    arg_id = f\"A{comment_id}_{j}\"\n                    argument = arg\n                    argument_map[arg] = {\n                        \"arg-id\": arg_id,\n                        \"argument\": argument,\n                    }\n                else:\n                    arg_id = argument_map[arg][\"arg-id\"]\n\n                # relationテーブルにcommentとargの関係を追加\n                relation_row = {\n                    \"arg-id\": arg_id,\n                    \"comment-id\": comment_id,\n                }\n                relation_rows.append(relation_row)\n\n        update_progress(config, incr=len(batch))\n\n    # DataFrame化\n    results = pd.DataFrame(argument_map.values())\n    relation_df = pd.DataFrame(relation_rows)\n\n    if results.empty:\n        raise RuntimeError(\"result is empty, maybe bad prompt\")\n\n    results.to_csv(path, index=False)\n    # comment-idとarg-idの関係を保存\n    relation_df.to_csv(f\"outputs/{dataset}/relations.csv\", index=False)\n\n\nlogging.basicConfig(level=logging.DEBUG)\n\n\ndef extract_batch(batch, prompt, model, workers, provider=\"openai\", local_llm_address=None, config=None):\n    with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor:\n        futures_with_index = [\n            (i, executor.submit(extract_arguments, input, prompt, model, provider, local_llm_address))\n            for i, input in enumerate(batch)\n        ]\n\n        done, not_done = concurrent.futures.wait([f for _, f in futures_with_index], timeout=30)\n        results = [[] for _ in range(len(batch))]\n        total_token_input = 0\n        total_token_output = 0\n        total_token_usage = 0\n\n        for _, future in futures_with_index:\n            if future in not_done and not future.cancelled():\n                future.cancel()\n\n        for i, future in futures_with_index:\n            if future in done:\n                try:\n                    result = future.result()\n                    if isinstance(result, tuple) and len(result) == 4:\n                        items, token_input, token_output, token_total = result\n                        results[i] = items\n                        total_token_input += token_input\n                        total_token_output += token_output\n                        total_token_usage += token_total\n                    else:\n                        results[i] = result\n                except Exception as e:\n                    logging.error(f\"Task {future} failed with error: {e}\")\n                    results[i] = []\n\n        if config is not None:\n            config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0) + total_token_usage\n            config[\"token_usage_input\"] = config.get(\"token_usage_input\", 0) + total_token_input\n            config[\"token_usage_output\"] = config.get(\"token_usage_output\", 0) + total_token_output\n            print(\n                f\"Extraction batch: input={total_token_input}, output={total_token_output}, total={total_token_usage} tokens\"\n            )\n\n        return results\n\n\ndef extract_arguments(input, prompt, model, provider=\"openai\", local_llm_address=None):\n    messages = [\n        {\"role\": \"system\", \"content\": prompt},\n        {\"role\": \"user\", \"content\": input},\n    ]\n    try:\n        response, token_input, token_output, token_total = request_to_chat_ai(\n            messages=messages,\n            model=model,\n            is_json=False,\n            json_schema=ExtractionResponse,\n            provider=provider,\n            local_llm_address=local_llm_address,\n            user_api_key=os.getenv(\"USER_API_KEY\"),\n        )\n        items = parse_extraction_response(response)\n        items = list(filter(None, items))  # omit empty strings\n        return items, token_input, token_output, token_total\n    except json.decoder.JSONDecodeError as e:\n        print(\"JSON error:\", e)\n        print(\"Input was:\", input)\n        print(\"Response was:\", response)\n        print(\"Silently giving up on trying to generate valid list.\")\n        return []\n"])</script><script>self.__next_f.push([1,"1e:T1149,"])</script><script>self.__next_f.push([1,"\"\"\"Cluster the arguments using UMAP + HDBSCAN and GPT-4.\"\"\"\n\nfrom importlib import import_module\n\nimport numpy as np\nimport pandas as pd\nimport scipy.cluster.hierarchy as sch\nfrom sklearn.cluster import KMeans\n\n\ndef hierarchical_clustering(config):\n    UMAP = import_module(\"umap\").UMAP\n\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/hierarchical_clusters.csv\"\n    arguments_df = pd.read_csv(f\"outputs/{dataset}/args.csv\", usecols=[\"arg-id\", \"argument\"])\n    embeddings_df = pd.read_pickle(f\"outputs/{dataset}/embeddings.pkl\")\n    embeddings_array = np.asarray(embeddings_df[\"embedding\"].values.tolist())\n    cluster_nums = config[\"hierarchical_clustering\"][\"cluster_nums\"]\n\n    n_samples = embeddings_array.shape[0]\n    # デフォルト設定は15\n    default_n_neighbors = 15\n\n    # テスト等サンプルが少なすぎる場合、n_neighborsの設定値を下げる\n    if n_samples \u003c= default_n_neighbors:\n        n_neighbors = max(2, n_samples - 1)  # 最低2以上\n    else:\n        n_neighbors = default_n_neighbors\n\n    umap_model = UMAP(random_state=42, n_components=2, n_neighbors=n_neighbors)\n    # TODO 詳細エラーメッセージを加える\n    # 以下のエラーの場合、おそらく元の意見件数が少なすぎることが原因\n    # TypeError: Cannot use scipy.linalg.eigh for sparse A with k \u003e= N. Use scipy.linalg.eigh(A.toarray()) or reduce k.\n    umap_embeds = umap_model.fit_transform(embeddings_array)\n\n    cluster_results = hierarchical_clustering_embeddings(\n        umap_embeds=umap_embeds,\n        cluster_nums=cluster_nums,\n    )\n    result_df = pd.DataFrame(\n        {\n            \"arg-id\": arguments_df[\"arg-id\"],\n            \"argument\": arguments_df[\"argument\"],\n            \"x\": umap_embeds[:, 0],\n            \"y\": umap_embeds[:, 1],\n        }\n    )\n\n    for cluster_level, final_labels in enumerate(cluster_results.values(), start=1):\n        result_df[f\"cluster-level-{cluster_level}-id\"] = [f\"{cluster_level}_{label}\" for label in final_labels]\n\n    result_df.to_csv(path, index=False)\n\n\ndef generate_cluster_count_list(min_clusters: int, max_clusters: int):\n    cluster_counts = []\n    current = min_clusters\n    cluster_counts.append(current)\n\n    if min_clusters == max_clusters:\n        return cluster_counts\n\n    while True:\n        next_double = current * 2\n        next_triple = current * 3\n\n        if next_double \u003e= max_clusters:\n            if cluster_counts[-1] != max_clusters:\n                cluster_counts.append(max_clusters)\n            break\n\n        # 次の倍はまだ max_clusters に収まるが、3倍だと超える\n        # -\u003e (次の倍は細かすぎるので)スキップして max_clusters に飛ぶ\n        if next_triple \u003e max_clusters:\n            cluster_counts.append(max_clusters)\n            break\n\n        cluster_counts.append(next_double)\n        current = next_double\n\n    return cluster_counts\n\n\ndef merge_clusters_with_hierarchy(\n    cluster_centers: np.ndarray,\n    kmeans_labels: np.ndarray,\n    umap_array: np.ndarray,\n    n_cluster_cut: int,\n):\n    Z = sch.linkage(cluster_centers, method=\"ward\")\n    cluster_labels_merged = sch.fcluster(Z, t=n_cluster_cut, criterion=\"maxclust\")\n\n    n_samples = umap_array.shape[0]\n    final_labels = np.zeros(n_samples, dtype=int)\n\n    for i in range(n_samples):\n        original_label = kmeans_labels[i]\n        final_labels[i] = cluster_labels_merged[original_label]\n\n    return final_labels\n\n\ndef hierarchical_clustering_embeddings(\n    umap_embeds,\n    cluster_nums,\n):\n    # 最大分割数でクラスタリングを実施\n    print(\"start initial clustering\")\n    initial_cluster_num = cluster_nums[-1]\n    kmeans_model = KMeans(n_clusters=initial_cluster_num, random_state=42)\n    kmeans_model.fit(umap_embeds)\n    print(\"end initial clustering\")\n\n    results = {}\n    print(\"start hierarchical clustering\")\n    cluster_nums.sort()\n    print(cluster_nums)\n    for n_cluster_cut in cluster_nums[:-1]:\n        print(\"n_cluster_cut: \", n_cluster_cut)\n        final_labels = merge_clusters_with_hierarchy(\n            cluster_centers=kmeans_model.cluster_centers_,\n            kmeans_labels=kmeans_model.labels_,\n            umap_array=umap_embeds,\n            n_cluster_cut=n_cluster_cut,\n        )\n        results[n_cluster_cut] = final_labels\n\n    results[initial_cluster_num] = kmeans_model.labels_\n    print(\"end hierarchical clustering\")\n\n    return results\n"])</script><script>self.__next_f.push([1,"1f:T1c36,"])</script><script>self.__next_f.push([1,"import json\nimport os\nfrom concurrent.futures import ThreadPoolExecutor\nfrom functools import partial\nfrom typing import TypedDict\n\nimport pandas as pd\nfrom pydantic import BaseModel, Field\n\nfrom services.llm import request_to_chat_ai\n\n\nclass LabellingResult(TypedDict):\n    \"\"\"各クラスタのラベリング結果を表す型\"\"\"\n\n    cluster_id: str  # クラスタのID\n    label: str  # クラスタのラベル名\n    description: str  # クラスタの説明文\n\n\ndef hierarchical_initial_labelling(config: dict) -\u003e None:\n    \"\"\"階層的クラスタリングの初期ラベリングを実行する\n\n    Args:\n        config: 設定情報を含む辞書\n            - output_dir: 出力ディレクトリ名\n            - hierarchical_initial_labelling: 初期ラベリングの設定\n                - sampling_num: サンプリング数\n                - prompt: LLMへのプロンプト\n                - model: 使用するLLMモデル名\n                - workers: 並列処理のワーカー数\n            - provider: LLMプロバイダー\n    \"\"\"\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/hierarchical_initial_labels.csv\"\n    clusters_argument_df = pd.read_csv(f\"outputs/{dataset}/hierarchical_clusters.csv\")\n\n    cluster_id_columns = [col for col in clusters_argument_df.columns if col.startswith(\"cluster-level-\")]\n    initial_cluster_id_column = cluster_id_columns[-1]\n    sampling_num = config[\"hierarchical_initial_labelling\"][\"sampling_num\"]\n    initial_labelling_prompt = config[\"hierarchical_initial_labelling\"][\"prompt\"]\n    model = config[\"hierarchical_initial_labelling\"][\"model\"]\n    workers = config[\"hierarchical_initial_labelling\"][\"workers\"]\n\n    # トークン使用量を追跡するための変数を初期化\n    config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0)\n\n    initial_label_df = initial_labelling(\n        initial_labelling_prompt,\n        clusters_argument_df,\n        sampling_num,\n        model,\n        workers,\n        config[\"provider\"],\n        config.get(\"local_llm_address\"),\n        config,  # configを渡して、トークン使用量を累積できるようにする\n    )\n    print(\"start initial labelling\")\n    initial_clusters_argument_df = clusters_argument_df.merge(\n        initial_label_df,\n        left_on=initial_cluster_id_column,\n        right_on=\"cluster_id\",\n        how=\"left\",\n    ).rename(\n        columns={\n            \"label\": f\"{initial_cluster_id_column.replace('-id', '')}-label\",\n            \"description\": f\"{initial_cluster_id_column.replace('-id', '')}-description\",\n        }\n    )\n    print(\"end initial labelling\")\n    initial_clusters_argument_df.to_csv(path, index=False)\n\n\ndef initial_labelling(\n    prompt: str,\n    clusters_df: pd.DataFrame,\n    sampling_num: int,\n    model: str,\n    workers: int,\n    provider: str = \"openai\",\n    local_llm_address: str | None = None,\n    config: dict | None = None,  # configを追加\n) -\u003e pd.DataFrame:\n    \"\"\"各クラスタに対して初期ラベリングを実行する\n\n    Args:\n        prompt: LLMへのプロンプト\n        clusters_df: クラスタリング結果のDataFrame\n        sampling_num: 各クラスタからサンプリングする意見の数\n        model: 使用するLLMモデル名\n        workers: 並列処理のワーカー数\n        provider: LLMプロバイダー\n        local_llm_address: ローカルLLMのアドレス\n        config: 設定情報を含む辞書（トークン使用量の累積に使用）\n\n    Returns:\n        各クラスタのラベリング結果を含むDataFrame\n    \"\"\"\n    cluster_columns = [col for col in clusters_df.columns if col.startswith(\"cluster-level-\")]\n    initial_cluster_column = cluster_columns[-1]\n    cluster_ids = clusters_df[initial_cluster_column].unique()\n    process_func = partial(\n        process_initial_labelling,\n        df=clusters_df,\n        prompt=prompt,\n        sampling_num=sampling_num,\n        target_column=initial_cluster_column,\n        model=model,\n        provider=provider,\n        local_llm_address=local_llm_address,\n        config=config,  # configを渡す\n    )\n    with ThreadPoolExecutor(max_workers=workers) as executor:\n        results = list(executor.map(process_func, cluster_ids))\n    return pd.DataFrame(results)\n\n\nclass LabellingFromat(BaseModel):\n    \"\"\"ラベリング結果のフォーマットを定義する\"\"\"\n\n    label: str = Field(..., description=\"クラスタのラベル名\")\n    description: str = Field(..., description=\"クラスタの説明文\")\n\n\ndef process_initial_labelling(\n    cluster_id: str,\n    df: pd.DataFrame,\n    prompt: str,\n    sampling_num: int,\n    target_column: str,\n    model: str,\n    provider: str = \"openai\",\n    local_llm_address: str | None = None,\n    config: dict | None = None,  # configを追加\n) -\u003e LabellingResult:\n    \"\"\"個別のクラスタに対してラベリングを実行する\n\n    Args:\n        cluster_id: 処理対象のクラスタID\n        df: クラスタリング結果のDataFrame\n        prompt: LLMへのプロンプト\n        sampling_num: サンプリングする意見の数\n        target_column: クラスタIDが格納されている列名\n        model: 使用するLLMモデル名\n        provider: LLMプロバイダー\n        local_llm_address: ローカルLLMのアドレス\n        config: 設定情報を含む辞書（トークン使用量の累積に使用）\n\n    Returns:\n        クラスタのラベリング結果\n    \"\"\"\n    cluster_data = df[df[target_column] == cluster_id]\n    sampling_num = min(sampling_num, len(cluster_data))\n    cluster = cluster_data.sample(sampling_num)\n    input = \"\\n\".join(cluster[\"argument\"].values)\n    messages = [\n        {\"role\": \"system\", \"content\": prompt},\n        {\"role\": \"user\", \"content\": input},\n    ]\n    try:\n        response_text, token_input, token_output, token_total = request_to_chat_ai(\n            messages=messages,\n            model=model,\n            provider=provider,\n            json_schema=LabellingFromat,\n            local_llm_address=local_llm_address,\n            user_api_key=os.getenv(\"USER_API_KEY\"),\n        )\n\n        # トークン使用量を累積（configが渡されている場合）\n        if config is not None:\n            config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0) + token_total\n            config[\"token_usage_input\"] = config.get(\"token_usage_input\", 0) + token_input\n            config[\"token_usage_output\"] = config.get(\"token_usage_output\", 0) + token_output\n\n        response_json = json.loads(response_text) if isinstance(response_text, str) else response_text\n        return LabellingResult(\n            cluster_id=cluster_id,\n            label=response_json.get(\"label\", \"エラーでラベル名が取得できませんでした\"),\n            description=response_json.get(\"description\", \"エラーで解説が取得できませんでした\"),\n        )\n    except Exception as e:\n        print(e)\n        return LabellingResult(\n            cluster_id=cluster_id,\n            label=\"エラーでラベル名が取得できませんでした\",\n            description=\"エラーで解説が取得できませんでした\",\n        )\n"])</script><script>self.__next_f.push([1,"20:T337b,"])</script><script>self.__next_f.push([1,"import json\nimport os\nfrom concurrent.futures import ThreadPoolExecutor\nfrom dataclasses import dataclass\nfrom functools import partial\n\nimport numpy as np\nimport pandas as pd\nfrom pydantic import BaseModel, Field\nfrom tqdm import tqdm\n\nfrom services.llm import request_to_chat_ai\n\n\n@dataclass\nclass ClusterColumns:\n    \"\"\"同一階層のクラスター関連のカラム名を管理するクラス\"\"\"\n\n    id: str\n    label: str\n    description: str\n\n    @classmethod\n    def from_id_column(cls, id_column: str) -\u003e \"ClusterColumns\":\n        \"\"\"ID列名から関連するカラム名を生成\"\"\"\n        return cls(\n            id=id_column,\n            label=id_column.replace(\"-id\", \"-label\"),\n            description=id_column.replace(\"-id\", \"-description\"),\n        )\n\n\n@dataclass\nclass ClusterValues:\n    \"\"\"対象クラスタのlabel/descriptionを管理するクラス\"\"\"\n\n    label: str\n    description: str\n\n    def to_prompt_text(self) -\u003e str:\n        return f\"- {self.label}: {self.description}\"\n\n\ndef hierarchical_merge_labelling(config: dict) -\u003e None:\n    \"\"\"階層的クラスタリングの結果に対してマージラベリングを実行する\n\n    Args:\n        config: 設定情報を含む辞書\n            - output_dir: 出力ディレクトリ名\n            - hierarchical_merge_labelling: マージラベリングの設定\n                - sampling_num: サンプリング数\n                - prompt: LLMへのプロンプト\n                - model: 使用するLLMモデル名\n                - workers: 並列処理のワーカー数\n            - provider: LLMプロバイダー\n    \"\"\"\n    dataset = config[\"output_dir\"]\n    merge_path = f\"outputs/{dataset}/hierarchical_merge_labels.csv\"\n    clusters_df = pd.read_csv(f\"outputs/{dataset}/hierarchical_initial_labels.csv\")\n\n    cluster_id_columns: list[str] = _filter_id_columns(clusters_df.columns)\n    # ボトムクラスタのラベル・説明とクラスタid付きの各argumentを入力し、各階層のクラスタラベル・説明を生成し、argumentに付けたdfを作成\n    merge_result_df = merge_labelling(\n        clusters_df=clusters_df,\n        cluster_id_columns=sorted(cluster_id_columns, reverse=True),\n        config=config,\n    )\n    # 上記のdfから各クラスタのlevel, id, label, description, valueを取得してdfを作成\n    melted_df = melt_cluster_data(merge_result_df)\n    # 上記のdfに親子関係を追加\n    parent_child_df = _build_parent_child_mapping(merge_result_df, cluster_id_columns)\n    melted_df = melted_df.merge(parent_child_df, on=[\"level\", \"id\"], how=\"left\")\n    density_df = calculate_cluster_density(melted_df, config)\n    density_df.to_csv(merge_path, index=False)\n\n\ndef _build_parent_child_mapping(df: pd.DataFrame, cluster_id_columns: list[str]):\n    \"\"\"クラスタ間の親子関係をマッピングする\n\n    Args:\n        df: クラスタリング結果のDataFrame\n        cluster_id_columns: クラスタIDのカラム名のリスト\n\n    Returns:\n        親子関係のマッピング情報を含むDataFrame\n    \"\"\"\n    results = []\n    top_cluster_column = cluster_id_columns[0]\n    top_cluster_values = df[top_cluster_column].unique()\n    for c in top_cluster_values:\n        results.append(\n            {\n                \"level\": 1,\n                \"id\": c,\n                \"parent\": \"0\",  # aggregationで追加する全体クラスタのid\n            }\n        )\n\n    for idx in range(len(cluster_id_columns) - 1):\n        current_column = cluster_id_columns[idx]\n        children_column = cluster_id_columns[idx + 1]\n        current_level = current_column.replace(\"-id\", \"\").replace(\"cluster-level-\", \"\")\n        # 現在のレベルのクラスタid\n        current_cluster_values = df[current_column].unique()\n        for current_id in current_cluster_values:\n            children_ids = df.loc[df[current_column] == current_id, children_column].unique()\n            for child_id in children_ids:\n                results.append(\n                    {\n                        \"level\": int(current_level) + 1,\n                        \"id\": child_id,\n                        \"parent\": current_id,\n                    }\n                )\n    return pd.DataFrame(results)\n\n\ndef _filter_id_columns(columns: list[str]) -\u003e list[str]:\n    \"\"\"クラスタIDのカラム名をフィルタリングする\n\n    Args:\n        columns: 全カラム名のリスト\n\n    Returns:\n        クラスタIDのカラム名のリスト\n    \"\"\"\n    return [col for col in columns if col.startswith(\"cluster-level-\") and col.endswith(\"-id\")]\n\n\ndef melt_cluster_data(df: pd.DataFrame) -\u003e pd.DataFrame:\n    \"\"\"クラスタデータを行形式に変換する\n\n    cluster-level-n-(id|label|description) を行形式 (level, id, label, description, value) にまとめる。\n    [cluster-level-n-id, cluster-level-n-label, cluster-level-n-description] を [level, id, label, description, value(件数)] に変換する。\n\n    Args:\n        df: クラスタリング結果のDataFrame\n\n    Returns:\n        行形式に変換されたDataFrame\n    \"\"\"\n    id_columns: list[str] = _filter_id_columns(df.columns)\n    levels: set[int] = {int(col.replace(\"cluster-level-\", \"\").replace(\"-id\", \"\")) for col in id_columns}\n    all_rows: list[dict] = []\n\n    # levelごとに各クラスタの出現件数を集計・縦持ちにする\n    for level in levels:\n        cluster_columns = ClusterColumns.from_id_column(f\"cluster-level-{level}-id\")\n        # クラスタidごとの件数集計\n        level_count_df = df.groupby(cluster_columns.id).size().reset_index(name=\"value\")\n\n        level_unique_val_df = df[\n            [cluster_columns.id, cluster_columns.label, cluster_columns.description]\n        ].drop_duplicates()\n        level_unique_val_df = level_unique_val_df.merge(level_count_df, on=cluster_columns.id, how=\"left\")\n        level_unique_vals = [\n            {\n                \"level\": level,\n                \"id\": row[cluster_columns.id],\n                \"label\": row[cluster_columns.label],\n                \"description\": row[cluster_columns.description],\n                \"value\": row[\"value\"],\n            }\n            for _, row in level_unique_val_df.iterrows()\n        ]\n        all_rows.extend(level_unique_vals)\n    return pd.DataFrame(all_rows)\n\n\ndef merge_labelling(clusters_df: pd.DataFrame, cluster_id_columns: list[str], config) -\u003e pd.DataFrame:\n    \"\"\"階層的なクラスタのマージラベリングを実行する\n\n    Args:\n        clusters_df: クラスタリング結果のDataFrame\n        cluster_id_columns: クラスタIDのカラム名のリスト\n        config: 設定情報を含む辞書\n\n    Returns:\n        マージラベリング結果を含むDataFrame\n    \"\"\"\n    for idx in tqdm(range(len(cluster_id_columns) - 1)):\n        previous_columns = ClusterColumns.from_id_column(cluster_id_columns[idx])\n        current_columns = ClusterColumns.from_id_column(cluster_id_columns[idx + 1])\n\n        process_fn = partial(\n            process_merge_labelling,\n            result_df=clusters_df,\n            current_columns=current_columns,\n            previous_columns=previous_columns,\n            config=config,\n        )\n\n        current_cluster_ids = sorted(clusters_df[current_columns.id].unique())\n        with ThreadPoolExecutor(max_workers=config[\"hierarchical_merge_labelling\"][\"workers\"]) as executor:\n            responses = list(\n                tqdm(\n                    executor.map(process_fn, current_cluster_ids),\n                    total=len(current_cluster_ids),\n                )\n            )\n\n        current_result_df = pd.DataFrame(responses)\n        clusters_df = clusters_df.merge(current_result_df, on=[current_columns.id])\n    return clusters_df\n\n\nclass LabellingFromat(BaseModel):\n    \"\"\"ラベリング結果のフォーマットを定義する\"\"\"\n\n    label: str = Field(..., description=\"クラスタのラベル名\")\n    description: str = Field(..., description=\"クラスタの説明文\")\n\n\ndef process_merge_labelling(\n    target_cluster_id: str,\n    result_df: pd.DataFrame,\n    current_columns: ClusterColumns,\n    previous_columns: ClusterColumns,\n    config,\n):\n    \"\"\"個別のクラスタに対してマージラベリングを実行する\n\n    Args:\n        target_cluster_id: 処理対象のクラスタID\n        result_df: クラスタリング結果のDataFrame\n        current_columns: 現在のレベルのカラム情報\n        previous_columns: 前のレベルのカラム情報\n        config: 設定情報を含む辞書\n\n    Returns:\n        マージラベリング結果を含む辞書\n    \"\"\"\n\n    def filter_previous_values(df: pd.DataFrame, previous_columns: ClusterColumns) -\u003e list[ClusterValues]:\n        \"\"\"前のレベルのクラスタ情報を取得する\"\"\"\n        previous_records = df[df[current_columns.id] == target_cluster_id][\n            [previous_columns.label, previous_columns.description]\n        ].drop_duplicates()\n        previous_values = [\n            ClusterValues(\n                label=row[previous_columns.label],\n                description=row[previous_columns.description],\n            )\n            for _, row in previous_records.iterrows()\n        ]\n        return previous_values\n\n    previous_values = filter_previous_values(result_df, previous_columns)\n    if len(previous_values) == 1:\n        return {\n            current_columns.id: target_cluster_id,\n            current_columns.label: previous_values[0].label,\n            current_columns.description: previous_values[0].description,\n        }\n    elif len(previous_values) == 0:\n        raise ValueError(f\"クラスタ {target_cluster_id} には前のレベルのクラスタが存在しません。\")\n\n    current_cluster_data = result_df[result_df[current_columns.id] == target_cluster_id]\n    sampling_num = min(\n        config[\"hierarchical_merge_labelling\"][\"sampling_num\"],\n        len(current_cluster_data),\n    )\n    sampled_data = current_cluster_data.sample(sampling_num)\n    sampled_argument_text = \"\\n\".join(sampled_data[\"argument\"].values)\n    cluster_text = \"\\n\".join([value.to_prompt_text() for value in previous_values])\n    messages = [\n        {\"role\": \"system\", \"content\": config[\"hierarchical_merge_labelling\"][\"prompt\"]},\n        {\n            \"role\": \"user\",\n            \"content\": \"クラスタラベル\\n\" + cluster_text + \"\\n\" + \"クラスタの意見\\n\" + sampled_argument_text,\n        },\n    ]\n    try:\n        response_text, token_input, token_output, token_total = request_to_chat_ai(\n            messages=messages,\n            model=config[\"hierarchical_merge_labelling\"][\"model\"],\n            json_schema=LabellingFromat,\n            provider=config[\"provider\"],\n            local_llm_address=config.get(\"local_llm_address\"),\n            user_api_key=os.getenv(\"USER_API_KEY\"),\n        )\n\n        config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0) + token_total\n        config[\"token_usage_input\"] = config.get(\"token_usage_input\", 0) + token_input\n        config[\"token_usage_output\"] = config.get(\"token_usage_output\", 0) + token_output\n        print(f\"Merge labelling: input={token_input}, output={token_output}, total={token_total} tokens\")\n\n        response_json = json.loads(response_text) if isinstance(response_text, str) else response_text\n        return {\n            current_columns.id: target_cluster_id,\n            current_columns.label: response_json.get(\"label\", \"エラーでラベル名が取得できませんでした\"),\n            current_columns.description: response_json.get(\"description\", \"エラーで解説が取得できませんでした\"),\n        }\n    except Exception as e:\n        print(f\"エラーが発生しました: {e}\")\n        return {\n            current_columns.id: target_cluster_id,\n            current_columns.label: \"エラーでラベル名が取得できませんでした\",\n            current_columns.description: \"エラーで解説が取得できませんでした\",\n        }\n\n\ndef calculate_cluster_density(melted_df: pd.DataFrame, config: dict):\n    \"\"\"クラスタ内の密度計算\"\"\"\n    hierarchical_cluster_df = pd.read_csv(f\"outputs/{config['output_dir']}/hierarchical_clusters.csv\")\n\n    densities = []\n    for level, c_id in zip(melted_df[\"level\"], melted_df[\"id\"], strict=False):\n        cluster_embeds = hierarchical_cluster_df[hierarchical_cluster_df[f\"cluster-level-{level}-id\"] == c_id][\n            [\"x\", \"y\"]\n        ].values\n        density = calculate_density(cluster_embeds)\n        densities.append(density)\n\n    # 密度のランクを計算\n    melted_df[\"density\"] = densities\n    melted_df[\"density_rank\"] = melted_df.groupby(\"level\")[\"density\"].rank(ascending=False, method=\"first\")\n    melted_df[\"density_rank_percentile\"] = melted_df.groupby(\"level\")[\"density_rank\"].transform(lambda x: x / len(x))\n    return melted_df\n\n\ndef calculate_density(embeds: np.ndarray):\n    \"\"\"平均距離に基づいて密度を計算\"\"\"\n    center = np.mean(embeds, axis=0)\n    distances = np.linalg.norm(embeds - center, axis=1)\n    avg_distance = np.mean(distances)\n    density = 1 / (avg_distance + 1e-10)\n    return density\n"])</script><script>self.__next_f.push([1,"21:Ta82,"])</script><script>self.__next_f.push([1,"\"\"\"Create summaries for the clusters.\"\"\"\n\nimport json\nimport os\nimport re\n\nimport pandas as pd\nfrom pydantic import BaseModel, Field\n\nfrom services.llm import request_to_chat_ai\n\n\nclass OverviewResponse(BaseModel):\n    summary: str = Field(..., description=\"クラスターの全体的な要約\")\n\n\ndef hierarchical_overview(config):\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/hierarchical_overview.txt\"\n\n    hierarchical_label_df = pd.read_csv(f\"outputs/{dataset}/hierarchical_merge_labels.csv\")\n\n    prompt = config[\"hierarchical_overview\"][\"prompt\"]\n    model = config[\"hierarchical_overview\"][\"model\"]\n\n    # TODO: level1で固定にしているが、設定で変えられるようにする\n    target_level = 1\n    target_records = hierarchical_label_df[hierarchical_label_df[\"level\"] == target_level]\n    ids = target_records[\"id\"].to_list()\n    labels = target_records[\"label\"].to_list()\n    descriptions = target_records[\"description\"].to_list()\n    target_records.set_index(\"id\", inplace=True)\n\n    input_text = \"\"\n    for i, _ in enumerate(ids):\n        input_text += f\"# Cluster {i}/{len(ids)}: {labels[i]}\\n\\n\"\n        input_text += descriptions[i] + \"\\n\\n\"\n\n    messages = [{\"role\": \"system\", \"content\": prompt}, {\"role\": \"user\", \"content\": input_text}]\n    response_text, token_input, token_output, token_total = request_to_chat_ai(\n        messages=messages,\n        model=model,\n        provider=config[\"provider\"],\n        local_llm_address=config.get(\"local_llm_address\"),\n        user_api_key=os.getenv(\"USER_API_KEY\"),\n        json_schema=OverviewResponse,\n    )\n\n    # トークン使用量を累積\n    config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0) + token_total\n    config[\"token_usage_input\"] = config.get(\"token_usage_input\", 0) + token_input\n    config[\"token_usage_output\"] = config.get(\"token_usage_output\", 0) + token_output\n    print(f\"Hierarchical overview: input={token_input}, output={token_output}, total={token_total} tokens\")\n\n    try:\n        # structured outputとしてパースできるなら処理する\n        if isinstance(response_text, dict):\n            parsed_response = response_text\n        else:\n            parsed_response = json.loads(response_text)\n\n        with open(path, \"w\") as file:\n            file.write(parsed_response[\"summary\"])\n\n    except Exception:\n        # thinkタグが出力されるReasoningモデル用に、thinkタグを除去する\n        thinking_removed = re.sub(\n            r\"\u003cthink\\b[^\u003e]*\u003e.*?\u003c/think\u003e\",\n            \"\",\n            response_text,\n            flags=re.DOTALL,\n        )\n\n        with open(path, \"w\") as file:\n            file.write(thinking_removed)\n"])</script><script>self.__next_f.push([1,"22:T3f38,"])</script><script>self.__next_f.push([1,"\"\"\"Generate a convenient JSON output file.\"\"\"\n\nimport json\nfrom collections import defaultdict\nfrom pathlib import Path\nfrom typing import Any, TypedDict\n\nimport numpy as np\nimport pandas as pd\n\nROOT_DIR = Path(__file__).parent.parent.parent.parent\nCONFIG_DIR = ROOT_DIR / \"scatter\" / \"pipeline\" / \"configs\"\nPIPELINE_DIR = ROOT_DIR / \"broadlistening\" / \"pipeline\"\n\n\ndef json_serialize_numpy(obj: Any) -\u003e Any:\n    \"\"\"\n    Recursively convert NumPy data types to native Python types for JSON serialization.\n\n    Args:\n        obj: Any Python object which might contain NumPy data types\n\n    Returns:\n        The same object structure with NumPy types converted to Python native types\n    \"\"\"\n    if isinstance(obj, np.integer):\n        return int(obj)\n    elif isinstance(obj, np.floating):\n        return float(obj)\n    elif isinstance(obj, np.ndarray):\n        return obj.tolist()\n    elif isinstance(obj, dict):\n        return {k: json_serialize_numpy(v) for k, v in obj.items()}\n    elif isinstance(obj, list):\n        return [json_serialize_numpy(item) for item in obj]\n    elif isinstance(obj, tuple):\n        return tuple(json_serialize_numpy(item) for item in obj)\n    else:\n        return obj\n\n\nclass Argument(TypedDict):\n    arg_id: str\n    argument: str\n    comment_id: str\n    x: float\n    y: float\n    p: float\n    cluster_ids: list[str]\n    attributes: dict[str, str] | None\n    url: str | None\n\n\nclass Cluster(TypedDict):\n    level: int\n    id: str\n    label: str\n    takeaway: str\n    value: int\n    parent: str\n    density_rank_percentile: float | None\n\n\ndef hierarchical_aggregation(config) -\u003e bool:\n    try:\n        path = f\"outputs/{config['output_dir']}/hierarchical_result.json\"\n        results = {\n            \"arguments\": [],\n            \"clusters\": [],\n            \"comments\": {},\n            \"propertyMap\": {},\n            \"translations\": {},\n            \"overview\": \"\",\n            \"config\": config,\n        }\n\n        arguments = pd.read_csv(f\"outputs/{config['output_dir']}/args.csv\")\n        arguments.set_index(\"arg-id\", inplace=True)\n        arg_num = len(arguments)\n        relation_df = pd.read_csv(f\"outputs/{config['output_dir']}/relations.csv\")\n        comments = pd.read_csv(f\"inputs/{config['input']}.csv\")\n        clusters = pd.read_csv(f\"outputs/{config['output_dir']}/hierarchical_clusters.csv\")\n        labels = pd.read_csv(f\"outputs/{config['output_dir']}/hierarchical_merge_labels.csv\")\n\n        hidden_properties_map: dict[str, list[str]] = config[\"hierarchical_aggregation\"][\"hidden_properties\"]\n\n        results[\"arguments\"] = _build_arguments(clusters, comments, relation_df, config)\n        results[\"clusters\"] = _build_cluster_value(labels, arg_num)\n\n        # results[\"comments\"] = _build_comments_value(\n        #     comments, arguments, hidden_properties_map\n        # )\n        results[\"comment_num\"] = len(comments)\n        results[\"translations\"] = _build_translations(config)\n        # 属性情報のカラムは、元データに対して指定したカラムとclassificationするカテゴリを合わせたもの\n        results[\"propertyMap\"] = _build_property_map(arguments, comments, hidden_properties_map, config)\n\n        with open(f\"outputs/{config['output_dir']}/hierarchical_overview.txt\") as f:\n            overview = f.read()\n        print(\"overview\")\n        print(overview)\n        results[\"overview\"] = overview\n\n        # Convert non-serializable NumPy types to native Python types\n        results = json_serialize_numpy(results)\n\n        with open(path, \"w\") as file:\n            json.dump(results, file, indent=2, ensure_ascii=False)\n        # TODO: サンプリングロジックを実装したいが、現状は全件抽出\n        create_custom_intro(config)\n        if config[\"is_pubcom\"]:\n            add_original_comments(labels, arguments, relation_df, clusters, config)\n        return True\n    except Exception as e:\n        print(\"error\")\n        print(e)\n        return False\n\n\ndef create_custom_intro(config):\n    dataset = config[\"output_dir\"]\n    args_path = PIPELINE_DIR / f\"outputs/{dataset}/args.csv\"\n    comments = pd.read_csv(PIPELINE_DIR / f\"inputs/{config['input']}.csv\")\n    result_path = PIPELINE_DIR / f\"outputs/{dataset}/hierarchical_result.json\"\n\n    input_count = len(comments)\n    args_count = len(pd.read_csv(args_path))\n    processed_num = min(input_count, config[\"extraction\"][\"limit\"])\n\n    print(f\"Input count: {input_count}\")\n    print(f\"Args count: {args_count}\")\n\n    # LLMプロバイダーとモデル名の判定\n    def get_llm_provider_display():\n        # configからプロバイダー情報を取得（優先）\n        provider = config.get(\"provider\", \"openai\")\n        model = config.get(\"model\", \"unknown\")\n\n        # プロバイダー名をマッピング\n        provider_names = {\n            \"openai\": \"OpenAI API\",\n            \"azure\": \"Azure OpenAI API\",\n            \"openrouter\": \"OpenRouter API\",\n            \"local\": \"Local LLM\",\n        }\n\n        provider_name = provider_names.get(provider, f\"{provider} API\")\n        return f\"{provider_name} ({model})\"\n\n    llm_provider = get_llm_provider_display()\n\n    base_custom_intro = \"\"\"{intro}\n分析対象となったデータの件数は{processed_num}件で、これらのデータに対して{llm_provider}を用いて{args_count}件の意見（議論）を抽出し、クラスタリングを行った。\n\"\"\"\n\n    intro = config[\"intro\"]\n    custom_intro = base_custom_intro.format(\n        intro=intro, processed_num=processed_num, args_count=args_count, llm_provider=llm_provider\n    )\n\n    with open(result_path) as f:\n        result = json.load(f)\n    result[\"config\"][\"intro\"] = custom_intro\n    with open(result_path, \"w\") as f:\n        json.dump(result, f, indent=2, ensure_ascii=False)\n\n\ndef add_original_comments(labels, arguments, relation_df, clusters, config):\n    # 大カテゴリ（cluster-level-1）に該当するラベルだけ抽出\n    labels_lv1 = labels[labels[\"level\"] == 1][[\"id\", \"label\"]].rename(\n        columns={\"id\": \"cluster-level-1-id\", \"label\": \"category_label\"}\n    )\n\n    # arguments と clusters をマージ（カテゴリ情報付与）\n    merged = arguments.merge(clusters[[\"arg-id\", \"cluster-level-1-id\"]], on=\"arg-id\").merge(\n        labels_lv1, on=\"cluster-level-1-id\", how=\"left\"\n    )\n\n    # relation_df と結合\n    merged = merged.merge(relation_df, on=\"arg-id\", how=\"left\")\n\n    # 元コメント取得\n    comments = pd.read_csv(PIPELINE_DIR / f\"inputs/{config['input']}.csv\")\n    comments[\"comment-id\"] = comments[\"comment-id\"].astype(str)\n    merged[\"comment-id\"] = merged[\"comment-id\"].astype(str)\n\n    # 元コメント本文などとマージ\n    final_df = merged.merge(comments, on=\"comment-id\", how=\"left\")\n\n    # 必要カラムのみ整形\n    final_cols = [\"comment-id\", \"comment-body\", \"arg-id\", \"argument\", \"cluster-level-1-id\", \"category_label\"]\n\n    # 基本カラム\n    for col in [\"x\", \"y\", \"source\", \"url\"]:\n        if col in comments.columns:\n            final_cols.append(col)\n\n    # 属性カラムを追加\n    attribute_columns = []\n    for col in comments.columns:\n        # attributeプレフィックスが付いたカラムを探す\n        if col.startswith(\"attribute_\"):\n            attribute_columns.append(col)\n            final_cols.append(col)\n\n    print(f\"属性カラム検出: {attribute_columns}\")\n\n    # 必要なカラムだけ選択\n    final_df = final_df[final_cols]\n    final_df = final_df.rename(\n        columns={\n            \"cluster-level-1-id\": \"category_id\",\n            \"category_label\": \"category\",\n            \"arg-id\": \"arg_id\",\n            \"argument\": \"argument\",\n            \"comment-body\": \"original-comment\",\n        }\n    )\n\n    # 保存\n    final_df.to_csv(PIPELINE_DIR / f\"outputs/{config['output_dir']}/final_result_with_comments.csv\", index=False)\n\n\ndef _build_arguments(\n    clusters: pd.DataFrame, comments: pd.DataFrame, relation_df: pd.DataFrame, config: dict\n) -\u003e list[Argument]:\n    \"\"\"\n    Build the arguments list including attribute information from original comments\n\n    Args:\n        clusters: DataFrame containing cluster information for each argument\n        comments: DataFrame containing original comments with attribute columns\n        relation_df: DataFrame relating arguments to original comments\n        config: Configuration dictionary containing enable_source_link setting\n    \"\"\"\n    cluster_columns = [col for col in clusters.columns if col.startswith(\"cluster-level-\") and \"id\" in col]\n\n    # Prepare for merging with original comments to get attributes\n    comments_copy = comments.copy()\n    comments_copy[\"comment-id\"] = comments_copy[\"comment-id\"].astype(str)\n\n    # Get argument to comment mapping\n    arg_comment_map = {}\n    if \"comment-id\" in relation_df.columns:\n        relation_df[\"comment-id\"] = relation_df[\"comment-id\"].astype(str)\n        arg_comment_map = dict(zip(relation_df[\"arg-id\"], relation_df[\"comment-id\"], strict=False))\n\n    # Find attribute columns in comments dataframe\n    attribute_columns = [col for col in comments.columns if col.startswith(\"attribute_\")]\n    print(f\"属性カラム検出: {attribute_columns}\")\n\n    arguments: list[Argument] = []\n    for _, row in clusters.iterrows():\n        cluster_ids = [\"0\"]\n        for cluster_column in cluster_columns:\n            cluster_ids.append(str(row[cluster_column]))  # Convert to string to ensure serializable\n\n        # Create base argument\n        argument: Argument = {\n            \"arg_id\": str(row[\"arg-id\"]),  # Convert to string to ensure serializable\n            \"argument\": str(row[\"argument\"]),\n            \"x\": float(row[\"x\"]),  # Convert to native float\n            \"y\": float(row[\"y\"]),  # Convert to native float\n            \"p\": 0,  # NOTE: 一旦全部0でいれる\n            \"cluster_ids\": cluster_ids,\n            \"attributes\": None,\n            \"url\": None,\n        }\n\n        # Add attributes and URL if available\n        if row[\"arg-id\"] in arg_comment_map:\n            comment_id = arg_comment_map[row[\"arg-id\"]]\n            comment_rows = comments_copy[comments_copy[\"comment-id\"] == comment_id]\n\n            if not comment_rows.empty:\n                comment_row = comment_rows.iloc[0]\n\n                # Add URL if available and enabled\n                if config.get(\"enable_source_link\", False) and \"url\" in comment_row and comment_row[\"url\"] is not None:\n                    argument[\"url\"] = str(comment_row[\"url\"])\n\n                # Add attributes if available\n                if attribute_columns:\n                    attributes = {}\n                    for attr_col in attribute_columns:\n                        # Remove \"attribute_\" prefix for cleaner attribute names\n                        attr_name = attr_col[len(\"attribute_\") :]\n                        # Convert potential numpy types to Python native types\n                        attr_value = comment_row.get(attr_col, None)\n                        if attr_value is not None:\n                            if isinstance(attr_value, np.integer):\n                                attr_value = int(attr_value)\n                            elif isinstance(attr_value, np.floating):\n                                attr_value = float(attr_value)\n                            elif isinstance(attr_value, np.ndarray):\n                                attr_value = attr_value.tolist()\n                        attributes[attr_name] = attr_value\n\n                    # Only add non-empty attributes\n                    if any(v is not None for v in attributes.values()):\n                        argument[\"attributes\"] = attributes\n\n        arguments.append(argument)\n    return arguments\n\n\ndef _build_cluster_value(melted_labels: pd.DataFrame, total_num: int) -\u003e list[Cluster]:\n    results: list[Cluster] = [\n        Cluster(\n            level=0,\n            id=\"0\",\n            label=\"全体\",\n            takeaway=\"\",\n            value=int(total_num),  # Convert to native int\n            parent=\"\",\n            density_rank_percentile=0,\n        )\n    ]\n\n    for _, melted_label in melted_labels.iterrows():\n        # Convert potential NumPy types to native Python types\n        level = (\n            int(melted_label[\"level\"]) if isinstance(melted_label[\"level\"], int | np.integer) else melted_label[\"level\"]\n        )\n        cluster_id = str(melted_label[\"id\"])\n        label = str(melted_label[\"label\"])\n        takeaway = str(melted_label[\"description\"])\n        value = (\n            int(melted_label[\"value\"]) if isinstance(melted_label[\"value\"], int | np.integer) else melted_label[\"value\"]\n        )\n        parent = str(melted_label.get(\"parent\", \"全体\"))\n\n        # Handle density_rank_percentile which might be None or a numeric value\n        density_rank = melted_label.get(\"density_rank_percentile\")\n        if density_rank is not None:\n            if isinstance(density_rank, float | np.floating):\n                density_rank = float(density_rank)\n            elif isinstance(density_rank, int | np.integer):\n                density_rank = int(density_rank)\n\n        cluster_value = Cluster(\n            level=level,\n            id=cluster_id,\n            label=label,\n            takeaway=takeaway,\n            value=value,\n            parent=parent,\n            density_rank_percentile=density_rank,\n        )\n        results.append(cluster_value)\n    return results\n\n\ndef _build_comments_value(\n    comments: pd.DataFrame,\n    arguments: pd.DataFrame,\n    hidden_properties_map: dict[str, list[str]],\n):\n    comment_dict: dict[str, dict[str, str]] = {}\n    useful_comment_ids = set(arguments[\"comment-id\"].values)\n    for _, row in comments.iterrows():\n        id = row[\"comment-id\"]\n        if id in useful_comment_ids:\n            res = {\"comment\": row[\"comment-body\"]}\n            should_skip = any(row[prop] in hidden_values for prop, hidden_values in hidden_properties_map.items())\n            if should_skip:\n                continue\n            comment_dict[str(id)] = res\n\n    return comment_dict\n\n\ndef _build_translations(config):\n    languages = list(config.get(\"translation\", {}).get(\"languages\", []))\n    if len(languages) \u003e 0:\n        with open(PIPELINE_DIR / f\"outputs/{config['output_dir']}/translations.json\") as f:\n            translations = f.read()\n        return json.loads(translations)\n    return {}\n\n\ndef _build_property_map(\n    arguments: pd.DataFrame, comments: pd.DataFrame, hidden_properties_map: dict[str, list[str]], config: dict\n) -\u003e dict[str, dict[str, str]]:\n    property_columns = list(hidden_properties_map.keys()) + list(config[\"extraction\"][\"categories\"].keys())\n    property_map = defaultdict(dict)\n\n    # 指定された property_columns が arguments に存在するかチェック\n    missing_cols = [col for col in property_columns if col not in arguments.columns]\n    if missing_cols:\n        raise ValueError(\n            f\"指定されたカラム {missing_cols} が args.csv に存在しません。\"\n            \"設定ファイルaggregation / hidden_propertiesから該当カラムを取り除いてください。\"\n        )\n\n    for prop in property_columns:\n        for arg_id, row in arguments.iterrows():\n            # LLMによるcategory classificationがうまく行かず、NaNの場合はNoneにする\n            value = row[prop] if not pd.isna(row[prop]) else None\n\n            # Convert NumPy types to Python native types\n            if value is not None:\n                if isinstance(value, np.integer):\n                    value = int(value)\n                elif isinstance(value, np.floating):\n                    value = float(value)\n                elif isinstance(value, np.ndarray):\n                    value = value.tolist()\n                else:\n                    # Convert any other types to string to ensure serialization\n                    try:\n                        value = str(value)\n                    except Exception as e:\n                        print(f\"Error converting value to string: {e}\")\n                        value = None\n\n            # Make sure arg_id is string\n            str_arg_id = str(arg_id)\n            property_map[prop][str_arg_id] = value\n\n    return property_map\n"])</script><script>self.__next_f.push([1,"23:T458,import os\n\nimport pandas as pd\nfrom tqdm import tqdm\n\nfrom services.llm import request_to_embed\n\n\ndef embedding(config):\n    model = config[\"embedding\"][\"model\"]\n    is_embedded_at_local = config[\"is_embedded_at_local\"]\n    # print(\"start embedding\")\n    # print(f\"embedding model: {model}, is_embedded_at_local: {is_embedded_at_local}\")\n\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/embeddings.pkl\"\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\", usecols=[\"arg-id\", \"argument\"])\n    embeddings = []\n    batch_size = 1000\n    for i in tqdm(range(0, len(arguments), batch_size)):\n        args = arguments[\"argument\"].tolist()[i : i + batch_size]\n        embeds = request_to_embed(\n            args,\n            model,\n            is_embedded_at_local,\n            config[\"provider\"],\n            local_llm_address=config.get(\"local_llm_address\"),\n            user_api_key=os.getenv(\"USER_API_KEY\"),\n        )\n        embeddings.extend(embeds)\n    df = pd.DataFrame([{\"arg-id\": arguments.iloc[i][\"arg-id\"], \"embedding\": e} for i, e in enumerate(embeddings)])\n    df.to_pickle(path)\n24:T3f38,"])</script><script>self.__next_f.push([1,"\"\"\"Generate a convenient JSON output file.\"\"\"\n\nimport json\nfrom collections import defaultdict\nfrom pathlib import Path\nfrom typing import Any, TypedDict\n\nimport numpy as np\nimport pandas as pd\n\nROOT_DIR = Path(__file__).parent.parent.parent.parent\nCONFIG_DIR = ROOT_DIR / \"scatter\" / \"pipeline\" / \"configs\"\nPIPELINE_DIR = ROOT_DIR / \"broadlistening\" / \"pipeline\"\n\n\ndef json_serialize_numpy(obj: Any) -\u003e Any:\n    \"\"\"\n    Recursively convert NumPy data types to native Python types for JSON serialization.\n\n    Args:\n        obj: Any Python object which might contain NumPy data types\n\n    Returns:\n        The same object structure with NumPy types converted to Python native types\n    \"\"\"\n    if isinstance(obj, np.integer):\n        return int(obj)\n    elif isinstance(obj, np.floating):\n        return float(obj)\n    elif isinstance(obj, np.ndarray):\n        return obj.tolist()\n    elif isinstance(obj, dict):\n        return {k: json_serialize_numpy(v) for k, v in obj.items()}\n    elif isinstance(obj, list):\n        return [json_serialize_numpy(item) for item in obj]\n    elif isinstance(obj, tuple):\n        return tuple(json_serialize_numpy(item) for item in obj)\n    else:\n        return obj\n\n\nclass Argument(TypedDict):\n    arg_id: str\n    argument: str\n    comment_id: str\n    x: float\n    y: float\n    p: float\n    cluster_ids: list[str]\n    attributes: dict[str, str] | None\n    url: str | None\n\n\nclass Cluster(TypedDict):\n    level: int\n    id: str\n    label: str\n    takeaway: str\n    value: int\n    parent: str\n    density_rank_percentile: float | None\n\n\ndef hierarchical_aggregation(config) -\u003e bool:\n    try:\n        path = f\"outputs/{config['output_dir']}/hierarchical_result.json\"\n        results = {\n            \"arguments\": [],\n            \"clusters\": [],\n            \"comments\": {},\n            \"propertyMap\": {},\n            \"translations\": {},\n            \"overview\": \"\",\n            \"config\": config,\n        }\n\n        arguments = pd.read_csv(f\"outputs/{config['output_dir']}/args.csv\")\n        arguments.set_index(\"arg-id\", inplace=True)\n        arg_num = len(arguments)\n        relation_df = pd.read_csv(f\"outputs/{config['output_dir']}/relations.csv\")\n        comments = pd.read_csv(f\"inputs/{config['input']}.csv\")\n        clusters = pd.read_csv(f\"outputs/{config['output_dir']}/hierarchical_clusters.csv\")\n        labels = pd.read_csv(f\"outputs/{config['output_dir']}/hierarchical_merge_labels.csv\")\n\n        hidden_properties_map: dict[str, list[str]] = config[\"hierarchical_aggregation\"][\"hidden_properties\"]\n\n        results[\"arguments\"] = _build_arguments(clusters, comments, relation_df, config)\n        results[\"clusters\"] = _build_cluster_value(labels, arg_num)\n\n        # results[\"comments\"] = _build_comments_value(\n        #     comments, arguments, hidden_properties_map\n        # )\n        results[\"comment_num\"] = len(comments)\n        results[\"translations\"] = _build_translations(config)\n        # 属性情報のカラムは、元データに対して指定したカラムとclassificationするカテゴリを合わせたもの\n        results[\"propertyMap\"] = _build_property_map(arguments, comments, hidden_properties_map, config)\n\n        with open(f\"outputs/{config['output_dir']}/hierarchical_overview.txt\") as f:\n            overview = f.read()\n        print(\"overview\")\n        print(overview)\n        results[\"overview\"] = overview\n\n        # Convert non-serializable NumPy types to native Python types\n        results = json_serialize_numpy(results)\n\n        with open(path, \"w\") as file:\n            json.dump(results, file, indent=2, ensure_ascii=False)\n        # TODO: サンプリングロジックを実装したいが、現状は全件抽出\n        create_custom_intro(config)\n        if config[\"is_pubcom\"]:\n            add_original_comments(labels, arguments, relation_df, clusters, config)\n        return True\n    except Exception as e:\n        print(\"error\")\n        print(e)\n        return False\n\n\ndef create_custom_intro(config):\n    dataset = config[\"output_dir\"]\n    args_path = PIPELINE_DIR / f\"outputs/{dataset}/args.csv\"\n    comments = pd.read_csv(PIPELINE_DIR / f\"inputs/{config['input']}.csv\")\n    result_path = PIPELINE_DIR / f\"outputs/{dataset}/hierarchical_result.json\"\n\n    input_count = len(comments)\n    args_count = len(pd.read_csv(args_path))\n    processed_num = min(input_count, config[\"extraction\"][\"limit\"])\n\n    print(f\"Input count: {input_count}\")\n    print(f\"Args count: {args_count}\")\n\n    # LLMプロバイダーとモデル名の判定\n    def get_llm_provider_display():\n        # configからプロバイダー情報を取得（優先）\n        provider = config.get(\"provider\", \"openai\")\n        model = config.get(\"model\", \"unknown\")\n\n        # プロバイダー名をマッピング\n        provider_names = {\n            \"openai\": \"OpenAI API\",\n            \"azure\": \"Azure OpenAI API\",\n            \"openrouter\": \"OpenRouter API\",\n            \"local\": \"Local LLM\",\n        }\n\n        provider_name = provider_names.get(provider, f\"{provider} API\")\n        return f\"{provider_name} ({model})\"\n\n    llm_provider = get_llm_provider_display()\n\n    base_custom_intro = \"\"\"{intro}\n分析対象となったデータの件数は{processed_num}件で、これらのデータに対して{llm_provider}を用いて{args_count}件の意見（議論）を抽出し、クラスタリングを行った。\n\"\"\"\n\n    intro = config[\"intro\"]\n    custom_intro = base_custom_intro.format(\n        intro=intro, processed_num=processed_num, args_count=args_count, llm_provider=llm_provider\n    )\n\n    with open(result_path) as f:\n        result = json.load(f)\n    result[\"config\"][\"intro\"] = custom_intro\n    with open(result_path, \"w\") as f:\n        json.dump(result, f, indent=2, ensure_ascii=False)\n\n\ndef add_original_comments(labels, arguments, relation_df, clusters, config):\n    # 大カテゴリ（cluster-level-1）に該当するラベルだけ抽出\n    labels_lv1 = labels[labels[\"level\"] == 1][[\"id\", \"label\"]].rename(\n        columns={\"id\": \"cluster-level-1-id\", \"label\": \"category_label\"}\n    )\n\n    # arguments と clusters をマージ（カテゴリ情報付与）\n    merged = arguments.merge(clusters[[\"arg-id\", \"cluster-level-1-id\"]], on=\"arg-id\").merge(\n        labels_lv1, on=\"cluster-level-1-id\", how=\"left\"\n    )\n\n    # relation_df と結合\n    merged = merged.merge(relation_df, on=\"arg-id\", how=\"left\")\n\n    # 元コメント取得\n    comments = pd.read_csv(PIPELINE_DIR / f\"inputs/{config['input']}.csv\")\n    comments[\"comment-id\"] = comments[\"comment-id\"].astype(str)\n    merged[\"comment-id\"] = merged[\"comment-id\"].astype(str)\n\n    # 元コメント本文などとマージ\n    final_df = merged.merge(comments, on=\"comment-id\", how=\"left\")\n\n    # 必要カラムのみ整形\n    final_cols = [\"comment-id\", \"comment-body\", \"arg-id\", \"argument\", \"cluster-level-1-id\", \"category_label\"]\n\n    # 基本カラム\n    for col in [\"x\", \"y\", \"source\", \"url\"]:\n        if col in comments.columns:\n            final_cols.append(col)\n\n    # 属性カラムを追加\n    attribute_columns = []\n    for col in comments.columns:\n        # attributeプレフィックスが付いたカラムを探す\n        if col.startswith(\"attribute_\"):\n            attribute_columns.append(col)\n            final_cols.append(col)\n\n    print(f\"属性カラム検出: {attribute_columns}\")\n\n    # 必要なカラムだけ選択\n    final_df = final_df[final_cols]\n    final_df = final_df.rename(\n        columns={\n            \"cluster-level-1-id\": \"category_id\",\n            \"category_label\": \"category\",\n            \"arg-id\": \"arg_id\",\n            \"argument\": \"argument\",\n            \"comment-body\": \"original-comment\",\n        }\n    )\n\n    # 保存\n    final_df.to_csv(PIPELINE_DIR / f\"outputs/{config['output_dir']}/final_result_with_comments.csv\", index=False)\n\n\ndef _build_arguments(\n    clusters: pd.DataFrame, comments: pd.DataFrame, relation_df: pd.DataFrame, config: dict\n) -\u003e list[Argument]:\n    \"\"\"\n    Build the arguments list including attribute information from original comments\n\n    Args:\n        clusters: DataFrame containing cluster information for each argument\n        comments: DataFrame containing original comments with attribute columns\n        relation_df: DataFrame relating arguments to original comments\n        config: Configuration dictionary containing enable_source_link setting\n    \"\"\"\n    cluster_columns = [col for col in clusters.columns if col.startswith(\"cluster-level-\") and \"id\" in col]\n\n    # Prepare for merging with original comments to get attributes\n    comments_copy = comments.copy()\n    comments_copy[\"comment-id\"] = comments_copy[\"comment-id\"].astype(str)\n\n    # Get argument to comment mapping\n    arg_comment_map = {}\n    if \"comment-id\" in relation_df.columns:\n        relation_df[\"comment-id\"] = relation_df[\"comment-id\"].astype(str)\n        arg_comment_map = dict(zip(relation_df[\"arg-id\"], relation_df[\"comment-id\"], strict=False))\n\n    # Find attribute columns in comments dataframe\n    attribute_columns = [col for col in comments.columns if col.startswith(\"attribute_\")]\n    print(f\"属性カラム検出: {attribute_columns}\")\n\n    arguments: list[Argument] = []\n    for _, row in clusters.iterrows():\n        cluster_ids = [\"0\"]\n        for cluster_column in cluster_columns:\n            cluster_ids.append(str(row[cluster_column]))  # Convert to string to ensure serializable\n\n        # Create base argument\n        argument: Argument = {\n            \"arg_id\": str(row[\"arg-id\"]),  # Convert to string to ensure serializable\n            \"argument\": str(row[\"argument\"]),\n            \"x\": float(row[\"x\"]),  # Convert to native float\n            \"y\": float(row[\"y\"]),  # Convert to native float\n            \"p\": 0,  # NOTE: 一旦全部0でいれる\n            \"cluster_ids\": cluster_ids,\n            \"attributes\": None,\n            \"url\": None,\n        }\n\n        # Add attributes and URL if available\n        if row[\"arg-id\"] in arg_comment_map:\n            comment_id = arg_comment_map[row[\"arg-id\"]]\n            comment_rows = comments_copy[comments_copy[\"comment-id\"] == comment_id]\n\n            if not comment_rows.empty:\n                comment_row = comment_rows.iloc[0]\n\n                # Add URL if available and enabled\n                if config.get(\"enable_source_link\", False) and \"url\" in comment_row and comment_row[\"url\"] is not None:\n                    argument[\"url\"] = str(comment_row[\"url\"])\n\n                # Add attributes if available\n                if attribute_columns:\n                    attributes = {}\n                    for attr_col in attribute_columns:\n                        # Remove \"attribute_\" prefix for cleaner attribute names\n                        attr_name = attr_col[len(\"attribute_\") :]\n                        # Convert potential numpy types to Python native types\n                        attr_value = comment_row.get(attr_col, None)\n                        if attr_value is not None:\n                            if isinstance(attr_value, np.integer):\n                                attr_value = int(attr_value)\n                            elif isinstance(attr_value, np.floating):\n                                attr_value = float(attr_value)\n                            elif isinstance(attr_value, np.ndarray):\n                                attr_value = attr_value.tolist()\n                        attributes[attr_name] = attr_value\n\n                    # Only add non-empty attributes\n                    if any(v is not None for v in attributes.values()):\n                        argument[\"attributes\"] = attributes\n\n        arguments.append(argument)\n    return arguments\n\n\ndef _build_cluster_value(melted_labels: pd.DataFrame, total_num: int) -\u003e list[Cluster]:\n    results: list[Cluster] = [\n        Cluster(\n            level=0,\n            id=\"0\",\n            label=\"全体\",\n            takeaway=\"\",\n            value=int(total_num),  # Convert to native int\n            parent=\"\",\n            density_rank_percentile=0,\n        )\n    ]\n\n    for _, melted_label in melted_labels.iterrows():\n        # Convert potential NumPy types to native Python types\n        level = (\n            int(melted_label[\"level\"]) if isinstance(melted_label[\"level\"], int | np.integer) else melted_label[\"level\"]\n        )\n        cluster_id = str(melted_label[\"id\"])\n        label = str(melted_label[\"label\"])\n        takeaway = str(melted_label[\"description\"])\n        value = (\n            int(melted_label[\"value\"]) if isinstance(melted_label[\"value\"], int | np.integer) else melted_label[\"value\"]\n        )\n        parent = str(melted_label.get(\"parent\", \"全体\"))\n\n        # Handle density_rank_percentile which might be None or a numeric value\n        density_rank = melted_label.get(\"density_rank_percentile\")\n        if density_rank is not None:\n            if isinstance(density_rank, float | np.floating):\n                density_rank = float(density_rank)\n            elif isinstance(density_rank, int | np.integer):\n                density_rank = int(density_rank)\n\n        cluster_value = Cluster(\n            level=level,\n            id=cluster_id,\n            label=label,\n            takeaway=takeaway,\n            value=value,\n            parent=parent,\n            density_rank_percentile=density_rank,\n        )\n        results.append(cluster_value)\n    return results\n\n\ndef _build_comments_value(\n    comments: pd.DataFrame,\n    arguments: pd.DataFrame,\n    hidden_properties_map: dict[str, list[str]],\n):\n    comment_dict: dict[str, dict[str, str]] = {}\n    useful_comment_ids = set(arguments[\"comment-id\"].values)\n    for _, row in comments.iterrows():\n        id = row[\"comment-id\"]\n        if id in useful_comment_ids:\n            res = {\"comment\": row[\"comment-body\"]}\n            should_skip = any(row[prop] in hidden_values for prop, hidden_values in hidden_properties_map.items())\n            if should_skip:\n                continue\n            comment_dict[str(id)] = res\n\n    return comment_dict\n\n\ndef _build_translations(config):\n    languages = list(config.get(\"translation\", {}).get(\"languages\", []))\n    if len(languages) \u003e 0:\n        with open(PIPELINE_DIR / f\"outputs/{config['output_dir']}/translations.json\") as f:\n            translations = f.read()\n        return json.loads(translations)\n    return {}\n\n\ndef _build_property_map(\n    arguments: pd.DataFrame, comments: pd.DataFrame, hidden_properties_map: dict[str, list[str]], config: dict\n) -\u003e dict[str, dict[str, str]]:\n    property_columns = list(hidden_properties_map.keys()) + list(config[\"extraction\"][\"categories\"].keys())\n    property_map = defaultdict(dict)\n\n    # 指定された property_columns が arguments に存在するかチェック\n    missing_cols = [col for col in property_columns if col not in arguments.columns]\n    if missing_cols:\n        raise ValueError(\n            f\"指定されたカラム {missing_cols} が args.csv に存在しません。\"\n            \"設定ファイルaggregation / hidden_propertiesから該当カラムを取り除いてください。\"\n        )\n\n    for prop in property_columns:\n        for arg_id, row in arguments.iterrows():\n            # LLMによるcategory classificationがうまく行かず、NaNの場合はNoneにする\n            value = row[prop] if not pd.isna(row[prop]) else None\n\n            # Convert NumPy types to Python native types\n            if value is not None:\n                if isinstance(value, np.integer):\n                    value = int(value)\n                elif isinstance(value, np.floating):\n                    value = float(value)\n                elif isinstance(value, np.ndarray):\n                    value = value.tolist()\n                else:\n                    # Convert any other types to string to ensure serialization\n                    try:\n                        value = str(value)\n                    except Exception as e:\n                        print(f\"Error converting value to string: {e}\")\n                        value = None\n\n            # Make sure arg_id is string\n            str_arg_id = str(arg_id)\n            property_map[prop][str_arg_id] = value\n\n    return property_map\n"])</script><script>self.__next_f.push([1,"25:T194c,"])</script><script>self.__next_f.push([1,"import concurrent.futures\nimport json\nimport logging\nimport os\nimport re\n\nimport pandas as pd\nfrom pydantic import BaseModel, Field\nfrom tqdm import tqdm\n\nfrom services.llm import request_to_chat_ai\nfrom services.parse_json_list import parse_extraction_response\nfrom utils import update_progress\n\nCOMMA_AND_SPACE_AND_RIGHT_BRACKET = re.compile(r\",\\s*(\\])\")\n\n\nclass ExtractionResponse(BaseModel):\n    extractedOpinionList: list[str] = Field(..., description=\"抽出した意見のリスト\")\n\n\ndef _validate_property_columns(property_columns: list[str], comments: pd.DataFrame) -\u003e None:\n    if not all(property in comments.columns for property in property_columns):\n        raise ValueError(f\"Properties {property_columns} not found in comments. Columns are {comments.columns}\")\n\n\ndef extraction(config):\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/args.csv\"\n    model = config[\"extraction\"][\"model\"]\n    prompt = config[\"extraction\"][\"prompt\"]\n    workers = config[\"extraction\"][\"workers\"]\n    limit = config[\"extraction\"][\"limit\"]\n    property_columns = config[\"extraction\"][\"properties\"]\n\n    if \"provider\" not in config:\n        raise RuntimeError(\"provider is not set\")\n    provider = config[\"provider\"]\n\n    # カラム名だけを読み込み、必要なカラムが含まれているか確認する\n    comments = pd.read_csv(f\"inputs/{config['input']}.csv\", nrows=0)\n    _validate_property_columns(property_columns, comments)\n    # エラーが出なかった場合、すべての行を読み込む\n    comments = pd.read_csv(\n        f\"inputs/{config['input']}.csv\", usecols=[\"comment-id\", \"comment-body\"] + config[\"extraction\"][\"properties\"]\n    )\n    comment_ids = (comments[\"comment-id\"].values)[:limit]\n    comments.set_index(\"comment-id\", inplace=True)\n    results = pd.DataFrame()\n    update_progress(config, total=len(comment_ids))\n\n    argument_map = {}\n    relation_rows = []\n\n    for i in tqdm(range(0, len(comment_ids), workers)):\n        batch = comment_ids[i : i + workers]\n        batch_inputs = [comments.loc[id][\"comment-body\"] for id in batch]\n        batch_results = extract_batch(\n            batch_inputs, prompt, model, workers, provider, config.get(\"local_llm_address\"), config\n        )\n\n        for comment_id, extracted_args in zip(batch, batch_results, strict=False):\n            for j, arg in enumerate(extracted_args):\n                if arg not in argument_map:\n                    # argumentテーブルに追加\n                    arg_id = f\"A{comment_id}_{j}\"\n                    argument = arg\n                    argument_map[arg] = {\n                        \"arg-id\": arg_id,\n                        \"argument\": argument,\n                    }\n                else:\n                    arg_id = argument_map[arg][\"arg-id\"]\n\n                # relationテーブルにcommentとargの関係を追加\n                relation_row = {\n                    \"arg-id\": arg_id,\n                    \"comment-id\": comment_id,\n                }\n                relation_rows.append(relation_row)\n\n        update_progress(config, incr=len(batch))\n\n    # DataFrame化\n    results = pd.DataFrame(argument_map.values())\n    relation_df = pd.DataFrame(relation_rows)\n\n    if results.empty:\n        raise RuntimeError(\"result is empty, maybe bad prompt\")\n\n    results.to_csv(path, index=False)\n    # comment-idとarg-idの関係を保存\n    relation_df.to_csv(f\"outputs/{dataset}/relations.csv\", index=False)\n\n\nlogging.basicConfig(level=logging.DEBUG)\n\n\ndef extract_batch(batch, prompt, model, workers, provider=\"openai\", local_llm_address=None, config=None):\n    with concurrent.futures.ThreadPoolExecutor(max_workers=workers) as executor:\n        futures_with_index = [\n            (i, executor.submit(extract_arguments, input, prompt, model, provider, local_llm_address))\n            for i, input in enumerate(batch)\n        ]\n\n        done, not_done = concurrent.futures.wait([f for _, f in futures_with_index], timeout=30)\n        results = [[] for _ in range(len(batch))]\n        total_token_input = 0\n        total_token_output = 0\n        total_token_usage = 0\n\n        for _, future in futures_with_index:\n            if future in not_done and not future.cancelled():\n                future.cancel()\n\n        for i, future in futures_with_index:\n            if future in done:\n                try:\n                    result = future.result()\n                    if isinstance(result, tuple) and len(result) == 4:\n                        items, token_input, token_output, token_total = result\n                        results[i] = items\n                        total_token_input += token_input\n                        total_token_output += token_output\n                        total_token_usage += token_total\n                    else:\n                        results[i] = result\n                except Exception as e:\n                    logging.error(f\"Task {future} failed with error: {e}\")\n                    results[i] = []\n\n        if config is not None:\n            config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0) + total_token_usage\n            config[\"token_usage_input\"] = config.get(\"token_usage_input\", 0) + total_token_input\n            config[\"token_usage_output\"] = config.get(\"token_usage_output\", 0) + total_token_output\n            print(\n                f\"Extraction batch: input={total_token_input}, output={total_token_output}, total={total_token_usage} tokens\"\n            )\n\n        return results\n\n\ndef extract_arguments(input, prompt, model, provider=\"openai\", local_llm_address=None):\n    messages = [\n        {\"role\": \"system\", \"content\": prompt},\n        {\"role\": \"user\", \"content\": input},\n    ]\n    try:\n        response, token_input, token_output, token_total = request_to_chat_ai(\n            messages=messages,\n            model=model,\n            is_json=False,\n            json_schema=ExtractionResponse,\n            provider=provider,\n            local_llm_address=local_llm_address,\n            user_api_key=os.getenv(\"USER_API_KEY\"),\n        )\n        items = parse_extraction_response(response)\n        items = list(filter(None, items))  # omit empty strings\n        return items, token_input, token_output, token_total\n    except json.decoder.JSONDecodeError as e:\n        print(\"JSON error:\", e)\n        print(\"Input was:\", input)\n        print(\"Response was:\", response)\n        print(\"Silently giving up on trying to generate valid list.\")\n        return []\n"])</script><script>self.__next_f.push([1,"26:T458,import os\n\nimport pandas as pd\nfrom tqdm import tqdm\n\nfrom services.llm import request_to_embed\n\n\ndef embedding(config):\n    model = config[\"embedding\"][\"model\"]\n    is_embedded_at_local = config[\"is_embedded_at_local\"]\n    # print(\"start embedding\")\n    # print(f\"embedding model: {model}, is_embedded_at_local: {is_embedded_at_local}\")\n\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/embeddings.pkl\"\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\", usecols=[\"arg-id\", \"argument\"])\n    embeddings = []\n    batch_size = 1000\n    for i in tqdm(range(0, len(arguments), batch_size)):\n        args = arguments[\"argument\"].tolist()[i : i + batch_size]\n        embeds = request_to_embed(\n            args,\n            model,\n            is_embedded_at_local,\n            config[\"provider\"],\n            local_llm_address=config.get(\"local_llm_address\"),\n            user_api_key=os.getenv(\"USER_API_KEY\"),\n        )\n        embeddings.extend(embeds)\n    df = pd.DataFrame([{\"arg-id\": arguments.iloc[i][\"arg-id\"], \"embedding\": e} for i, e in enumerate(embeddings)])\n    df.to_pickle(path)\n27:T1149,"])</script><script>self.__next_f.push([1,"\"\"\"Cluster the arguments using UMAP + HDBSCAN and GPT-4.\"\"\"\n\nfrom importlib import import_module\n\nimport numpy as np\nimport pandas as pd\nimport scipy.cluster.hierarchy as sch\nfrom sklearn.cluster import KMeans\n\n\ndef hierarchical_clustering(config):\n    UMAP = import_module(\"umap\").UMAP\n\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/hierarchical_clusters.csv\"\n    arguments_df = pd.read_csv(f\"outputs/{dataset}/args.csv\", usecols=[\"arg-id\", \"argument\"])\n    embeddings_df = pd.read_pickle(f\"outputs/{dataset}/embeddings.pkl\")\n    embeddings_array = np.asarray(embeddings_df[\"embedding\"].values.tolist())\n    cluster_nums = config[\"hierarchical_clustering\"][\"cluster_nums\"]\n\n    n_samples = embeddings_array.shape[0]\n    # デフォルト設定は15\n    default_n_neighbors = 15\n\n    # テスト等サンプルが少なすぎる場合、n_neighborsの設定値を下げる\n    if n_samples \u003c= default_n_neighbors:\n        n_neighbors = max(2, n_samples - 1)  # 最低2以上\n    else:\n        n_neighbors = default_n_neighbors\n\n    umap_model = UMAP(random_state=42, n_components=2, n_neighbors=n_neighbors)\n    # TODO 詳細エラーメッセージを加える\n    # 以下のエラーの場合、おそらく元の意見件数が少なすぎることが原因\n    # TypeError: Cannot use scipy.linalg.eigh for sparse A with k \u003e= N. Use scipy.linalg.eigh(A.toarray()) or reduce k.\n    umap_embeds = umap_model.fit_transform(embeddings_array)\n\n    cluster_results = hierarchical_clustering_embeddings(\n        umap_embeds=umap_embeds,\n        cluster_nums=cluster_nums,\n    )\n    result_df = pd.DataFrame(\n        {\n            \"arg-id\": arguments_df[\"arg-id\"],\n            \"argument\": arguments_df[\"argument\"],\n            \"x\": umap_embeds[:, 0],\n            \"y\": umap_embeds[:, 1],\n        }\n    )\n\n    for cluster_level, final_labels in enumerate(cluster_results.values(), start=1):\n        result_df[f\"cluster-level-{cluster_level}-id\"] = [f\"{cluster_level}_{label}\" for label in final_labels]\n\n    result_df.to_csv(path, index=False)\n\n\ndef generate_cluster_count_list(min_clusters: int, max_clusters: int):\n    cluster_counts = []\n    current = min_clusters\n    cluster_counts.append(current)\n\n    if min_clusters == max_clusters:\n        return cluster_counts\n\n    while True:\n        next_double = current * 2\n        next_triple = current * 3\n\n        if next_double \u003e= max_clusters:\n            if cluster_counts[-1] != max_clusters:\n                cluster_counts.append(max_clusters)\n            break\n\n        # 次の倍はまだ max_clusters に収まるが、3倍だと超える\n        # -\u003e (次の倍は細かすぎるので)スキップして max_clusters に飛ぶ\n        if next_triple \u003e max_clusters:\n            cluster_counts.append(max_clusters)\n            break\n\n        cluster_counts.append(next_double)\n        current = next_double\n\n    return cluster_counts\n\n\ndef merge_clusters_with_hierarchy(\n    cluster_centers: np.ndarray,\n    kmeans_labels: np.ndarray,\n    umap_array: np.ndarray,\n    n_cluster_cut: int,\n):\n    Z = sch.linkage(cluster_centers, method=\"ward\")\n    cluster_labels_merged = sch.fcluster(Z, t=n_cluster_cut, criterion=\"maxclust\")\n\n    n_samples = umap_array.shape[0]\n    final_labels = np.zeros(n_samples, dtype=int)\n\n    for i in range(n_samples):\n        original_label = kmeans_labels[i]\n        final_labels[i] = cluster_labels_merged[original_label]\n\n    return final_labels\n\n\ndef hierarchical_clustering_embeddings(\n    umap_embeds,\n    cluster_nums,\n):\n    # 最大分割数でクラスタリングを実施\n    print(\"start initial clustering\")\n    initial_cluster_num = cluster_nums[-1]\n    kmeans_model = KMeans(n_clusters=initial_cluster_num, random_state=42)\n    kmeans_model.fit(umap_embeds)\n    print(\"end initial clustering\")\n\n    results = {}\n    print(\"start hierarchical clustering\")\n    cluster_nums.sort()\n    print(cluster_nums)\n    for n_cluster_cut in cluster_nums[:-1]:\n        print(\"n_cluster_cut: \", n_cluster_cut)\n        final_labels = merge_clusters_with_hierarchy(\n            cluster_centers=kmeans_model.cluster_centers_,\n            kmeans_labels=kmeans_model.labels_,\n            umap_array=umap_embeds,\n            n_cluster_cut=n_cluster_cut,\n        )\n        results[n_cluster_cut] = final_labels\n\n    results[initial_cluster_num] = kmeans_model.labels_\n    print(\"end hierarchical clustering\")\n\n    return results\n"])</script><script>self.__next_f.push([1,"28:T1c36,"])</script><script>self.__next_f.push([1,"import json\nimport os\nfrom concurrent.futures import ThreadPoolExecutor\nfrom functools import partial\nfrom typing import TypedDict\n\nimport pandas as pd\nfrom pydantic import BaseModel, Field\n\nfrom services.llm import request_to_chat_ai\n\n\nclass LabellingResult(TypedDict):\n    \"\"\"各クラスタのラベリング結果を表す型\"\"\"\n\n    cluster_id: str  # クラスタのID\n    label: str  # クラスタのラベル名\n    description: str  # クラスタの説明文\n\n\ndef hierarchical_initial_labelling(config: dict) -\u003e None:\n    \"\"\"階層的クラスタリングの初期ラベリングを実行する\n\n    Args:\n        config: 設定情報を含む辞書\n            - output_dir: 出力ディレクトリ名\n            - hierarchical_initial_labelling: 初期ラベリングの設定\n                - sampling_num: サンプリング数\n                - prompt: LLMへのプロンプト\n                - model: 使用するLLMモデル名\n                - workers: 並列処理のワーカー数\n            - provider: LLMプロバイダー\n    \"\"\"\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/hierarchical_initial_labels.csv\"\n    clusters_argument_df = pd.read_csv(f\"outputs/{dataset}/hierarchical_clusters.csv\")\n\n    cluster_id_columns = [col for col in clusters_argument_df.columns if col.startswith(\"cluster-level-\")]\n    initial_cluster_id_column = cluster_id_columns[-1]\n    sampling_num = config[\"hierarchical_initial_labelling\"][\"sampling_num\"]\n    initial_labelling_prompt = config[\"hierarchical_initial_labelling\"][\"prompt\"]\n    model = config[\"hierarchical_initial_labelling\"][\"model\"]\n    workers = config[\"hierarchical_initial_labelling\"][\"workers\"]\n\n    # トークン使用量を追跡するための変数を初期化\n    config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0)\n\n    initial_label_df = initial_labelling(\n        initial_labelling_prompt,\n        clusters_argument_df,\n        sampling_num,\n        model,\n        workers,\n        config[\"provider\"],\n        config.get(\"local_llm_address\"),\n        config,  # configを渡して、トークン使用量を累積できるようにする\n    )\n    print(\"start initial labelling\")\n    initial_clusters_argument_df = clusters_argument_df.merge(\n        initial_label_df,\n        left_on=initial_cluster_id_column,\n        right_on=\"cluster_id\",\n        how=\"left\",\n    ).rename(\n        columns={\n            \"label\": f\"{initial_cluster_id_column.replace('-id', '')}-label\",\n            \"description\": f\"{initial_cluster_id_column.replace('-id', '')}-description\",\n        }\n    )\n    print(\"end initial labelling\")\n    initial_clusters_argument_df.to_csv(path, index=False)\n\n\ndef initial_labelling(\n    prompt: str,\n    clusters_df: pd.DataFrame,\n    sampling_num: int,\n    model: str,\n    workers: int,\n    provider: str = \"openai\",\n    local_llm_address: str | None = None,\n    config: dict | None = None,  # configを追加\n) -\u003e pd.DataFrame:\n    \"\"\"各クラスタに対して初期ラベリングを実行する\n\n    Args:\n        prompt: LLMへのプロンプト\n        clusters_df: クラスタリング結果のDataFrame\n        sampling_num: 各クラスタからサンプリングする意見の数\n        model: 使用するLLMモデル名\n        workers: 並列処理のワーカー数\n        provider: LLMプロバイダー\n        local_llm_address: ローカルLLMのアドレス\n        config: 設定情報を含む辞書（トークン使用量の累積に使用）\n\n    Returns:\n        各クラスタのラベリング結果を含むDataFrame\n    \"\"\"\n    cluster_columns = [col for col in clusters_df.columns if col.startswith(\"cluster-level-\")]\n    initial_cluster_column = cluster_columns[-1]\n    cluster_ids = clusters_df[initial_cluster_column].unique()\n    process_func = partial(\n        process_initial_labelling,\n        df=clusters_df,\n        prompt=prompt,\n        sampling_num=sampling_num,\n        target_column=initial_cluster_column,\n        model=model,\n        provider=provider,\n        local_llm_address=local_llm_address,\n        config=config,  # configを渡す\n    )\n    with ThreadPoolExecutor(max_workers=workers) as executor:\n        results = list(executor.map(process_func, cluster_ids))\n    return pd.DataFrame(results)\n\n\nclass LabellingFromat(BaseModel):\n    \"\"\"ラベリング結果のフォーマットを定義する\"\"\"\n\n    label: str = Field(..., description=\"クラスタのラベル名\")\n    description: str = Field(..., description=\"クラスタの説明文\")\n\n\ndef process_initial_labelling(\n    cluster_id: str,\n    df: pd.DataFrame,\n    prompt: str,\n    sampling_num: int,\n    target_column: str,\n    model: str,\n    provider: str = \"openai\",\n    local_llm_address: str | None = None,\n    config: dict | None = None,  # configを追加\n) -\u003e LabellingResult:\n    \"\"\"個別のクラスタに対してラベリングを実行する\n\n    Args:\n        cluster_id: 処理対象のクラスタID\n        df: クラスタリング結果のDataFrame\n        prompt: LLMへのプロンプト\n        sampling_num: サンプリングする意見の数\n        target_column: クラスタIDが格納されている列名\n        model: 使用するLLMモデル名\n        provider: LLMプロバイダー\n        local_llm_address: ローカルLLMのアドレス\n        config: 設定情報を含む辞書（トークン使用量の累積に使用）\n\n    Returns:\n        クラスタのラベリング結果\n    \"\"\"\n    cluster_data = df[df[target_column] == cluster_id]\n    sampling_num = min(sampling_num, len(cluster_data))\n    cluster = cluster_data.sample(sampling_num)\n    input = \"\\n\".join(cluster[\"argument\"].values)\n    messages = [\n        {\"role\": \"system\", \"content\": prompt},\n        {\"role\": \"user\", \"content\": input},\n    ]\n    try:\n        response_text, token_input, token_output, token_total = request_to_chat_ai(\n            messages=messages,\n            model=model,\n            provider=provider,\n            json_schema=LabellingFromat,\n            local_llm_address=local_llm_address,\n            user_api_key=os.getenv(\"USER_API_KEY\"),\n        )\n\n        # トークン使用量を累積（configが渡されている場合）\n        if config is not None:\n            config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0) + token_total\n            config[\"token_usage_input\"] = config.get(\"token_usage_input\", 0) + token_input\n            config[\"token_usage_output\"] = config.get(\"token_usage_output\", 0) + token_output\n\n        response_json = json.loads(response_text) if isinstance(response_text, str) else response_text\n        return LabellingResult(\n            cluster_id=cluster_id,\n            label=response_json.get(\"label\", \"エラーでラベル名が取得できませんでした\"),\n            description=response_json.get(\"description\", \"エラーで解説が取得できませんでした\"),\n        )\n    except Exception as e:\n        print(e)\n        return LabellingResult(\n            cluster_id=cluster_id,\n            label=\"エラーでラベル名が取得できませんでした\",\n            description=\"エラーで解説が取得できませんでした\",\n        )\n"])</script><script>self.__next_f.push([1,"29:T337b,"])</script><script>self.__next_f.push([1,"import json\nimport os\nfrom concurrent.futures import ThreadPoolExecutor\nfrom dataclasses import dataclass\nfrom functools import partial\n\nimport numpy as np\nimport pandas as pd\nfrom pydantic import BaseModel, Field\nfrom tqdm import tqdm\n\nfrom services.llm import request_to_chat_ai\n\n\n@dataclass\nclass ClusterColumns:\n    \"\"\"同一階層のクラスター関連のカラム名を管理するクラス\"\"\"\n\n    id: str\n    label: str\n    description: str\n\n    @classmethod\n    def from_id_column(cls, id_column: str) -\u003e \"ClusterColumns\":\n        \"\"\"ID列名から関連するカラム名を生成\"\"\"\n        return cls(\n            id=id_column,\n            label=id_column.replace(\"-id\", \"-label\"),\n            description=id_column.replace(\"-id\", \"-description\"),\n        )\n\n\n@dataclass\nclass ClusterValues:\n    \"\"\"対象クラスタのlabel/descriptionを管理するクラス\"\"\"\n\n    label: str\n    description: str\n\n    def to_prompt_text(self) -\u003e str:\n        return f\"- {self.label}: {self.description}\"\n\n\ndef hierarchical_merge_labelling(config: dict) -\u003e None:\n    \"\"\"階層的クラスタリングの結果に対してマージラベリングを実行する\n\n    Args:\n        config: 設定情報を含む辞書\n            - output_dir: 出力ディレクトリ名\n            - hierarchical_merge_labelling: マージラベリングの設定\n                - sampling_num: サンプリング数\n                - prompt: LLMへのプロンプト\n                - model: 使用するLLMモデル名\n                - workers: 並列処理のワーカー数\n            - provider: LLMプロバイダー\n    \"\"\"\n    dataset = config[\"output_dir\"]\n    merge_path = f\"outputs/{dataset}/hierarchical_merge_labels.csv\"\n    clusters_df = pd.read_csv(f\"outputs/{dataset}/hierarchical_initial_labels.csv\")\n\n    cluster_id_columns: list[str] = _filter_id_columns(clusters_df.columns)\n    # ボトムクラスタのラベル・説明とクラスタid付きの各argumentを入力し、各階層のクラスタラベル・説明を生成し、argumentに付けたdfを作成\n    merge_result_df = merge_labelling(\n        clusters_df=clusters_df,\n        cluster_id_columns=sorted(cluster_id_columns, reverse=True),\n        config=config,\n    )\n    # 上記のdfから各クラスタのlevel, id, label, description, valueを取得してdfを作成\n    melted_df = melt_cluster_data(merge_result_df)\n    # 上記のdfに親子関係を追加\n    parent_child_df = _build_parent_child_mapping(merge_result_df, cluster_id_columns)\n    melted_df = melted_df.merge(parent_child_df, on=[\"level\", \"id\"], how=\"left\")\n    density_df = calculate_cluster_density(melted_df, config)\n    density_df.to_csv(merge_path, index=False)\n\n\ndef _build_parent_child_mapping(df: pd.DataFrame, cluster_id_columns: list[str]):\n    \"\"\"クラスタ間の親子関係をマッピングする\n\n    Args:\n        df: クラスタリング結果のDataFrame\n        cluster_id_columns: クラスタIDのカラム名のリスト\n\n    Returns:\n        親子関係のマッピング情報を含むDataFrame\n    \"\"\"\n    results = []\n    top_cluster_column = cluster_id_columns[0]\n    top_cluster_values = df[top_cluster_column].unique()\n    for c in top_cluster_values:\n        results.append(\n            {\n                \"level\": 1,\n                \"id\": c,\n                \"parent\": \"0\",  # aggregationで追加する全体クラスタのid\n            }\n        )\n\n    for idx in range(len(cluster_id_columns) - 1):\n        current_column = cluster_id_columns[idx]\n        children_column = cluster_id_columns[idx + 1]\n        current_level = current_column.replace(\"-id\", \"\").replace(\"cluster-level-\", \"\")\n        # 現在のレベルのクラスタid\n        current_cluster_values = df[current_column].unique()\n        for current_id in current_cluster_values:\n            children_ids = df.loc[df[current_column] == current_id, children_column].unique()\n            for child_id in children_ids:\n                results.append(\n                    {\n                        \"level\": int(current_level) + 1,\n                        \"id\": child_id,\n                        \"parent\": current_id,\n                    }\n                )\n    return pd.DataFrame(results)\n\n\ndef _filter_id_columns(columns: list[str]) -\u003e list[str]:\n    \"\"\"クラスタIDのカラム名をフィルタリングする\n\n    Args:\n        columns: 全カラム名のリスト\n\n    Returns:\n        クラスタIDのカラム名のリスト\n    \"\"\"\n    return [col for col in columns if col.startswith(\"cluster-level-\") and col.endswith(\"-id\")]\n\n\ndef melt_cluster_data(df: pd.DataFrame) -\u003e pd.DataFrame:\n    \"\"\"クラスタデータを行形式に変換する\n\n    cluster-level-n-(id|label|description) を行形式 (level, id, label, description, value) にまとめる。\n    [cluster-level-n-id, cluster-level-n-label, cluster-level-n-description] を [level, id, label, description, value(件数)] に変換する。\n\n    Args:\n        df: クラスタリング結果のDataFrame\n\n    Returns:\n        行形式に変換されたDataFrame\n    \"\"\"\n    id_columns: list[str] = _filter_id_columns(df.columns)\n    levels: set[int] = {int(col.replace(\"cluster-level-\", \"\").replace(\"-id\", \"\")) for col in id_columns}\n    all_rows: list[dict] = []\n\n    # levelごとに各クラスタの出現件数を集計・縦持ちにする\n    for level in levels:\n        cluster_columns = ClusterColumns.from_id_column(f\"cluster-level-{level}-id\")\n        # クラスタidごとの件数集計\n        level_count_df = df.groupby(cluster_columns.id).size().reset_index(name=\"value\")\n\n        level_unique_val_df = df[\n            [cluster_columns.id, cluster_columns.label, cluster_columns.description]\n        ].drop_duplicates()\n        level_unique_val_df = level_unique_val_df.merge(level_count_df, on=cluster_columns.id, how=\"left\")\n        level_unique_vals = [\n            {\n                \"level\": level,\n                \"id\": row[cluster_columns.id],\n                \"label\": row[cluster_columns.label],\n                \"description\": row[cluster_columns.description],\n                \"value\": row[\"value\"],\n            }\n            for _, row in level_unique_val_df.iterrows()\n        ]\n        all_rows.extend(level_unique_vals)\n    return pd.DataFrame(all_rows)\n\n\ndef merge_labelling(clusters_df: pd.DataFrame, cluster_id_columns: list[str], config) -\u003e pd.DataFrame:\n    \"\"\"階層的なクラスタのマージラベリングを実行する\n\n    Args:\n        clusters_df: クラスタリング結果のDataFrame\n        cluster_id_columns: クラスタIDのカラム名のリスト\n        config: 設定情報を含む辞書\n\n    Returns:\n        マージラベリング結果を含むDataFrame\n    \"\"\"\n    for idx in tqdm(range(len(cluster_id_columns) - 1)):\n        previous_columns = ClusterColumns.from_id_column(cluster_id_columns[idx])\n        current_columns = ClusterColumns.from_id_column(cluster_id_columns[idx + 1])\n\n        process_fn = partial(\n            process_merge_labelling,\n            result_df=clusters_df,\n            current_columns=current_columns,\n            previous_columns=previous_columns,\n            config=config,\n        )\n\n        current_cluster_ids = sorted(clusters_df[current_columns.id].unique())\n        with ThreadPoolExecutor(max_workers=config[\"hierarchical_merge_labelling\"][\"workers\"]) as executor:\n            responses = list(\n                tqdm(\n                    executor.map(process_fn, current_cluster_ids),\n                    total=len(current_cluster_ids),\n                )\n            )\n\n        current_result_df = pd.DataFrame(responses)\n        clusters_df = clusters_df.merge(current_result_df, on=[current_columns.id])\n    return clusters_df\n\n\nclass LabellingFromat(BaseModel):\n    \"\"\"ラベリング結果のフォーマットを定義する\"\"\"\n\n    label: str = Field(..., description=\"クラスタのラベル名\")\n    description: str = Field(..., description=\"クラスタの説明文\")\n\n\ndef process_merge_labelling(\n    target_cluster_id: str,\n    result_df: pd.DataFrame,\n    current_columns: ClusterColumns,\n    previous_columns: ClusterColumns,\n    config,\n):\n    \"\"\"個別のクラスタに対してマージラベリングを実行する\n\n    Args:\n        target_cluster_id: 処理対象のクラスタID\n        result_df: クラスタリング結果のDataFrame\n        current_columns: 現在のレベルのカラム情報\n        previous_columns: 前のレベルのカラム情報\n        config: 設定情報を含む辞書\n\n    Returns:\n        マージラベリング結果を含む辞書\n    \"\"\"\n\n    def filter_previous_values(df: pd.DataFrame, previous_columns: ClusterColumns) -\u003e list[ClusterValues]:\n        \"\"\"前のレベルのクラスタ情報を取得する\"\"\"\n        previous_records = df[df[current_columns.id] == target_cluster_id][\n            [previous_columns.label, previous_columns.description]\n        ].drop_duplicates()\n        previous_values = [\n            ClusterValues(\n                label=row[previous_columns.label],\n                description=row[previous_columns.description],\n            )\n            for _, row in previous_records.iterrows()\n        ]\n        return previous_values\n\n    previous_values = filter_previous_values(result_df, previous_columns)\n    if len(previous_values) == 1:\n        return {\n            current_columns.id: target_cluster_id,\n            current_columns.label: previous_values[0].label,\n            current_columns.description: previous_values[0].description,\n        }\n    elif len(previous_values) == 0:\n        raise ValueError(f\"クラスタ {target_cluster_id} には前のレベルのクラスタが存在しません。\")\n\n    current_cluster_data = result_df[result_df[current_columns.id] == target_cluster_id]\n    sampling_num = min(\n        config[\"hierarchical_merge_labelling\"][\"sampling_num\"],\n        len(current_cluster_data),\n    )\n    sampled_data = current_cluster_data.sample(sampling_num)\n    sampled_argument_text = \"\\n\".join(sampled_data[\"argument\"].values)\n    cluster_text = \"\\n\".join([value.to_prompt_text() for value in previous_values])\n    messages = [\n        {\"role\": \"system\", \"content\": config[\"hierarchical_merge_labelling\"][\"prompt\"]},\n        {\n            \"role\": \"user\",\n            \"content\": \"クラスタラベル\\n\" + cluster_text + \"\\n\" + \"クラスタの意見\\n\" + sampled_argument_text,\n        },\n    ]\n    try:\n        response_text, token_input, token_output, token_total = request_to_chat_ai(\n            messages=messages,\n            model=config[\"hierarchical_merge_labelling\"][\"model\"],\n            json_schema=LabellingFromat,\n            provider=config[\"provider\"],\n            local_llm_address=config.get(\"local_llm_address\"),\n            user_api_key=os.getenv(\"USER_API_KEY\"),\n        )\n\n        config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0) + token_total\n        config[\"token_usage_input\"] = config.get(\"token_usage_input\", 0) + token_input\n        config[\"token_usage_output\"] = config.get(\"token_usage_output\", 0) + token_output\n        print(f\"Merge labelling: input={token_input}, output={token_output}, total={token_total} tokens\")\n\n        response_json = json.loads(response_text) if isinstance(response_text, str) else response_text\n        return {\n            current_columns.id: target_cluster_id,\n            current_columns.label: response_json.get(\"label\", \"エラーでラベル名が取得できませんでした\"),\n            current_columns.description: response_json.get(\"description\", \"エラーで解説が取得できませんでした\"),\n        }\n    except Exception as e:\n        print(f\"エラーが発生しました: {e}\")\n        return {\n            current_columns.id: target_cluster_id,\n            current_columns.label: \"エラーでラベル名が取得できませんでした\",\n            current_columns.description: \"エラーで解説が取得できませんでした\",\n        }\n\n\ndef calculate_cluster_density(melted_df: pd.DataFrame, config: dict):\n    \"\"\"クラスタ内の密度計算\"\"\"\n    hierarchical_cluster_df = pd.read_csv(f\"outputs/{config['output_dir']}/hierarchical_clusters.csv\")\n\n    densities = []\n    for level, c_id in zip(melted_df[\"level\"], melted_df[\"id\"], strict=False):\n        cluster_embeds = hierarchical_cluster_df[hierarchical_cluster_df[f\"cluster-level-{level}-id\"] == c_id][\n            [\"x\", \"y\"]\n        ].values\n        density = calculate_density(cluster_embeds)\n        densities.append(density)\n\n    # 密度のランクを計算\n    melted_df[\"density\"] = densities\n    melted_df[\"density_rank\"] = melted_df.groupby(\"level\")[\"density\"].rank(ascending=False, method=\"first\")\n    melted_df[\"density_rank_percentile\"] = melted_df.groupby(\"level\")[\"density_rank\"].transform(lambda x: x / len(x))\n    return melted_df\n\n\ndef calculate_density(embeds: np.ndarray):\n    \"\"\"平均距離に基づいて密度を計算\"\"\"\n    center = np.mean(embeds, axis=0)\n    distances = np.linalg.norm(embeds - center, axis=1)\n    avg_distance = np.mean(distances)\n    density = 1 / (avg_distance + 1e-10)\n    return density\n"])</script><script>self.__next_f.push([1,"2a:Ta82,"])</script><script>self.__next_f.push([1,"\"\"\"Create summaries for the clusters.\"\"\"\n\nimport json\nimport os\nimport re\n\nimport pandas as pd\nfrom pydantic import BaseModel, Field\n\nfrom services.llm import request_to_chat_ai\n\n\nclass OverviewResponse(BaseModel):\n    summary: str = Field(..., description=\"クラスターの全体的な要約\")\n\n\ndef hierarchical_overview(config):\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/hierarchical_overview.txt\"\n\n    hierarchical_label_df = pd.read_csv(f\"outputs/{dataset}/hierarchical_merge_labels.csv\")\n\n    prompt = config[\"hierarchical_overview\"][\"prompt\"]\n    model = config[\"hierarchical_overview\"][\"model\"]\n\n    # TODO: level1で固定にしているが、設定で変えられるようにする\n    target_level = 1\n    target_records = hierarchical_label_df[hierarchical_label_df[\"level\"] == target_level]\n    ids = target_records[\"id\"].to_list()\n    labels = target_records[\"label\"].to_list()\n    descriptions = target_records[\"description\"].to_list()\n    target_records.set_index(\"id\", inplace=True)\n\n    input_text = \"\"\n    for i, _ in enumerate(ids):\n        input_text += f\"# Cluster {i}/{len(ids)}: {labels[i]}\\n\\n\"\n        input_text += descriptions[i] + \"\\n\\n\"\n\n    messages = [{\"role\": \"system\", \"content\": prompt}, {\"role\": \"user\", \"content\": input_text}]\n    response_text, token_input, token_output, token_total = request_to_chat_ai(\n        messages=messages,\n        model=model,\n        provider=config[\"provider\"],\n        local_llm_address=config.get(\"local_llm_address\"),\n        user_api_key=os.getenv(\"USER_API_KEY\"),\n        json_schema=OverviewResponse,\n    )\n\n    # トークン使用量を累積\n    config[\"total_token_usage\"] = config.get(\"total_token_usage\", 0) + token_total\n    config[\"token_usage_input\"] = config.get(\"token_usage_input\", 0) + token_input\n    config[\"token_usage_output\"] = config.get(\"token_usage_output\", 0) + token_output\n    print(f\"Hierarchical overview: input={token_input}, output={token_output}, total={token_total} tokens\")\n\n    try:\n        # structured outputとしてパースできるなら処理する\n        if isinstance(response_text, dict):\n            parsed_response = response_text\n        else:\n            parsed_response = json.loads(response_text)\n\n        with open(path, \"w\") as file:\n            file.write(parsed_response[\"summary\"])\n\n    except Exception:\n        # thinkタグが出力されるReasoningモデル用に、thinkタグを除去する\n        thinking_removed = re.sub(\n            r\"\u003cthink\\b[^\u003e]*\u003e.*?\u003c/think\u003e\",\n            \"\",\n            response_text,\n            flags=re.DOTALL,\n        )\n\n        with open(path, \"w\") as file:\n            file.write(thinking_removed)\n"])</script><script>self.__next_f.push([1,"2b:T458,import os\n\nimport pandas as pd\nfrom tqdm import tqdm\n\nfrom services.llm import request_to_embed\n\n\ndef embedding(config):\n    model = config[\"embedding\"][\"model\"]\n    is_embedded_at_local = config[\"is_embedded_at_local\"]\n    # print(\"start embedding\")\n    # print(f\"embedding model: {model}, is_embedded_at_local: {is_embedded_at_local}\")\n\n    dataset = config[\"output_dir\"]\n    path = f\"outputs/{dataset}/embeddings.pkl\"\n    arguments = pd.read_csv(f\"outputs/{dataset}/args.csv\", usecols=[\"arg-id\", \"argument\"])\n    embeddings = []\n    batch_size = 1000\n    for i in tqdm(range(0, len(arguments), batch_size)):\n        args = arguments[\"argument\"].tolist()[i : i + batch_size]\n        embeds = request_to_embed(\n            args,\n            model,\n            is_embedded_at_local,\n            config[\"provider\"],\n            local_llm_address=config.get(\"local_llm_address\"),\n            user_api_key=os.getenv(\"USER_API_KEY\"),\n        )\n        embeddings.extend(embeds)\n    df = pd.DataFrame([{\"arg-id\": arguments.iloc[i][\"arg-id\"], \"embedding\": e} for i, e in enumerate(embeddings)])\n    df.to_pickle(path)\n"])</script><script>self.__next_f.push([1,"8:[[\"$\",\"$L11\",null,{}],[\"$\",\"$L12\",null,{\"className\":\"container\",\"mt\":\"8\",\"children\":[[\"$\",\"$L12\",null,{\"mx\":\"auto\",\"maxW\":\"750px\",\"mb\":8,\"children\":[[\"$\",\"$L13\",null,{\"textAlign\":\"left\",\"fontSize\":\"xl\",\"mb\":5,\"children\":\"レポート\"}],[\"$\",\"$L13\",null,{\"as\":\"h2\",\"size\":\"4xl\",\"mb\":2,\"className\":\"headingColor\",\"children\":\"②自分が市長なら、2040年に向けてこんな課題に取り組む【10/28 12:00更新】\"}],[\"$\",\"$L14\",null,{\"fontWeight\":\"bold\",\"fontSize\":\"xl\",\"mb\":2,\"children\":[[\"$\",\"$L15\",null,{\"mr\":1,\"children\":[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":20,\"height\":20,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-messages-square\",\"children\":[[\"$\",\"path\",\"p1xzt8\",{\"d\":\"M14 9a2 2 0 0 1-2 2H6l-4 4V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2z\"}],[\"$\",\"path\",\"1cx29u\",{\"d\":\"M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1\"}],\"$undefined\"]}]}],\"70\",\"件\"]}],[\"$\",\"p\",null,{\"children\":\"舞鶴市では観光振興と交通利便性の向上を通じて地域活性化を目指しており、公共交通の充実や子育て支援が重要視されています。また、地域経済の活性化には商業施設の誘致やコミュニティの再生が求められ、子育てと医療の充実も必要とされています。教育環境の向上や世代間交流の促進、安全な観光環境の整備も重要な課題として挙げられています。これらの取り組みにより、舞鶴市の持続可能な発展が期待されています。\"}]]}],[\"$\",\"$L16\",null,{\"result\":{\"arguments\":[{\"arg_id\":\"Acsv-1_0\",\"argument\":\"赤レンガを中心とした観光業を推進すべき\",\"x\":10.966046,\"y\":5.9486156,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_1\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-1_1\",\"argument\":\"モールなどの大型商業施設やアウトレットを誘致すべき\",\"x\":11.2844095,\"y\":6.9738007,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_13\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-1_2\",\"argument\":\"子育て世帯が暮らしやすいように給食や医療の無償化を行い、子ども世帯にお金の給付をすべき\",\"x\":13.397107,\"y\":7.7140017,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_23\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-1_3\",\"argument\":\"舞鶴にしかない魅力的なお菓子を活用すべき\",\"x\":12.184224,\"y\":4.56636,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_3\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-1_4\",\"argument\":\"バイパス道路の整備を行い、渋滞を解消すべき\",\"x\":11.2104,\"y\":5.158895,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_14\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-1_5\",\"argument\":\"病院を1つに統合し、専門医療を充実させるべき\",\"x\":12.57363,\"y\":8.8745365,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_6\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-1_6\",\"argument\":\"加佐地区の魅力化づくりを進めるべき\",\"x\":11.323777,\"y\":6.092178,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_12\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-1_7\",\"argument\":\"西舞鶴駅と東舞鶴駅の再開発を行うべき\",\"x\":11.66399,\"y\":4.511276,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_21\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-1_8\",\"argument\":\"地元の子が地元の高校に進学できるようにするべき\",\"x\":13.633017,\"y\":9.084007,\"p\":0,\"cluster_ids\":[\"0\",\"1_2\",\"2_9\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-2_0\",\"argument\":\"舞鶴の人口を増やすべきである。\",\"x\":12.049707,\"y\":4.2420087,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_3\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-2_1\",\"argument\":\"大学をつくるべきである。\",\"x\":13.878644,\"y\":8.944138,\"p\":0,\"cluster_ids\":[\"0\",\"1_2\",\"2_9\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-3_0\",\"argument\":\"舞鶴に青少年団体や学校、こども園、幼稚園、保育園が繋がれる枠組みを作るべき\",\"x\":12.317755,\"y\":4.50309,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_3\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-3_1\",\"argument\":\"指導者の育成や子ども達の繋がりを促進し、選択肢を増やすべき\",\"x\":14.220879,\"y\":8.016042,\"p\":0,\"cluster_ids\":[\"0\",\"1_2\",\"2_16\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-3_2\",\"argument\":\"社会で子供を育てることができる街にするべき\",\"x\":13.691233,\"y\":7.939284,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_23\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-4_0\",\"argument\":\"学校給食はオーガニック化すべきである。\",\"x\":14.111828,\"y\":9.157634,\"p\":0,\"cluster_ids\":[\"0\",\"1_2\",\"2_24\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-4_1\",\"argument\":\"学校給食に地産地消を取り入れるべきである。\",\"x\":13.78415,\"y\":8.846015,\"p\":0,\"cluster_ids\":[\"0\",\"1_2\",\"2_9\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-5_0\",\"argument\":\"東西のシャッター街を復興するために、子どもが自由に立ち寄って遊べる場所を作るべきである。\",\"x\":12.36189,\"y\":6.001901,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_11\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-5_1\",\"argument\":\"店舗が復活しない理由を聞き取り、支援できるなら支援する必要がある。\",\"x\":12.41557,\"y\":7.757696,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_15\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-5_2\",\"argument\":\"芸術活動の場を作り、活動を誘致することが重要である。\",\"x\":11.817093,\"y\":6.476582,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_5\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-5_3\",\"argument\":\"親子をひき寄せ、最終的に商業的に成り立つよう誘導するべきである。\",\"x\":11.394108,\"y\":7.5472245,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_8\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-6_0\",\"argument\":\"新しい図書館を活用して教育環境を充実させたい\",\"x\":14.591946,\"y\":8.638426,\"p\":0,\"cluster_ids\":[\"0\",\"1_2\",\"2_4\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-6_1\",\"argument\":\"全世代が参加できる生涯学習の仕組みを作りたい\",\"x\":14.559177,\"y\":8.41192,\"p\":0,\"cluster_ids\":[\"0\",\"1_2\",\"2_4\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-6_2\",\"argument\":\"誰でも意見を言いやすい仕組みを整えたい\",\"x\":13.350232,\"y\":6.9864097,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_20\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-7_0\",\"argument\":\"様々な分野が揃い、この病院で完結する一つの大きな病院を作るべきである。\",\"x\":12.399736,\"y\":8.898566,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_6\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-7_1\",\"argument\":\"その病院にはドクターヘリも完備すべきである。\",\"x\":12.663446,\"y\":8.747202,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_6\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-7_2\",\"argument\":\"高潮対策を進めるべきである。\",\"x\":13.929849,\"y\":7.236013,\"p\":0,\"cluster_ids\":[\"0\",\"1_1\",\"2_10\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-8_0\",\"argument\":\"働く場所の確保が重要である\",\"x\":13.163688,\"y\":6.3189125,\"p\":0,\"cluster_ids\":[\"0\",\"1_1\",\"2_0\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-8_1\",\"argument\":\"企業の誘致を進めるために税制優遇を提供すべき\",\"x\":11.436481,\"y\":7.583848,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_8\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-8_2\",\"argument\":\"舞鶴に通勤してくる人を増やすべき\",\"x\":11.602616,\"y\":4.152539,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_21\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-8_3\",\"argument\":\"人、物、金が集まることで地域が発展する\",\"x\":11.1624565,\"y\":6.374196,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_12\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-8_4\",\"argument\":\"現代の楽市楽座のような環境を作るべき\",\"x\":11.896663,\"y\":5.7387815,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_11\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-9_0\",\"argument\":\"大型ショッピングモールの誘致が必要である。\",\"x\":11.167405,\"y\":7.12041,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_13\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-9_1\",\"argument\":\"誘致場所は東インター近くが適している。\",\"x\":11.000638,\"y\":7.013385,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_13\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-10_0\",\"argument\":\"研究開発に励む企業を支援することで、市内企業の技術力を向上させるべきである。\",\"x\":11.747792,\"y\":7.5376,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_22\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-10_1\",\"argument\":\"補助金を上手く活用できる仕組みを作る必要がある。\",\"x\":13.006395,\"y\":7.3513947,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_20\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-10_2\",\"argument\":\"知財関連の既存の補助金を使えるように制度を変え、周知するべきである。\",\"x\":12.846002,\"y\":7.619378,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_15\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-10_3\",\"argument\":\"市内企業の技術力向上が理系学生のUターン先として選ばれる企業を増やし、雇用・人口減問題の解決手段となる。\",\"x\":11.864638,\"y\":7.7727365,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_22\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-11_0\",\"argument\":\"今ある場所や施設を生かして観光に繋げるべきである。\",\"x\":11.143972,\"y\":5.9618793,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_12\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-11_1\",\"argument\":\"高齢者や子供が雲海や雪景色を見られるように、通行止めになっているケーブルを改善する必要がある。\",\"x\":14.056774,\"y\":7.060556,\"p\":0,\"cluster_ids\":[\"0\",\"1_1\",\"2_10\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-11_2\",\"argument\":\"改善により観光客が増える可能性がある。\",\"x\":10.819564,\"y\":5.582362,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_1\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-12_0\",\"argument\":\"子育て支援を充実させるべきである。\",\"x\":13.275704,\"y\":8.242916,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_2\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-12_1\",\"argument\":\"舞鶴は転勤族が多いが、子育て支援を充実させることで「ずっと住みたい！」と思ってもらえるようにするべきである。\",\"x\":12.345824,\"y\":4.0442934,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_3\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-13_0\",\"argument\":\"電車やバスの本数を増やし、タクシーの代金を安くするなど交通の便を良くすべき\",\"x\":10.866056,\"y\":4.7916136,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_14\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-13_1\",\"argument\":\"子供に対するお金をもっとかけて、少子高齢化の対策を進めるべき\",\"x\":13.635678,\"y\":7.575666,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_23\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-13_2\",\"argument\":\"学校などでインターネットを使った教育を見直すべき\",\"x\":14.279458,\"y\":8.897717,\"p\":0,\"cluster_ids\":[\"0\",\"1_2\",\"2_24\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-13_3\",\"argument\":\"子育てしたいと思える施設を充実させるべき\",\"x\":12.78017,\"y\":6.832095,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_18\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-14_0\",\"argument\":\"地域の活動において、自主的に会を運営する場を作るべきである。\",\"x\":11.668893,\"y\":6.6194816,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_5\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-14_1\",\"argument\":\"互いに応援したくなるような場づくりが重要である。\",\"x\":12.553844,\"y\":7.365343,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_15\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-15_0\",\"argument\":\"病児保育などの子育て支援が必要である\",\"x\":13.126859,\"y\":8.158418,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_2\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-15_1\",\"argument\":\"資格を持っている人が生かしきれる環境を整えるべきである\",\"x\":13.66833,\"y\":6.651833,\"p\":0,\"cluster_ids\":[\"0\",\"1_1\",\"2_17\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-15_2\",\"argument\":\"60代以上の方でも働ける環境を作るべきである\",\"x\":13.613272,\"y\":6.32619,\"p\":0,\"cluster_ids\":[\"0\",\"1_1\",\"2_17\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-15_3\",\"argument\":\"年代を越えた繋がりを生む環境や働ける場所を作るべきである\",\"x\":13.385388,\"y\":5.8522964,\"p\":0,\"cluster_ids\":[\"0\",\"1_1\",\"2_0\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-16_0\",\"argument\":\"近郊都市部への通勤経路（直通バス）の充実が必要\",\"x\":11.022012,\"y\":4.5676656,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_7\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-16_1\",\"argument\":\"リモートワークに使える施設の充実が必要\",\"x\":12.771116,\"y\":6.2608314,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_18\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-16_2\",\"argument\":\"空き家マッチングが必要\",\"x\":12.643406,\"y\":6.4947014,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_18\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-16_3\",\"argument\":\"高速バスで大阪へ通勤しているが、時間が合えばもっと移住者が増えると思う\",\"x\":11.127351,\"y\":4.388301,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_7\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-17_0\",\"argument\":\"鉄道の駅を増やすべきである\",\"x\":10.7589245,\"y\":5.129063,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_14\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-17_1\",\"argument\":\"学校や大きな施設近くに駅ができると便利である\",\"x\":11.036031,\"y\":4.9663563,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_14\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-18_0\",\"argument\":\"市民が無料で使える休憩スペースを作るべき\",\"x\":12.145783,\"y\":5.88935,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_11\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-18_1\",\"argument\":\"市民が無料で使えるコワーキングスペースを作るべき\",\"x\":12.210806,\"y\":6.312537,\"p\":0,\"cluster_ids\":[\"0\",\"1_4\",\"2_11\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-19_0\",\"argument\":\"想像できない\",\"x\":12.617654,\"y\":5.142479,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_19\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-20_0\",\"argument\":\"教育を重視すべき\",\"x\":14.204516,\"y\":8.660482,\"p\":0,\"cluster_ids\":[\"0\",\"1_2\",\"2_4\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-20_1\",\"argument\":\"観光業を発展させるべき\",\"x\":10.756095,\"y\":6.174901,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_12\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-23_0\",\"argument\":\"結婚支援金を提供すべき\",\"x\":12.734508,\"y\":8.017342,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_15\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-23_1\",\"argument\":\"子育て支援金を提供すべき\",\"x\":13.196462,\"y\":7.86206,\"p\":0,\"cluster_ids\":[\"0\",\"1_3\",\"2_2\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-23_2\",\"argument\":\"学校教育を充実させるべき\",\"x\":14.465826,\"y\":9.04328,\"p\":0,\"cluster_ids\":[\"0\",\"1_2\",\"2_24\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-24_0\",\"argument\":\"女性が生き生き暮らすためには、それぞれの年齢においてしたいことが変わってくるべきである。\",\"x\":14.041082,\"y\":6.180703,\"p\":0,\"cluster_ids\":[\"0\",\"1_1\",\"2_17\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-24_1\",\"argument\":\"舞鶴市には、自分の未来を描ける環境が整っている。\",\"x\":12.538751,\"y\":4.334112,\"p\":0,\"cluster_ids\":[\"0\",\"1_5\",\"2_3\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-25_0\",\"argument\":\"教育に関わる人達の質を高めるべき\",\"x\":14.4127,\"y\":8.37809,\"p\":0,\"cluster_ids\":[\"0\",\"1_2\",\"2_4\"],\"attributes\":null,\"url\":null},{\"arg_id\":\"Acsv-25_1\",\"argument\":\"教育に関わる人達は道徳心を持ち、子供達の見本となるべき\",\"x\":14.186682,\"y\":8.363402,\"p\":0,\"cluster_ids\":[\"0\",\"1_2\",\"2_16\"],\"attributes\":null,\"url\":null}],\"clusters\":[{\"level\":0,\"id\":\"0\",\"label\":\"全体\",\"takeaway\":\"\",\"value\":70,\"parent\":\"\",\"density_rank_percentile\":0},{\"level\":1,\"id\":\"1_5\",\"label\":\"舞鶴市の観光振興と交通利便性向上による地域活性化\",\"takeaway\":\"舞鶴市の観光業を赤レンガや地域資源を活用して振興し、観光客の増加を目指すとともに、交通インフラの充実を図ることで、地域全体の活性化を促進することが求められています。具体的には、公共交通機関の本数を増やし、通勤者の利便性を向上させる施策や、地域の魅力を引き出すための子育て支援の強化が重要視されています。これにより、舞鶴市が住み続けたいと思える地域となり、人口増加や地域発展が期待されています。\",\"value\":20,\"parent\":\"0\",\"density_rank_percentile\":1},{\"level\":1,\"id\":\"1_4\",\"label\":\"地域経済の活性化とコミュニティの再生に向けた多様な取り組み\",\"takeaway\":\"地域の商業活動を活性化させるために、大型商業施設やアウトレットの誘致を進めるとともに、市民が利用できる無料のコワーキングスペースや休憩スペースの創出が求められています。また、地域の芸術活動を促進し、自主運営の場を提供することで、地域社会のつながりを深めることが重要視されています。さらに、企業誘致のための税制優遇や、地域企業の技術力向上を図ることで、理系学生のUターンを促進し、地域の雇用問題の解決にも寄与することが期待されています。\",\"value\":16,\"parent\":\"0\",\"density_rank_percentile\":0.8},{\"level\":1,\"id\":\"1_3\",\"label\":\"地域全体で支える子育てと医療の充実\",\"takeaway\":\"子育て世帯が生活しやすくなるための具体的な施策や、包括的な医療体制の構築が求められています。子育て支援金や病児保育の充実、医療機関の統合と専門性の強化を通じて、少子高齢化対策を進めることが重要です。また、結婚支援や地域活性化のための支援策、補助金活用のための意見収集システムの構築も必要とされ、地域全体で子どもや家庭を支える環境を整えることが求められています。\",\"value\":15,\"parent\":\"0\",\"density_rank_percentile\":0.6},{\"level\":1,\"id\":\"1_2\",\"label\":\"地域資源を活用した教育環境の充実と健康志向の推進\",\"takeaway\":\"地域の特性を活かした教育と食育の連携を強化し、地元の資源を活用した学校給食の地産地消やオーガニック化を推進することで、子供たちが健康的に成長できる環境を整えます。また、教育者の道徳的責任を重視し、指導者の育成や生涯学習の仕組みを構築することで、全世代が参加できる教育環境の質を向上させることが求められています。\",\"value\":12,\"parent\":\"0\",\"density_rank_percentile\":0.2},{\"level\":1,\"id\":\"1_1\",\"label\":\"世代を超えた交流と安全な観光環境の整備\",\"takeaway\":\"高齢者や子供が安全に観光を楽しむためのアクセス改善と、世代を超えた人々が交流できる働く場所の確保が求められています。特に、通行止めとなっているケーブルの改善や高潮対策が重要視されており、これにより観光地の安全性が向上します。また、60代以上の高齢者や女性がそれぞれのライフステージに応じて活躍できる環境を整えることで、より多様な働き方が実現され、全ての人が生き生きと暮らせる社会の形成が期待されています。\",\"value\":7,\"parent\":\"0\",\"density_rank_percentile\":0.4},{\"level\":2,\"id\":\"2_1\",\"label\":\"赤レンガを活用した観光業の振興と集客増加\",\"takeaway\":\"この意見グループは、赤レンガを中心に観光業を推進することで、観光客の増加が期待できるという点に焦点を当てています。赤レンガの魅力を活かした改善策が観光業の活性化につながる可能性についての前向きな意見が含まれています。\",\"value\":2,\"parent\":\"1_5\",\"density_rank_percentile\":0.64},{\"level\":2,\"id\":\"2_13\",\"label\":\"大型商業施設誘致による地域活性化\",\"takeaway\":\"この意見グループは、大型商業施設やアウトレットの誘致が地域経済の活性化に寄与するという考えに基づいています。特に、東インター近くの立地が適しているとの具体的な提案があり、地域の商業インフラの充実を図ることが重要視されています。\",\"value\":3,\"parent\":\"1_4\",\"density_rank_percentile\":0.28},{\"level\":2,\"id\":\"2_23\",\"label\":\"子育て支援の充実と少子高齢化対策\",\"takeaway\":\"この意見グループは、子育て世帯が生活しやすくなるための具体的な施策として、給食や医療の無償化、子どもへの金銭的支援を提案しています。また、社会全体で子どもを育てる環境を整えることが少子高齢化の対策として重要であるという認識が共有されています。\",\"value\":3,\"parent\":\"1_3\",\"density_rank_percentile\":0.6},{\"level\":2,\"id\":\"2_3\",\"label\":\"舞鶴市の人口増加と子育て支援の強化\",\"takeaway\":\"この意見グループは、舞鶴市の人口を増やすために、地域の魅力を活かした施策や子育て支援の充実が重要であるという考えが中心です。舞鶴の独自の魅力や未来を描ける環境を活かし、青少年団体や教育機関との連携を強化することで、住み続けたいと思える地域づくりを目指す意見が集まっています。\",\"value\":5,\"parent\":\"1_5\",\"density_rank_percentile\":0.76},{\"level\":2,\"id\":\"2_14\",\"label\":\"交通インフラの充実と利便性向上\",\"takeaway\":\"この意見グループは、公共交通機関の本数を増やしたり、タクシー料金を引き下げたりすることで、交通の利便性を向上させる必要性を強調しています。また、学校や大きな施設の近くに駅を設置することや、バイパス道路の整備を通じて渋滞を解消することも提案されており、全体として交通インフラの充実が求められています。\",\"value\":4,\"parent\":\"1_5\",\"density_rank_percentile\":0.68},{\"level\":2,\"id\":\"2_6\",\"label\":\"包括的医療体制の構築と専門性の強化\",\"takeaway\":\"この意見グループは、病院の機能を強化し、ドクターヘリの導入や専門医療の充実を通じて、患者に対して包括的な医療サービスを提供する必要性を強調しています。病院の統合によって、さまざまな医療分野が一つの施設で完結することを目指す意見が中心です。\",\"value\":3,\"parent\":\"1_3\",\"density_rank_percentile\":0.24},{\"level\":2,\"id\":\"2_12\",\"label\":\"地域資源を活用した観光振興と地域発展\",\"takeaway\":\"この意見グループは、既存の場所や施設を活用して観光業を発展させることの重要性を強調しています。特に加佐地区の魅力を引き出し、地域に人、物、金を集めることで、地域全体の発展を促進することが求められています。\",\"value\":4,\"parent\":\"1_5\",\"density_rank_percentile\":0.88},{\"level\":2,\"id\":\"2_21\",\"label\":\"舞鶴地域の通勤促進と駅再開発の必要性\",\"takeaway\":\"この意見グループは、舞鶴地域への通勤者を増やすための施策として、特に西舞鶴駅と東舞鶴駅の再開発が重要であるという点に焦点を当てています。通勤環境の改善が地域活性化につながるとの認識が共有されています。\",\"value\":2,\"parent\":\"1_5\",\"density_rank_percentile\":0.52},{\"level\":2,\"id\":\"2_9\",\"label\":\"地域密着型教育と食育の推進\",\"takeaway\":\"この意見グループは、地元の資源を活用した学校給食の地産地消の重要性や、地域の教育機関の充実を通じて地元の子供たちが地元で学び成長できる環境を整えることに焦点を当てています。地域の特性を活かした教育と食育の連携が求められています。\",\"value\":3,\"parent\":\"1_2\",\"density_rank_percentile\":0.36},{\"level\":2,\"id\":\"2_16\",\"label\":\"教育者の道徳的責任と子供の成長支援\",\"takeaway\":\"この意見グループは、教育に関わる人々が道徳心を持ち、子供たちの模範となることの重要性を強調しています。また、指導者の育成や子供たちのつながりを促進し、選択肢を増やすことが教育の質を向上させるために必要であるという考えが中心です。\",\"value\":2,\"parent\":\"1_2\",\"density_rank_percentile\":0.44},{\"level\":2,\"id\":\"2_24\",\"label\":\"教育環境の質向上と健康志向の推進\",\"takeaway\":\"この意見グループは、学校教育の質を向上させるためにインターネットの活用を見直す必要性や、教育内容の充実を求める声、さらには学校給食のオーガニック化を通じて健康志向を高めるべきだという意見が含まれています。これらはすべて、教育環境の改善と生徒の健康を重視した提案であり、相互に関連しています。\",\"value\":3,\"parent\":\"1_2\",\"density_rank_percentile\":0.48},{\"level\":2,\"id\":\"2_11\",\"label\":\"市民のための無料コワーキング・休憩スペースの創出\",\"takeaway\":\"この意見グループは、市民が無料で利用できるコワーキングスペースや休憩スペースの必要性を強調しています。現代の楽市楽座のようなコミュニティの活性化を目指し、特に子どもたちが自由に遊べる場所の提供や、地域のシャッター街の復興を通じて、地域社会のつながりを深めることが重要であるという視点が共通しています。\",\"value\":4,\"parent\":\"1_4\",\"density_rank_percentile\":0.8},{\"level\":2,\"id\":\"2_15\",\"label\":\"結婚支援と地域活性化のための包括的支援策\",\"takeaway\":\"この意見グループは、結婚支援金の提供を通じて、結婚を促進し、地域の活性化を図ることの重要性を強調しています。また、店舗の復活を支援するための聞き取り調査や、知財関連の補助金制度の見直しと周知の必要性についても言及されており、地域全体の支援体制を整えることが求められています。\",\"value\":4,\"parent\":\"1_3\",\"density_rank_percentile\":1},{\"level\":2,\"id\":\"2_5\",\"label\":\"地域の芸術活動の促進と自主運営の重要性\",\"takeaway\":\"この意見グループは、地域における芸術活動の場を創出し、住民が自主的に運営することの重要性を強調しています。芸術活動を通じて地域の活性化を図るためには、参加者が自らの意志で活動を行える環境を整えることが不可欠であるという考えが中心です。\",\"value\":2,\"parent\":\"1_4\",\"density_rank_percentile\":0.12},{\"level\":2,\"id\":\"2_8\",\"label\":\"企業誘致のための税制優遇と商業活性化戦略\",\"takeaway\":\"この意見グループは、企業誘致を促進するために税制優遇を提供する必要性を強調しており、親子を引き寄せることで地域の商業活動を活性化させる戦略について述べています。税制優遇が企業の進出を後押しし、地域経済の発展に寄与するという視点が中心です。\",\"value\":2,\"parent\":\"1_4\",\"density_rank_percentile\":0.08},{\"level\":2,\"id\":\"2_4\",\"label\":\"教育環境の充実と生涯学習の推進\",\"takeaway\":\"この意見グループは、教育の重要性を強調し、教育に関わる人々の質の向上や全世代が参加できる生涯学習の仕組みの構築、新しい図書館の活用を通じて教育環境を充実させることに焦点を当てています。教育の質を高めることが、より良い社会の実現に繋がるという前向きな姿勢が見受けられます。\",\"value\":4,\"parent\":\"1_2\",\"density_rank_percentile\":0.56},{\"level\":2,\"id\":\"2_20\",\"label\":\"補助金活用のための意見収集システムの構築\",\"takeaway\":\"この意見グループは、補助金を効果的に活用するために、誰もが意見を言いやすい環境を整える必要性を強調しています。意見収集の仕組みを整えることで、より多くの人々が参加しやすくなり、補助金の利用促進につながることを目指しています。\",\"value\":2,\"parent\":\"1_3\",\"density_rank_percentile\":0.84},{\"level\":2,\"id\":\"2_10\",\"label\":\"高齢者と子供のための安全な観光アクセス改善\",\"takeaway\":\"この意見グループは、高齢者や子供が自然の美しい景色を楽しむために、現在通行止めとなっているケーブルの改善が必要であるという点に焦点を当てています。また、高潮対策の必要性も示唆されており、観光地の安全性とアクセスの向上が求められています。\",\"value\":2,\"parent\":\"1_1\",\"density_rank_percentile\":0.2},{\"level\":2,\"id\":\"2_0\",\"label\":\"世代を超えた交流を促進する働く場所の重要性\",\"takeaway\":\"この意見グループは、働く場所の確保が重要であることに加え、年代を越えた人々が交流できる環境を整える必要性を強調しています。多様な世代が集まることで、相互の理解や協力が生まれ、より良い働き方やコミュニティの形成が期待される点が中心です。\",\"value\":2,\"parent\":\"1_1\",\"density_rank_percentile\":0.92},{\"level\":2,\"id\":\"2_22\",\"label\":\"地域企業の技術力向上と理系学生のUターン促進\",\"takeaway\":\"この意見グループは、市内企業の技術力を向上させることが、理系学生のUターン先としての魅力を高め、結果的に地域の雇用や人口減少問題の解決に寄与するという考えに基づいています。研究開発を支援することで、地域の企業が成長し、学生が地元での就職を選ぶ環境を整える重要性が強調されています。\",\"value\":2,\"parent\":\"1_4\",\"density_rank_percentile\":0.32},{\"level\":2,\"id\":\"2_2\",\"label\":\"子育て支援の充実と多様なサポートの必要性\",\"takeaway\":\"この意見グループは、子育て支援の重要性に焦点を当てており、特に病児保育や経済的支援など、具体的なサポートが求められています。子育てを行う家庭が直面する様々な課題に対して、包括的な支援策を充実させる必要性が強調されています。\",\"value\":3,\"parent\":\"1_3\",\"density_rank_percentile\":0.4},{\"level\":2,\"id\":\"2_18\",\"label\":\"地域活性化に向けた多機能施設の充実\",\"takeaway\":\"この意見グループは、子育て支援、空き家の有効活用、リモートワークのための施設整備といった多様なニーズに応えるための施設の充実を求めています。地域の活性化を図るために、子育て世代や働く人々が利用できる多機能な施設の整備が重要であるという共通の認識が見られます。\",\"value\":3,\"parent\":\"1_4\",\"density_rank_percentile\":0.72},{\"level\":2,\"id\":\"2_17\",\"label\":\"高齢者と女性の活躍を支える多様な働き方の推進\",\"takeaway\":\"この意見グループは、60代以上の高齢者や女性がそれぞれのライフステージに応じて活躍できる環境の整備を求める声が中心です。年齢や性別に関わらず、資格や経験を活かせる職場を提供することで、より多様な働き方を実現し、全ての人が生き生きと暮らせる社会を目指す必要性が強調されています。\",\"value\":3,\"parent\":\"1_1\",\"density_rank_percentile\":0.96},{\"level\":2,\"id\":\"2_7\",\"label\":\"近郊都市部への通勤手段の充実と移住促進\",\"takeaway\":\"この意見グループは、近郊都市部からの通勤手段、特に直通バスの充実が求められている点に焦点を当てています。高速バスを利用して大阪へ通勤している人々が、より便利な通勤経路が整備されることで、移住者が増加する可能性があると考えています。通勤の利便性向上が地域の活性化に寄与するという前向きな視点が示されています。\",\"value\":2,\"parent\":\"1_5\",\"density_rank_percentile\":0.16},{\"level\":2,\"id\":\"2_19\",\"label\":\"想像力の限界と新しいアイデアの必要性\",\"takeaway\":\"この意見は、現状のアイデアや状況に対する想像力の不足を示しており、新しい視点や創造的なアプローチが求められていることを反映しています。人々が新しい可能性を考えることができず、革新や変化が必要であるという認識が中心です。\",\"value\":1,\"parent\":\"1_5\",\"density_rank_percentile\":0.04}],\"comments\":{},\"propertyMap\":{},\"translations\":{},\"overview\":\"舞鶴市では観光振興と交通利便性の向上を通じて地域活性化を目指しており、公共交通の充実や子育て支援が重要視されています。また、地域経済の活性化には商業施設の誘致やコミュニティの再生が求められ、子育てと医療の充実も必要とされています。教育環境の向上や世代間交流の促進、安全な観光環境の整備も重要な課題として挙げられています。これらの取り組みにより、舞鶴市の持続可能な発展が期待されています。\",\"config\":{\"name\":\"f538f0d7-e637-4c71-820f-5b9e615ff83f\",\"input\":\"f538f0d7-e637-4c71-820f-5b9e615ff83f\",\"question\":\"②自分が市長なら、2040年に向けてこんな課題に取り組む【10/28 12:00更新】\",\"intro\":\"（例）教育環境を充実させる。公共交通を充実させる。産業を発展させる。等々\\n分析対象となったデータの件数は124件で、これらのデータに対してOpenAI API (gpt-4o-mini)を用いて70件の意見（議論）を抽出し、クラスタリングを行った。\\n\",\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"is_pubcom\":true,\"is_embedded_at_local\":false,\"local_llm_address\":null,\"extraction\":{\"prompt\":\"あなたは専門的なリサーチアシスタントです。与えられたテキストから、意見を抽出して整理してください。\\n\\n# 指示\\n* 入出力の例に記載したような形式で文字列のリストを返してください\\n  * 必要な場合は2つの別個の意見に分割してください。多くの場合は1つの議論にまとめる方が望ましいです。\\n* 整理した意見は日本語で出力してください\\n\\n## 入出力の例\\n/human\\n\\nAIテクノロジーは、そのライフサイクル全体における環境負荷を削減することに焦点を当てて開発されるべきです。\\n\\n/ai\\n\\n{\\n  \\\"extractedOpinionList\\\": [\\n    \\\"AIテクノロジーは、そのライフサイクル全体における環境負荷を削減することに焦点を当てて開発されるべきです。\\\"\\n  ]\\n}\\n\\n/human\\n\\nAIの能力、限界、倫理的考慮事項について、市民を教育する必要がある。また、教育できる人材を養成する必要がある。\\n\\n/ai\\n\\n{\\n  \\\"extractedOpinionList\\\": [\\n    \\\"AIの能力、限界、倫理的考慮事項について、市民を教育すべき\\\",\\n    \\\"AIに関する教育をできる人材を養成すべき\\\"\\n  ]\\n}\\n\\n/human\\n\\nAIはエネルギーグリッドを最適化し、無駄や炭素排出を削減できます。\\n\\n/ai\\n\\n{\\n  \\\"extractedOpinionList\\\": [\\n    \\\"AIはエネルギーグリッドを最適化して炭素排出を削減できる\\\"\\n  ]\\n}\\n\",\"workers\":30,\"limit\":124,\"properties\":[],\"categories\":{},\"category_batch_size\":5,\"source_code\":\"$17\",\"model\":\"gpt-4o-mini\"},\"hierarchical_clustering\":{\"cluster_nums\":[5,25],\"source_code\":\"$18\"},\"hierarchical_initial_labelling\":{\"prompt\":\"あなたはKJ法が得意なデータ分析者です。userのinputはグループに集まったラベルです。なぜそのラベルが一つのグループであるか解説し、表札（label）をつけてください。\\n表札については、グループ内の具体的な論点や特徴を反映した、具体性の高い名称を考案してください。\\n出力はJSONとし、フォーマットは以下のサンプルを参考にしてください。\\n\\n\\n# サンプルの入出力\\n## 入力例\\n- 手作業での意見分析は時間がかかりすぎる。AIで効率化できると嬉しい\\n- 今のやり方だと分析に工数がかかりすぎるけど、AIならコストをかけずに分析できそう\\n- AIが自動で意見を整理してくれると楽になって嬉しい\\n\\n\\n## 出力例\\n{\\n    \\\"label\\\": \\\"AIによる業務効率の大幅向上とコスト効率化\\\",\\n    \\\"description\\\": \\\"この意見グループは、従来の手作業による意見分析と比較して、AIによる自動化で分析プロセスが効率化され、作業時間の短縮や運用コストの効率化が実現される点に対する前向きな評価が中心です。\\\"\\n}\\n\",\"sampling_num\":30,\"workers\":30,\"source_code\":\"$19\",\"model\":\"gpt-4o-mini\"},\"hierarchical_merge_labelling\":{\"prompt\":\"あなたはデータ分析のエキスパートです。\\n現在、テキストデータの階層クラスタリングを行っています。\\n下層のクラスタ（意見グループ）のタイトルと説明、およびそれらのクラスタが所属する上層のクラスタのテキストのサンプルを与えるので、上層のクラスタのタイトルと説明を作成してください。\\n\\n# 指示\\n- 統合後のクラスタ名は、統合前のクラスタ名称をそのまま引用せず、内容に基づいた新たな名称にしてください。\\n- タイトルには、具体的な事象・行動（例：地域ごとの迅速対応、復興計画の着実な進展、効果的な情報共有・地域協力など）を含めてください\\n  - 可能な限り具体的な表現を用いるようにし、抽象的な表現は避けてください\\n    - 「多様な意見」などの抽象的な表現は避けてください\\n- 出力例に示したJSON形式で出力してください\\n\\n\\n# サンプルの入出力\\n## 入力例\\n- 「顧客フィードバックの自動集約」: この意見グループは、SNSやオンラインレビューなどから集めた大量の意見をAIが瞬時に解析し、企業が市場のトレンドや顧客の要望を即時に把握できる点についての期待を示しています。\\n- 「AIによる業務効率の大幅向上とコスト効率化」: この意見グループは、従来の手作業による意見分析と比較して、AIによる自動化で分析プロセスが効率化され、作業時間の短縮や運用コストの効率化が実現される点に対する前向きな評価が中心です。\\n\\n## 出力例\\n{\\n    \\\"label\\\": \\\"AI技術の導入による意見分析の効率化への期待\\\",\\n    \\\"description\\\": \\\"大量の意見やフィードバックから迅速に洞察を抽出できるため、企業や自治体が消費者や市民の声を的確に把握し、戦略的な意思決定やサービス改善が可能になります。また、従来の手法と比べて作業負荷が軽減され、業務効率の向上やコスト削減といった実際の便益が得られると期待されています。\\\"\\n}\\n\",\"sampling_num\":30,\"workers\":30,\"source_code\":\"$1a\",\"model\":\"gpt-4o-mini\"},\"hierarchical_overview\":{\"prompt\":\"/system \\n\\nあなたはシンクタンクで働く専門のリサーチアシスタントです。\\nチームは特定のテーマに関してパブリック・コンサルテーションを実施し、異なる選択肢の意見グループを分析し始めています。\\nこれから意見グループのリストとその簡単な分析が提供されます。\\nあなたの仕事は、調査結果の簡潔な要約を返すことです。要約は非常に簡潔に（最大で1段落、最大4文）まとめ、無意味な言葉を避けてください。\\n出力は日本語で行ってください。\\n\",\"source_code\":\"$1b\",\"model\":\"gpt-4o-mini\"},\"hierarchical_aggregation\":{\"sampling_num\":30,\"hidden_properties\":{},\"source_code\":\"$1c\"},\"output_dir\":\"f538f0d7-e637-4c71-820f-5b9e615ff83f\",\"only\":\"hierarchical_aggregation\",\"skip-interaction\":true,\"without-html\":true,\"previous\":{\"name\":\"f538f0d7-e637-4c71-820f-5b9e615ff83f\",\"input\":\"f538f0d7-e637-4c71-820f-5b9e615ff83f\",\"question\":\"②自分が市長なら、2040年に向けてこんな課題に取り組む【10/28 12:00更新】\",\"intro\":\"②自分が市長なら、2040年に向けてこんな課題に取り組む\",\"model\":\"gpt-4o-mini\",\"provider\":\"openai\",\"is_pubcom\":true,\"is_embedded_at_local\":false,\"local_llm_address\":null,\"extraction\":{\"prompt\":\"あなたは専門的なリサーチアシスタントです。与えられたテキストから、意見を抽出して整理してください。\\n\\n# 指示\\n* 入出力の例に記載したような形式で文字列のリストを返してください\\n  * 必要な場合は2つの別個の意見に分割してください。多くの場合は1つの議論にまとめる方が望ましいです。\\n* 整理した意見は日本語で出力してください\\n\\n## 入出力の例\\n/human\\n\\nAIテクノロジーは、そのライフサイクル全体における環境負荷を削減することに焦点を当てて開発されるべきです。\\n\\n/ai\\n\\n{\\n  \\\"extractedOpinionList\\\": [\\n    \\\"AIテクノロジーは、そのライフサイクル全体における環境負荷を削減することに焦点を当てて開発されるべきです。\\\"\\n  ]\\n}\\n\\n/human\\n\\nAIの能力、限界、倫理的考慮事項について、市民を教育する必要がある。また、教育できる人材を養成する必要がある。\\n\\n/ai\\n\\n{\\n  \\\"extractedOpinionList\\\": [\\n    \\\"AIの能力、限界、倫理的考慮事項について、市民を教育すべき\\\",\\n    \\\"AIに関する教育をできる人材を養成すべき\\\"\\n  ]\\n}\\n\\n/human\\n\\nAIはエネルギーグリッドを最適化し、無駄や炭素排出を削減できます。\\n\\n/ai\\n\\n{\\n  \\\"extractedOpinionList\\\": [\\n    \\\"AIはエネルギーグリッドを最適化して炭素排出を削減できる\\\"\\n  ]\\n}\\n\",\"workers\":30,\"limit\":124,\"properties\":[],\"categories\":{},\"category_batch_size\":5,\"source_code\":\"$1d\",\"model\":\"gpt-4o-mini\"},\"hierarchical_clustering\":{\"cluster_nums\":[5,25],\"source_code\":\"$1e\"},\"hierarchical_initial_labelling\":{\"prompt\":\"あなたはKJ法が得意なデータ分析者です。userのinputはグループに集まったラベルです。なぜそのラベルが一つのグループであるか解説し、表札（label）をつけてください。\\n表札については、グループ内の具体的な論点や特徴を反映した、具体性の高い名称を考案してください。\\n出力はJSONとし、フォーマットは以下のサンプルを参考にしてください。\\n\\n\\n# サンプルの入出力\\n## 入力例\\n- 手作業での意見分析は時間がかかりすぎる。AIで効率化できると嬉しい\\n- 今のやり方だと分析に工数がかかりすぎるけど、AIならコストをかけずに分析できそう\\n- AIが自動で意見を整理してくれると楽になって嬉しい\\n\\n\\n## 出力例\\n{\\n    \\\"label\\\": \\\"AIによる業務効率の大幅向上とコスト効率化\\\",\\n    \\\"description\\\": \\\"この意見グループは、従来の手作業による意見分析と比較して、AIによる自動化で分析プロセスが効率化され、作業時間の短縮や運用コストの効率化が実現される点に対する前向きな評価が中心です。\\\"\\n}\\n\",\"sampling_num\":30,\"workers\":30,\"source_code\":\"$1f\",\"model\":\"gpt-4o-mini\"},\"hierarchical_merge_labelling\":{\"prompt\":\"あなたはデータ分析のエキスパートです。\\n現在、テキストデータの階層クラスタリングを行っています。\\n下層のクラスタ（意見グループ）のタイトルと説明、およびそれらのクラスタが所属する上層のクラスタのテキストのサンプルを与えるので、上層のクラスタのタイトルと説明を作成してください。\\n\\n# 指示\\n- 統合後のクラスタ名は、統合前のクラスタ名称をそのまま引用せず、内容に基づいた新たな名称にしてください。\\n- タイトルには、具体的な事象・行動（例：地域ごとの迅速対応、復興計画の着実な進展、効果的な情報共有・地域協力など）を含めてください\\n  - 可能な限り具体的な表現を用いるようにし、抽象的な表現は避けてください\\n    - 「多様な意見」などの抽象的な表現は避けてください\\n- 出力例に示したJSON形式で出力してください\\n\\n\\n# サンプルの入出力\\n## 入力例\\n- 「顧客フィードバックの自動集約」: この意見グループは、SNSやオンラインレビューなどから集めた大量の意見をAIが瞬時に解析し、企業が市場のトレンドや顧客の要望を即時に把握できる点についての期待を示しています。\\n- 「AIによる業務効率の大幅向上とコスト効率化」: この意見グループは、従来の手作業による意見分析と比較して、AIによる自動化で分析プロセスが効率化され、作業時間の短縮や運用コストの効率化が実現される点に対する前向きな評価が中心です。\\n\\n## 出力例\\n{\\n    \\\"label\\\": \\\"AI技術の導入による意見分析の効率化への期待\\\",\\n    \\\"description\\\": \\\"大量の意見やフィードバックから迅速に洞察を抽出できるため、企業や自治体が消費者や市民の声を的確に把握し、戦略的な意思決定やサービス改善が可能になります。また、従来の手法と比べて作業負荷が軽減され、業務効率の向上やコスト削減といった実際の便益が得られると期待されています。\\\"\\n}\\n\",\"sampling_num\":30,\"workers\":30,\"source_code\":\"$20\",\"model\":\"gpt-4o-mini\"},\"hierarchical_overview\":{\"prompt\":\"/system \\n\\nあなたはシンクタンクで働く専門のリサーチアシスタントです。\\nチームは特定のテーマに関してパブリック・コンサルテーションを実施し、異なる選択肢の意見グループを分析し始めています。\\nこれから意見グループのリストとその簡単な分析が提供されます。\\nあなたの仕事は、調査結果の簡潔な要約を返すことです。要約は非常に簡潔に（最大で1段落、最大4文）まとめ、無意味な言葉を避けてください。\\n出力は日本語で行ってください。\\n\",\"source_code\":\"$21\",\"model\":\"gpt-4o-mini\"},\"hierarchical_aggregation\":{\"sampling_num\":30,\"hidden_properties\":{},\"source_code\":\"$22\"},\"output_dir\":\"f538f0d7-e637-4c71-820f-5b9e615ff83f\",\"only\":\"hierarchical_aggregation\",\"skip-interaction\":true,\"without-html\":true,\"embedding\":{\"model\":\"text-embedding-3-small\",\"source_code\":\"$23\"},\"hierarchical_visualization\":{\"replacements\":[],\"source_code\":\"import subprocess\\n\\n\\ndef hierarchical_visualization(config):\\n    output_dir = config[\\\"output_dir\\\"]\\n    cwd = \\\"../report\\\"\\n    command = f\\\"REPORT={output_dir} npm run build\\\"\\n\\n    try:\\n        process = subprocess.Popen(\\n            command,\\n            shell=True,\\n            cwd=cwd,\\n            stdout=subprocess.PIPE,\\n            stderr=subprocess.PIPE,\\n            universal_newlines=True,\\n        )\\n        while True:\\n            output_line = process.stdout.readline()\\n            if output_line == \\\"\\\" and process.poll() is not None:\\n                break\\n            if output_line:\\n                print(output_line.strip())\\n        process.wait()\\n        errors = process.stderr.read()\\n        if errors:\\n            print(\\\"Errors:\\\")\\n            print(errors)\\n    except subprocess.CalledProcessError as e:\\n        print(\\\"Error: \\\", e)\\n\"},\"plan\":[{\"step\":\"extraction\",\"run\":false,\"reason\":\"forced another step with -o\"},{\"step\":\"embedding\",\"run\":false,\"reason\":\"forced another step with -o\"},{\"step\":\"hierarchical_clustering\",\"run\":false,\"reason\":\"forced another step with -o\"},{\"step\":\"hierarchical_initial_labelling\",\"run\":false,\"reason\":\"forced another step with -o\"},{\"step\":\"hierarchical_merge_labelling\",\"run\":false,\"reason\":\"forced another step with -o\"},{\"step\":\"hierarchical_overview\",\"run\":false,\"reason\":\"forced another step with -o\"},{\"step\":\"hierarchical_aggregation\",\"run\":true,\"reason\":\"forced this step with -o\"},{\"step\":\"hierarchical_visualization\",\"run\":false,\"reason\":\"skipping html output\"}],\"status\":\"completed\",\"start_time\":\"2025-10-28T03:23:46.440267\",\"completed_jobs\":[{\"step\":\"hierarchical_aggregation\",\"completed\":\"2025-10-28T03:23:46.461939\",\"duration\":0.020272,\"params\":{\"sampling_num\":30,\"hidden_properties\":{},\"source_code\":\"$24\"},\"token_usage\":0}],\"total_token_usage\":0,\"token_usage_input\":0,\"token_usage_output\":0,\"lock_until\":\"2025-10-28T03:28:46.463304\",\"current_job\":\"hierarchical_aggregation\",\"current_job_started\":\"2025-10-28T03:23:46.441670\",\"current_job_progress\":null,\"current_jop_tasks\":null,\"estimated_cost\":0,\"previously_completed_jobs\":[{\"step\":\"extraction\",\"completed\":\"2025-10-28T03:20:37.576591\",\"duration\":5.24053,\"params\":{\"prompt\":\"あなたは専門的なリサーチアシスタントです。与えられたテキストから、意見を抽出して整理してください。\\n\\n# 指示\\n* 入出力の例に記載したような形式で文字列のリストを返してください\\n  * 必要な場合は2つの別個の意見に分割してください。多くの場合は1つの議論にまとめる方が望ましいです。\\n* 整理した意見は日本語で出力してください\\n\\n## 入出力の例\\n/human\\n\\nAIテクノロジーは、そのライフサイクル全体における環境負荷を削減することに焦点を当てて開発されるべきです。\\n\\n/ai\\n\\n{\\n  \\\"extractedOpinionList\\\": [\\n    \\\"AIテクノロジーは、そのライフサイクル全体における環境負荷を削減することに焦点を当てて開発されるべきです。\\\"\\n  ]\\n}\\n\\n/human\\n\\nAIの能力、限界、倫理的考慮事項について、市民を教育する必要がある。また、教育できる人材を養成する必要がある。\\n\\n/ai\\n\\n{\\n  \\\"extractedOpinionList\\\": [\\n    \\\"AIの能力、限界、倫理的考慮事項について、市民を教育すべき\\\",\\n    \\\"AIに関する教育をできる人材を養成すべき\\\"\\n  ]\\n}\\n\\n/human\\n\\nAIはエネルギーグリッドを最適化し、無駄や炭素排出を削減できます。\\n\\n/ai\\n\\n{\\n  \\\"extractedOpinionList\\\": [\\n    \\\"AIはエネルギーグリッドを最適化して炭素排出を削減できる\\\"\\n  ]\\n}\\n\",\"workers\":30,\"limit\":124,\"properties\":[],\"categories\":{},\"category_batch_size\":5,\"source_code\":\"$25\",\"model\":\"gpt-4o-mini\"},\"token_usage\":14545},{\"step\":\"embedding\",\"completed\":\"2025-10-28T03:20:38.954278\",\"duration\":1.377103,\"params\":{\"model\":\"text-embedding-3-small\",\"source_code\":\"$26\"},\"token_usage\":0},{\"step\":\"hierarchical_clustering\",\"completed\":\"2025-10-28T03:20:43.233652\",\"duration\":4.277413,\"params\":{\"cluster_nums\":[5,25],\"source_code\":\"$27\"},\"token_usage\":0},{\"step\":\"hierarchical_initial_labelling\",\"completed\":\"2025-10-28T03:20:47.920445\",\"duration\":4.686032,\"params\":{\"prompt\":\"あなたはKJ法が得意なデータ分析者です。userのinputはグループに集まったラベルです。なぜそのラベルが一つのグループであるか解説し、表札（label）をつけてください。\\n表札については、グループ内の具体的な論点や特徴を反映した、具体性の高い名称を考案してください。\\n出力はJSONとし、フォーマットは以下のサンプルを参考にしてください。\\n\\n\\n# サンプルの入出力\\n## 入力例\\n- 手作業での意見分析は時間がかかりすぎる。AIで効率化できると嬉しい\\n- 今のやり方だと分析に工数がかかりすぎるけど、AIならコストをかけずに分析できそう\\n- AIが自動で意見を整理してくれると楽になって嬉しい\\n\\n\\n## 出力例\\n{\\n    \\\"label\\\": \\\"AIによる業務効率の大幅向上とコスト効率化\\\",\\n    \\\"description\\\": \\\"この意見グループは、従来の手作業による意見分析と比較して、AIによる自動化で分析プロセスが効率化され、作業時間の短縮や運用コストの効率化が実現される点に対する前向きな評価が中心です。\\\"\\n}\\n\",\"sampling_num\":30,\"workers\":30,\"source_code\":\"$28\",\"model\":\"gpt-4o-mini\"},\"token_usage\":17783},{\"step\":\"hierarchical_merge_labelling\",\"completed\":\"2025-10-28T03:20:52.853123\",\"duration\":4.930101,\"params\":{\"prompt\":\"あなたはデータ分析のエキスパートです。\\n現在、テキストデータの階層クラスタリングを行っています。\\n下層のクラスタ（意見グループ）のタイトルと説明、およびそれらのクラスタが所属する上層のクラスタのテキストのサンプルを与えるので、上層のクラスタのタイトルと説明を作成してください。\\n\\n# 指示\\n- 統合後のクラスタ名は、統合前のクラスタ名称をそのまま引用せず、内容に基づいた新たな名称にしてください。\\n- タイトルには、具体的な事象・行動（例：地域ごとの迅速対応、復興計画の着実な進展、効果的な情報共有・地域協力など）を含めてください\\n  - 可能な限り具体的な表現を用いるようにし、抽象的な表現は避けてください\\n    - 「多様な意見」などの抽象的な表現は避けてください\\n- 出力例に示したJSON形式で出力してください\\n\\n\\n# サンプルの入出力\\n## 入力例\\n- 「顧客フィードバックの自動集約」: この意見グループは、SNSやオンラインレビューなどから集めた大量の意見をAIが瞬時に解析し、企業が市場のトレンドや顧客の要望を即時に把握できる点についての期待を示しています。\\n- 「AIによる業務効率の大幅向上とコスト効率化」: この意見グループは、従来の手作業による意見分析と比較して、AIによる自動化で分析プロセスが効率化され、作業時間の短縮や運用コストの効率化が実現される点に対する前向きな評価が中心です。\\n\\n## 出力例\\n{\\n    \\\"label\\\": \\\"AI技術の導入による意見分析の効率化への期待\\\",\\n    \\\"description\\\": \\\"大量の意見やフィードバックから迅速に洞察を抽出できるため、企業や自治体が消費者や市民の声を的確に把握し、戦略的な意思決定やサービス改善が可能になります。また、従来の手法と比べて作業負荷が軽減され、業務効率の向上やコスト削減といった実際の便益が得られると期待されています。\\\"\\n}\\n\",\"sampling_num\":30,\"workers\":30,\"source_code\":\"$29\",\"model\":\"gpt-4o-mini\"},\"token_usage\":9249},{\"step\":\"hierarchical_overview\",\"completed\":\"2025-10-28T03:20:55.918085\",\"duration\":3.063314,\"params\":{\"prompt\":\"/system \\n\\nあなたはシンクタンクで働く専門のリサーチアシスタントです。\\nチームは特定のテーマに関してパブリック・コンサルテーションを実施し、異なる選択肢の意見グループを分析し始めています。\\nこれから意見グループのリストとその簡単な分析が提供されます。\\nあなたの仕事は、調査結果の簡潔な要約を返すことです。要約は非常に簡潔に（最大で1段落、最大4文）まとめ、無意味な言葉を避けてください。\\n出力は日本語で行ってください。\\n\",\"source_code\":\"$2a\",\"model\":\"gpt-4o-mini\"},\"token_usage\":1289}],\"end_time\":\"2025-10-28T03:23:46.463301\"},\"embedding\":{\"model\":\"text-embedding-3-small\",\"source_code\":\"$2b\"},\"hierarchical_visualization\":{\"replacements\":[],\"source_code\":\"import subprocess\\n\\n\\ndef hierarchical_visualization(config):\\n    output_dir = config[\\\"output_dir\\\"]\\n    cwd = \\\"../report\\\"\\n    command = f\\\"REPORT={output_dir} npm run build\\\"\\n\\n    try:\\n        process = subprocess.Popen(\\n            command,\\n            shell=True,\\n            cwd=cwd,\\n            stdout=subprocess.PIPE,\\n            stderr=subprocess.PIPE,\\n            universal_newlines=True,\\n        )\\n        while True:\\n            output_line = process.stdout.readline()\\n            if output_line == \\\"\\\" and process.poll() is not None:\\n                break\\n            if output_line:\\n                print(output_line.strip())\\n        process.wait()\\n        errors = process.stderr.read()\\n        if errors:\\n            print(\\\"Errors:\\\")\\n            print(errors)\\n    except subprocess.CalledProcessError as e:\\n        print(\\\"Error: \\\", e)\\n\"},\"plan\":[{\"step\":\"extraction\",\"run\":false,\"reason\":\"forced another step with -o\"},{\"step\":\"embedding\",\"run\":false,\"reason\":\"forced another step with -o\"},{\"step\":\"hierarchical_clustering\",\"run\":false,\"reason\":\"forced another step with -o\"},{\"step\":\"hierarchical_initial_labelling\",\"run\":false,\"reason\":\"forced another step with -o\"},{\"step\":\"hierarchical_merge_labelling\",\"run\":false,\"reason\":\"forced another step with -o\"},{\"step\":\"hierarchical_overview\",\"run\":false,\"reason\":\"forced another step with -o\"},{\"step\":\"hierarchical_aggregation\",\"run\":true,\"reason\":\"forced this step with -o\"},{\"step\":\"hierarchical_visualization\",\"run\":false,\"reason\":\"skipping html output\"}],\"status\":\"running\",\"start_time\":\"2025-10-28T03:30:24.333679\",\"completed_jobs\":[],\"total_token_usage\":0,\"token_usage_input\":0,\"token_usage_output\":0,\"lock_until\":\"2025-10-28T03:35:24.335688\",\"current_job\":\"hierarchical_aggregation\",\"current_job_started\":\"2025-10-28T03:30:24.335685\"},\"comment_num\":124,\"visibility\":\"public\"}}],[\"$\",\"$L2c\",null,{\"result\":\"$8:1:props:children:1:props:result\"}],[\"$\",\"$L12\",null,{\"w\":\"fit-content\",\"mx\":\"auto\",\"children\":[\"$\",\"$L6\",null,{\"href\":\"/\",\"children\":[\"$\",\"$L7\",null,{\"variant\":\"outline\",\"size\":\"md\",\"children\":[[\"$\",\"svg\",null,{\"ref\":\"$undefined\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":24,\"height\":24,\"viewBox\":\"0 0 24 24\",\"fill\":\"none\",\"stroke\":\"currentColor\",\"strokeWidth\":2,\"strokeLinecap\":\"round\",\"strokeLinejoin\":\"round\",\"className\":\"lucide lucide-chevron-left\",\"children\":[[\"$\",\"path\",\"1wnfg3\",{\"d\":\"m15 18-6-6 6-6\"}],\"$undefined\"]}],\"一覧へ戻る\"]}]}]}],[\"$\",\"$L2d\",null,{\"my\":12,\"maxW\":\"750px\",\"mx\":\"auto\"}],[\"$\",\"$L12\",null,{\"maxW\":\"750px\",\"mx\":\"auto\",\"mb\":24,\"children\":\"$L2e\"}]]}],[\"$\",\"$L2f\",null,{\"meta\":{\"reporter\":\"「#みんなでつくる舞鶴2040」プロジェクト\",\"message\":\"この取組では、みなさま一人ひとりの「2040年の舞鶴ってこうなってほしいな」「こんなことやってみたい！」といった想いを募集します。\",\"webLink\":\"/\",\"privacyLink\":\"/\",\"termsLink\":null,\"brandColor\":\"#e7adb7\",\"isDefault\":false}}]]\n"])</script><script>self.__next_f.push([1,"30:I[81499,[\"150\",\"static/chunks/59650de3-481cc0c44db376d7.js\",\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"567\",\"static/chunks/567-13e48369edb584ec.js\",\"458\",\"static/chunks/458-4db2abcd82f4c9c6.js\",\"874\",\"static/chunks/874-e31c245f344a6bb3.js\",\"261\",\"static/chunks/261-224f03b48189144a.js\",\"124\",\"static/chunks/124-8b6d8ff5759d10e8.js\",\"116\",\"static/chunks/116-746bc821fa46af6a.js\",\"49\",\"static/chunks/49-fab65c398860e39e.js\",\"609\",\"static/chunks/609-98106995dfc9adbb.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-e1d928255840716e.js\"],\"ReporterContent\"]\n2e:[\"$\",\"$L30\",null,{\"meta\":\"$8:2:props:meta\",\"children\":\"$L31\"}]\n"])</script><script>self.__next_f.push([1,"b:null\n"])</script><script>self.__next_f.push([1,"f:[[\"$\",\"title\",\"0\",{\"children\":\"②自分が市長なら、2040年に向けてこんな課題に取り組む【10/28 12:00更新】 - 「#みんなでつくる舞鶴2040」プロジェクト\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"舞鶴市では観光振興と交通利便性の向上を通じて地域活性化を目指しており、公共交通の充実や子育て支援が重要視されています。また、地域経済の活性化には商業施設の誘致やコミュニティの再生が求められ、子育てと医療の充実も必要とされています。教育環境の向上や世代間交流の促進、安全な観光環境の整備も重要な課題として挙げられています。これらの取り組みにより、舞鶴市の持続可能な発展が期待されています。\"}],[\"$\",\"meta\",\"2\",{\"property\":\"og:title\",\"content\":\"②自分が市長なら、2040年に向けてこんな課題に取り組む【10/28 12:00更新】 - 「#みんなでつくる舞鶴2040」プロジェクト\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:description\",\"content\":\"舞鶴市では観光振興と交通利便性の向上を通じて地域活性化を目指しており、公共交通の充実や子育て支援が重要視されています。また、地域経済の活性化には商業施設の誘致やコミュニティの再生が求められ、子育てと医療の充実も必要とされています。教育環境の向上や世代間交流の促進、安全な観光環境の整備も重要な課題として挙げられています。これらの取り組みにより、舞鶴市の持続可能な発展が期待されています。\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:image\",\"content\":\"http://localhost:3000/f538f0d7-e637-4c71-820f-5b9e615ff83f/opengraph-image.png\"}],[\"$\",\"meta\",\"5\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"6\",{\"name\":\"twitter:title\",\"content\":\"②自分が市長なら、2040年に向けてこんな課題に取り組む【10/28 12:00更新】 - 「#みんなでつくる舞鶴2040」プロジェクト\"}],[\"$\",\"meta\",\"7\",{\"name\":\"twitter:description\",\"content\":\"舞鶴市では観光振興と交通利便性の向上を通じて地域活性化を目指しており、公共交通の充実や子育て支援が重要視されています。また、地域経済の活性化には商業施設の誘致やコミュニティの再生が求められ、子育てと医療の充実も必要とされています。教育環境の向上や世代間交流の促進、安全な観光環境の整備も重要な課題として挙げられています。これらの取り組みにより、舞鶴市の持続可能な発展が期待されています。\"}],[\"$\",\"meta\",\"8\",{\"name\":\"twitter:image\",\"content\":\"http://localhost:3000/f538f0d7-e637-4c71-820f-5b9e615ff83f/opengraph-image.png\"}]]\n"])</script><script>self.__next_f.push([1,"32:I[89248,[\"150\",\"static/chunks/59650de3-481cc0c44db376d7.js\",\"315\",\"static/chunks/315-19ca0205aa2fdd55.js\",\"567\",\"static/chunks/567-13e48369edb584ec.js\",\"458\",\"static/chunks/458-4db2abcd82f4c9c6.js\",\"874\",\"static/chunks/874-e31c245f344a6bb3.js\",\"261\",\"static/chunks/261-224f03b48189144a.js\",\"124\",\"static/chunks/124-8b6d8ff5759d10e8.js\",\"116\",\"static/chunks/116-746bc821fa46af6a.js\",\"49\",\"static/chunks/49-fab65c398860e39e.js\",\"609\",\"static/chunks/609-98106995dfc9adbb.js\",\"182\",\"static/chunks/app/%5Bslug%5D/page-e1d928255840716e.js\"],\"Image\"]\n31:[\"$\",\"$L32\",null,{\"src\":\"/kouchou-ai-reports/meta/reporter.png\",\"alt\":\"「#みんなでつくる舞鶴2040」プロジェクト\",\"maxW\":\"150px\"}]\n"])</script></body></html>